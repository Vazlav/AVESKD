
Процедура КоманднаяПанель1Заполнить(Кнопка)
	
	Если Товар.Количество() > 0 Тогда
		Режим = РежимДиалогаВопрос.ДаНет;
		Ответ = Вопрос("в таблице уже есть данные. ОЧИСТИТЬ и продолжить?", Режим, 0);
		Если Ответ = КодВозвратаДиалога.Нет Тогда
			Возврат;
		КонецЕсли;
	КонецЕсли;
	
	ТХТ = "ВЫБРАТЬ
	      |	ЗаказПоставщикуОстатки.Поставщик как Поставщик,
	      |	ЗаказПоставщикуОстатки.Товар как Товар,
	      |	ЗаказПоставщикуОстатки.ДатаЗаказа как ДатаЗаказа,
	      |	ЗаказПоставщикуОстатки.КоличествоОстаток как Количество,
	      |	РАЗНОСТЬДАТ(ЗаказПоставщикуОстатки.ДатаЗаказа, &Дата, ДЕНЬ) КАК разностьдат
	      |ИЗ
	      |	РегистрНакопления.ЗаказПоставщику.Остатки(&Дата, Склад = &Склад) КАК ЗаказПоставщикуОстатки
		  |		  ЛЕВОЕ СОЕДИНЕНИЕ Справочник.КонтрактыИАптеки КАК КонтрактыИАптеки
		  |		ПО (КонтрактыИАптеки.Аптека = &Склад)
		  |			И (КонтрактыИАптеки.Владелец.Владелец.Ссылка = ЗаказПоставщикуОстатки.Поставщик)
		  |				 И КонтрактыИАптеки.Активность = ИСТИНА И КонтрактыИАптеки.Владелец.Активность = ИСТИНА
		  |
	      |ГДЕ
//ENT-1199|	РАЗНОСТЬДАТ(ЗаказПоставщикуОстатки.ДатаЗаказа, &Дата, ДЕНЬ) > ЗаказПоставщикуОстатки.Поставщик.КоличествоДнейДоставки
		  | РАЗНОСТЬДАТ(ЗаказПоставщикуОстатки.ДатаЗаказа, &Дата, ДЕНЬ) > ВЫБОР
		  |			КОГДА ЕСТЬNULL(КонтрактыИАптеки.КоличествоДнейДоставки,0) > 0
		  |				ТОГДА КонтрактыИАптеки.КоличествоДнейДоставки
		  |			ИНАЧЕ ЗаказПоставщикуОстатки.Поставщик.КоличествоДнейДоставки
		  |		КОНЕЦ
	      |
	      |УПОРЯДОЧИТЬ ПО
	      |	ЗаказПоставщикуОстатки.Поставщик.Наименование,
		  | ЗаказПоставщикуОстатки.Товар.Наименование";	
		  
		  
	Запрос = Новый Запрос;
	Запрос.Текст = ТХТ;
	Запрос.УстановитьПараметр("Склад",Склад);
	Запрос.УстановитьПараметр("Дата",Дата);
	
	ТЗ = Запрос.Выполнить().Выгрузить();
	
	Если ТЗ.Количество() = 0 Тогда
		Возврат;
	КонецЕсли;
	
	ЭтотОбъект.Товар.Загрузить(ТЗ);
	
КонецПроцедуры

Процедура ПриОткрытии()
	
	Если ЭтоНовый() Тогда
		Дата = ТекущаяДата();
	ИначеЕсли Проведен = Истина Тогда
		ЭтаФорма.ТолькоПросмотр = Истина;
	КонецЕсли;
	
КонецПроцедуры


