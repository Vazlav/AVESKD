
Процедура ПриОткрытии()
	
	
	  ЗаполнитьСписокДоступныхПараметров ();
	
	
	
КонецПроцедуры

Процедура ЗаполнитьСписокДоступныхПараметров () Экспорт
	
	ДоступныеПараметры.Очистить();
	Для Каждого Кол Из ТОвар.Колонки Цикл
		ДоступныеПараметры.Добавить("$"+Кол.Имя);
	КонецЦикла;	
КонецПроцедуры	


Процедура ДействияФормыВычислитьРасчетнуюКолонку(Кнопка)
	
	Если ПустаяСтрока(ИмяРасчетнойКолонки)=Истина Тогда
		ПРедупреждение("Необходимо указать имя расчетной колонки!");
		Возврат;
	КонецЕсли;	
		
	ИмяРасчетнойКолонки=СокрЛП(ИмяРасчетнойКолонки);
	// - - Сначала проверим имя колонки - - //
	ИмяРасчетнойКолонки=СтрЗаменить(ИмяРасчетнойКолонки,"  ","_");
	ИмяРасчетнойКолонки=СтрЗаменить(ИмяРасчетнойКолонки," ","_");
	ИмяРасчетнойКолонки=СтрЗаменить(ИмяРасчетнойКолонки,"$","");

	
	// - - Найдем есть ли такая - - //
	
	Если Товар.Колонки.Найти(ИмяРасчетнойКолонки)= неопределено Тогда
		ТОвар.Колонки.Добавить(ИмяРасчетнойКолонки);
	КонецЕсли;	
	
	ЭлементыФормы.Товар.СоздатьКолонки();
	
	ИстиннаяФормула=СтрЗаменить(Формула,"$"," Стр.");
	
	

	
	Для Каждого Стр Из Товар Цикл
		 Стр[ИмяРасчетнойКолонки]=Вычислить(ИстиннаяФормула);
	КонецЦикла;	
	
	
	Колонка=ЭлементыФормы.Товар.Колонки.Найти(ИмяРасчетнойКолонки);
	Если Колонка<>Неопределено Тогда
		Колонка.ЦветФонаПоля=Новый Цвет(235,255,209);
	КонецЕсли;
	
	
	ЗаполнитьСписокДоступныхПараметров ();
КонецПроцедуры

Процедура ДоступныеПараметрыВыбор(Элемент, ЭлементСписка)
	
	Формула=Формула+" "+ЭлементСписка.Значение;
	
	
КонецПроцедуры

Процедура ДействияФормыВычислитьКолонкуУдаления(Кнопка)
	
	
	ИстиннаяФормула=СтрЗаменить(Формула,"$"," Стр.");
	
	Для Каждого Стр Из Товар Цикл
		ВычисленноеЗначение=Вычислить(ИстиннаяФормула);
		
		Если ТипЗнч(ВычисленноеЗначение)<>Тип("Булево") Тогда
			Сообщить("Неверное значение для колонки удалить! Результат расчета формулы должен быть типа Булево (Истина или Ложь), а получился "+ТипЗнч(ВычисленноеЗначение)+" "+ВычисленноеЗначение);
			ВычисленноеЗначение=Ложь;
		КонецЕсли;
		 Стр.Удалить=ВычисленноеЗначение;
		
	КонецЦикла;
	 
	ЗаполнитьСписокДоступныхПараметров ();

КонецПроцедуры


Процедура ОсновныеДействияФормыУдалить_строки(Кнопка)
	// Вставить содержимое обработчика.
	СУС=новый Массив;
	Для Каждого Стр Из ТОВар Цикл
		Если Стр.Удалить=Истина Тогда
			СУС.Добавить(Стр);
		КонецЕсли;
	КонецЦикла;
	
	Для Каждого Стр Из СУС Цикл
		ТОВар.Удалить(Стр);
	КонецЦикла;	
	
КонецПроцедуры


Процедура ОсновныеДействияФормыРезультатОбработкиВДокумент(Кнопка)
	
	ЭтаФорма.ВладелецФормы.ТОвар.Загрузить(Товар);
	
КонецПроцедуры

