Функция ТекущаяСтрокаДокумента  () 
    // Назначение:
	// Дает объект - тек строку документа
	// 
    // 
	//--------------------------------------------------------------------------------
	ТекСтрокаТЧ="";
	ИндексТекСтроки=Товар.Индекс(ЭлементыФормы.Товар.ТекущаяСтрока);
    ТекСтрокаТЧ=ТОвар.Получить( ИндексТекСтроки); // Рез. тип объекта - СтрокаТабличнойЧасти

	Возврат ТекСтрокаТЧ;
	
КонецФункции


//============================================================================ GtG ===
 Процедура ОбновитьСверткуПоНДС  () 
     // Назначение:
 	// Обновляет свертку по НДС
 	// 
     // 
 	//--------------------------------------------------------------------------------
	
	ТЗСвНДС =  Товар.Выгрузить();  	
	ТЗСвНДС.Свернуть("СтавкаНДС","СуммаЗакуп,НДСЗакуп");
	
	ЭлементыФормы.СверткаПоНДС.Значение=ТЗСвНДС;
	ЭлементыФормы.СверткаПоНДС.СоздатьКолонки();
	ЭлементыФормы.СверткаПоНДС.Колонки.Сдвинуть(1,-1);
	
	ЭлементыФормы.СверткаПоНДС.Колонки.Получить(1).ОтображатьВПодвале=Истина;
	ЭлементыФормы.СверткаПоНДС.Колонки.Получить(1).ТекстПодвала=ТЗСвНДС.Итог("НДСЗакуп");
	ЭлементыФормы.СверткаПоНДС.Колонки.Получить(1).ГоризонтальноеПоложениеВПодвале=ГоризонтальноеПоложение.Право;
	
	ЭлементыФормы.СверткаПоНДС.Колонки.Получить(2).ОтображатьВПодвале=Истина;
	ЭлементыФормы.СверткаПоНДС.Колонки.Получить(2).ТекстПодвала=ТЗСвНДС.Итог("СуммаЗакуп");
	ЭлементыФормы.СверткаПоНДС.Колонки.Получить(2).ГоризонтальноеПоложениеВПодвале=ГоризонтальноеПоложение.Право;
	
	
	
	
	ЭлементыФормы.СверткаПоНДС.Подвал=Истина;
	
	
  КонецПроцедуры
  //============================================================================ GtG ===


Процедура ПриОткрытии()
	  
	//ОМ10_ЗаполнитьСписокПечФорм(ЭтотОбъект,СписокПечатныхФорм);
	Если ЭтотОбъект.Проведен=Истина ТОгда
		
		Предупреждение("ВНИМАНИЕ! ДОКУМЕНТ УЖЕ ПРОВЕДЕН!" );
		//
		//ЭлементыФормы.КоманднаяПанель1.Доступность=Ложь;
		Если Не РольДоступна("НачПриемногоОтдела") Тогда
			ЭтаФорма.ТолькоПросмотр=Истина;
		КонецЕсли;
		//ЭлементыФормы.ОсновныеДействияФормы.Кнопки.ОсновныеДействияФормыОК.Доступность=Ложь;
		
	КонецЕсли;
	
	Если НЕ ЭтоНовый() Тогда
		ДатаЗапрета = НастройкаПравДоступа.ВернутьДатуЗапретаРедактирования(Склад);
		Если Дата <= ДатаЗапрета Тогда
			ЭтаФорма.ТолькоПросмотр = Истина;
		КонецЕсли;	
	КонецЕсли;
	
	ОбновитьСверткуПоНДС  () ;

	
КонецПроцедуры


Процедура ОсновныеДействияФормыКарточкаТОвара(Кнопка)
		// Вставить содержимое обработчика.
	ТСД=ТекущаяСтрокаДокумента  ();
	
	Карточка=Отчеты.ДвижениеТовара1.Создать();
	
	Карточка.ВыбПартия=ТСД.Партия;
	
	Карточка.ВыбСклад=Склад;
	
	Карточка.ВыбТовар=ТСД.ТОвар;
	Карточка.ВыбФирма=Склад.Фирма;
	Карточка.НачПер=НачалоГода(Дата);
	Карточка.КонПер=Дата;
	
	
	Ф=Карточка.ПолучитьФорму("Форма");
	
	Ф.Открыть();

КонецПроцедуры

Процедура ТоварЕИТОбработкаВыбора(Элемент, ВыбранноеЗначение, СтандартнаяОбработка)
	ТС=ЭлементыФормы.ТОвар.ТекущаяСтрока;
	ТС.Коэфф= ВыбранноеЗначение.К;
КонецПроцедуры

Процедура СкладОбработкаВыбора(Элемент, ВыбранноеЗначение, СтандартнаяОбработка)
	Фирма = ВыбранноеЗначение.Фирма;
КонецПроцедуры

Процедура СкладПриИзменении(Элемент)
	
	Если Элемент.Значение.Фирма <> Фирма Тогда
		Фирма = Элемент.Значение.Фирма;
	КонецЕсли;

КонецПроцедуры

Процедура ФирмаОбработкаВыбора(Элемент, ВыбранноеЗначение, СтандартнаяОбработка)
	
	Если (Склад.Фирма <> ВыбранноеЗначение) и (НЕ Склад.Пустая()) Тогда
		Предупреждение("Нельзя выбрать фирму отличную от фирмы по уже выбранной ранее аптеке!"	);
		ВыбранноеЗначение = Фирма;
	КонецЕсли
	
КонецПроцедуры

Процедура ДействияФормыЗаполнитьПоЧекуККМ(Кнопка)
    Чеки=Документы.ЧекПродажи.ПолучитьФормуВыбора("ФормаСписка",ЭтаФорма,1);
	Чеки.Открыть();
КонецПроцедуры

Процедура ОбработкаВыбора(ЗначениеВыбора, Источник)
	
	ЗаполнитьВозвратПоЧеку(ЗначениеВыбора); // в модуле объекта
	
	ОбновитьСверткуПоНДС() ;

КонецПроцедуры

Процедура ИнтернетЗаказНажатие(Элемент)
	ФИЗ=ИнтернетЗаказ.ПолучитьФорму("ФормаДокумента",ЭтаФорма,1);
	ФИЗ.Открыть();
КонецПроцедуры

Процедура ТоварПослеУдаления(Элемент)
	Если ИнтернетЗаказ.Пустая()=Ложь Тогда
		// Проверка на частичный отказ и изменение комментария
		СУммаЗаказаСоСкидкой=ИнтернетЗаказ.Товар.Итог("СуммаСоСкидкой");
		Если Товар.Итог("СуммаРозн")-Товар.Итог("СуммаСкидки")<>СУммаЗаказаСоСкидкой Тогда
			Комментарий="Частичный отказ";
		Иначе	 
			Комментарий="Полный отказ";
		КонецЕсли;
	КонецЕсли;	
КонецПроцедуры
