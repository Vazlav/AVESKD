
Процедура ОчиститьИнфо()

		ЭлементыФормы.НадписьДатаСоздания.Заголовок 	=	"";
		ЭлементыФормы.НадписьДатаДействияС.Заголовок 	=	"";
		ЭлементыФормы.НадписьДатаДействияПо.Заголовок	=	"";
		ЭлементыФормы.НадписьТипАкции.Заголовок 		=	"";
		ЭлементыФормы.НадписьОтветственный.Заголовок	=	"";
		ЭлементыФормы.НадписьУсловия.Заголовок			=	"";
	
КонецПроцедуры

Процедура ЗаполнитьИнфо()

		ЭлементыФормы.НадписьДатаСоздания.Заголовок		= Формат(Промоакция.ДатаСоздания, "ДФ=dd.MM.yyyy");
		ЭлементыФормы.НадписьДатаДействияС.Заголовок	= Формат(Промоакция.ДатаПроведенияС, "ДФ=dd.MM.yyyy");
		ЭлементыФормы.НадписьДатаДействияПо.Заголовок	= Формат(Промоакция.ДатаПроведенияПо, "ДФ=dd.MM.yyyy");
		ЭлементыФормы.НадписьТипАкции.Заголовок			= Промоакция.ТипАкции;
		ЭлементыФормы.НадписьОтветственный.Заголовок	= Промоакция.Ответственный;
		ЭлементыФормы.НадписьУсловия.Заголовок			= Промоакция.Условия;

КонецПроцедуры

Процедура ЗаполнитьТЧ()

	РаспределениеКоэффициентов.Очистить();
	
	ТекстЗапроса =
	"ВЫБРАТЬ
	|	ПромоакцииТоварныеПозиции.Товар,
	|	ПромоакцииТоварныеПозиции.Код1С
	|ИЗ
	|	Справочник.Промоакции.ТоварныеПозиции КАК ПромоакцииТоварныеПозиции
	|ГДЕ
	|	ПромоакцииТоварныеПозиции.Ссылка = &Ссылка
	|;
	|
	|////////////////////////////////////////////////////////////////////////////////
	|ВЫБРАТЬ
	|	ПромоакцииСклад.Аптека,
	|	ПромоакцииСклад.Код1С
	|ИЗ
	|	Справочник.Промоакции.Склад КАК ПромоакцииСклад
	|ГДЕ
	|	ПромоакцииСклад.Ссылка = &Ссылка";
	
	Запрос = Новый Запрос;
	Запрос.Текст = ТекстЗапроса;
	Запрос.УстановитьПараметр("Ссылка", Промоакция);
	
	МассивРезультатов = Запрос.ВыполнитьПакет();
	ВыборкаАптек = МассивРезультатов[1].Выбрать();
	ВыборкаАП = МассивРезультатов[0].Выбрать();
	
	Пока ВыборкаАптек.Следующий() Цикл
		
		Пока ВыборкаАП.Следующий() Цикл
		
			НоваяСтрока = РаспределениеКоэффициентов.Добавить();
		    НоваяСтрока.СкладКод	= ВыборкаАптек.Код1С;
		    НоваяСтрока.Склад		= ВыборкаАптек.Аптека;
		    НоваяСтрока.ТоварКод	= ВыборкаАП.Код1С;
		    НоваяСтрока.Товар		= ВыборкаАП.Товар;
			
		КонецЦикла;	
		
		ВыборкаАП.Сбросить();
		
	КонецЦикла; 

КонецПроцедуры
 

Процедура ПромоакцияПриИзменении(Элемент)
	
	ВыбранноеЗначение = ЭлементыФормы.Промоакция.Значение;
	Если ЗначениеЗаполнено(ВыбранноеЗначение) Тогда
	
		ЗаполнитьИнфо();
		//ЭлементыФормы.НадписьДатаСоздания.Заголовок		= Формат(ВыбранноеЗначение.ДатаСоздания, "ДФ=dd.MM.yyyy");
		//ЭлементыФормы.НадписьДатаДействияС.Заголовок	= Формат(ВыбранноеЗначение.ДатаПроведенияС, "ДФ=dd.MM.yyyy");
		//ЭлементыФормы.НадписьДатаДействияПо.Заголовок	= Формат(ВыбранноеЗначение.ДатаПроведенияПо, "ДФ=dd.MM.yyyy");
		//ЭлементыФормы.НадписьТипАкции.Заголовок			= ВыбранноеЗначение.ТипАкции;
		//ЭлементыФормы.НадписьОтветственный.Заголовок	= ВыбранноеЗначение.Ответственный;
		//ЭлементыФормы.НадписьУсловия.Заголовок			= ВыбранноеЗначение.Условия;
		КоэффициентДатаДействияС	= ВыбранноеЗначение.ДатаПроведенияС;
		КоэффициентДатаДействияПо	= ВыбранноеЗначение.ДатаПроведенияПо;
		
	Иначе
		
		ОчиститьИнфо()
	
	КонецЕсли;
	
	ЗаполнитьТЧ();
	
КонецПроцедуры

Процедура КнопкаЗаполнитьНажатие(Элемент)
	
	Для каждого СтрокаТЧ Из РаспределениеКоэффициентов Цикл
	
		СтрокаТЧ.Коэффициент = КоэффициентОбщий;	
	
	КонецЦикла; 
	
КонецПроцедуры

Процедура ПриОткрытии()
	ЗаполнитьИнфо();
КонецПроцедуры
