
Процедура ОбновитьИтоги()
	
	ЭлементыФормы.ИтогиСуммаЗакуп.Заголовок = Формат(Товар.Итог("СуммаЗакуп"),"ЧЦ=10; ЧДЦ=2");
	ЭлементыФормы.ИтогиСуммаРозн.Заголовок = Формат(Товар.Итог("СуммаРозн"),"ЧЦ=10; ЧДЦ=2");
	ЭлементыФормы.ИтогиСуммаЗакупНДС.Заголовок = Формат(Товар.Итог("НДСЗакуп"),"ЧЦ=10; ЧДЦ=2");

	ТЗНДС = Товар.Выгрузить(,"СтавкаНДСЗакуп,НДСЗакуп");
	ТЗНДС.Свернуть("СтавкаНДСЗакуп","НДСЗакуп");
	
	Для каждого стр из ТЗНДС Цикл
		Если стр.СтавкаНДСЗакуп = 10 Тогда
			ЭлементыФормы.ИтогиСуммаЗакупНДС10.Заголовок = Формат(стр.НДСЗАкуп,"ЧЦ=10; ЧДЦ=2");
		ИначеЕсли стр.СтавкаНДСЗакуп = 18 Тогда
			ЭлементыФормы.ИтогиСуммаЗакупНДС18.Заголовок = Формат(стр.НДСЗАкуп,"ЧЦ=10; ЧДЦ=2");
		КонецЕсли;
	КонецЦикла;
	
	
КонецПроцедуры

Процедура ОбновлениеОтображения()
	
	ОбновитьИтоги();
	
КонецПроцедуры

Процедура ТоварПриВыводеСтроки(Элемент, ОформлениеСтроки, ДанныеСтроки)
	
	ЖВ = ДанныеСтроки.Товар.ЖНВЛС;
	Если  ЖВ = Ложь и ДанныеСтроки.ЦенаГосРегистрации > 0 ТОгда
		 //Это строка с ошибками расценки или подозрительная с точки зрения цен или сроков годности
		 ОформлениеСтроки.ЦветФона=Новый Цвет(255,0,0);
	 КонецЕсли;
	 
	 
	 Если ЖВ = Истина тогда
		 //ОформлениеСтроки.Шрифт.Жирный = Истина;
		 ОформлениеСтроки.Ячейки.ЖНВЛС.ЗначениеКартинки  =БиблиотекаКартинок.Здоровье;
	 КонецЕсли;	
	
КонецПроцедуры

Процедура ОсновныеДействияФормыОсновныеДействияФормыСохранить(Кнопка)
	
	Если Проведен = Истина Тогда
		Предупреждение("Документ НЕ сохранен. В проведенном документе пользуйтесь кнопкой <Провести>!");
		Возврат;
	КонецЕсли;
	
	
	Режим = РежимДиалогаВопрос.ДаНет;
	Ответ = Вопрос("Вы действительно хотите сохранить документ/изменения?",Режим,0);
	
	Если Ответ = КодВозвратаДиалога.Да Тогда
		Записать(РежимЗаписиДокумента.Запись);
	КонецЕсли;
	
	
	
КонецПроцедуры

Процедура КоманднаяПанельТоваракнДвижениеПоПартии(Кнопка)
	
	
	ТСД=ЭлементыФормы.Товар.ТекущаяСтрока;
	
	Карточка=Отчеты.УЗ_ДвижениеТовара.Создать();
	
	Карточка.КодПартии=ТСД.КодПартии;
	Карточка.ВыбСклад=Склад;
	Карточка.ВыбТовар=ТСД.ТОвар;
	Карточка.ВыбФирма=Фирма;
	Карточка.НачПер=НачалоГода(Дата);
	Карточка.КонПер=Дата;
	
	Ф=Карточка.ПолучитьФорму("Форма");
	
	Ф.Открыть();

	
КонецПроцедуры



Процедура КоманднаяПанель2кнПечать(Кнопка)
	
	ОМ10_КнопкаПечатьНажатие(ЭтотОбъект,ЭтаФорма);	
	
КонецПроцедуры



Процедура кнОбновитьИсториюИзмененийНажатие(Элемент)
	
	
	 ТХТ = "ВЫБРАТЬ
	       |	ИзмененияПоступленийВАптеке.Документ,
	       |	ИзмененияПоступленийВАптеке.ИД КАК ИД,
	       |	ИзмененияПоступленийВАптеке.ДатаИзменения,
	       |	ИзмененияПоступленийВАптеке.Действие,
	       |	ИзмененияПоступленийВАптеке.ТабНомер,
	       |	ИзмененияПоступленийВАптеке.ФИО,
	       |	ИзмененияПоступленийВАптеке.НомерДокАптеки
	       |ИЗ
	       |	РегистрСведений.ИзмененияПоступленийВАптеке КАК ИзмененияПоступленийВАптеке
	       |ГДЕ
	       |	ИзмененияПоступленийВАптеке.Документ = &Документ
	       |
	       |УПОРЯДОЧИТЬ ПО
	       |	ИД";
	
		   
	Запрос = Новый Запрос;
	Запрос.Текст = ТХТ;
	Запрос.УстановитьПараметр("Документ",Ссылка);
	ТЗИзмененийВАптеке = Запрос.Выполнить().Выгрузить();	
	
КонецПроцедуры


Процедура ПоказатьИсторию()
	
	ИсторияИзменений.Очистить();
	
	ТЗИстории = ОбщегоНазначения.ПолучитьИсториюИзмененийДокумента(Ссылка);
	Если НЕ ТЗИстории = Неопределено Тогда
		ЭлементыФормы.ИсторияИзменений.Значение = ТЗИстории;
	КонецЕсли;
	
КонецПроцедуры

Процедура ПанельШапкиПриСменеСтраницы(Элемент, ТекущаяСтраница)
	
	Если Элемент.ТекущаяСтраница = Элемент.Страницы.СтраницаИстории Тогда
		ПоказатьИсторию();
	КонецЕсли;
	
КонецПроцедуры

