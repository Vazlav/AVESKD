Процедура ПроверкаСодержимоеСписка(СписокЗначений)
	
	СписокДляУдаления = Новый СписокЗначений;
	Для каждого стр из СписокЗначений Цикл
		Если НЕ ЗначениеЗаполнено(стр.Значение) и ТипЗнч(стр.Значение) <> Тип("Число") Тогда
			СписокДляУдаления.Добавить(стр);
		КонецЕсли;
	КонецЦикла;
	
	Для каждого стр из СписокДляУдаления Цикл
		СписокЗначений.Удалить(стр.Значение);	
	КонецЦикла;
	
	
КонецПроцедуры



Процедура ОсновныеДействияФормыВыбрать(Кнопка)
	
	СтруктураОповещения=Новый Структура();
	СтруктураОповещения.Вставить("ИмяТаблицыДокумента", ИмяТаблицыДокумента);
	
	Если ЭтоСписокЗначений Тогда
		ПроверкаСодержимоеСписка(СписокЗначений);
		Если СписокЗначений.Количество() = 0 Тогда
			Предупреждение("Список значений должен содержать как минимум одну строку. Выбор не может быть продолжен");
			Возврат;
		КонецЕсли;
		СтруктураОповещения.Вставить("Значение", СписокЗначений.ВыгрузитьЗначения()); //Массив значений
	Иначе		
		СтруктураОповещения.Вставить("Значение", ОдиночноеЗначение);
	КонецЕсли;
	
	ОповеститьОВыборе(СтруктураОповещения);
	
КонецПроцедуры

Процедура КоманднаяПанель1Очистить(Кнопка)
	Если Вопрос("Очистить список полностью?",РежимДиалогаВопрос.ДаНет)=КодВозвратаДиалога.Да Тогда
		СписокЗначений.Очистить();
	КонецЕсли;
КонецПроцедуры

Процедура ПриОткрытии()
	// Вставить содержимое обработчика.
	
	ЭлементыФормы.Панель1.Страницы.ВыборОдногоЗначения.Видимость=Не ЭтоСписокЗначений;
	ЭлементыФормы.Панель1.Страницы.ВыборСпискаЗначений.Видимость=ЭтоСписокЗначений;
	
	
	Если ЭтоСписокЗначений Тогда
		
		СписокЗначений.ТипЗначения=нОВЫЙ ОписаниеТипов(СтрокаТипЗначения);
		СписокЗначений.ЗагрузитьЗначения(ЗначениеХЗ.Получить());
		
	Иначе
		
		ЭлементыФормы.ОдиночноеЗначение.ОграничениеТипа=нОВЫЙ ОписаниеТипов(СтрокаТипЗначения);
		ЭлементыФормы.ОдиночноеЗначение.Значение=ЭлементыФормы.ОдиночноеЗначение.ОграничениеТипа.ПривестиЗначение("");
	КонецЕсли;	
	
	
	
КонецПроцедуры

Процедура КоманднаяПанель1Добавить(Кнопка)
	
	НовоеЗначениеСписка="";
	ВвестиЗначение( НовоеЗначениеСписка,"Выберите значение",нОВЫЙ ОписаниеТипов(СтрокаТипЗначения));
	Если ЗначениеЗаполнено(НовоеЗначениеСписка) и ТипЗнч(НовоеЗначениеСписка) <> Тип("Число") Тогда
		СписокЗначений.Добавить(НовоеЗначениеСписка);
	КонецЕсли;

	
КонецПроцедуры

Процедура КоманднаяПанель1Удалить(Кнопка)
	
	УдаляемаяСтрока=ЭлементыФормы.СписокЗначений.ТекущаяСтрока;
	Если УдаляемаяСтрока<>Неопределено Тогда
		СписокЗначений.Удалить(УдаляемаяСтрока);
	КонецЕсли;
	
КонецПроцедуры

Процедура КоманднаяПанель1УбратьДубли(Кнопка)
	НовыйСписокЗначений=Новый СписокЗначений;
	
	ДЛя Каждого Стр Из СписокЗначений Цикл
		
		Если НовыйСписокЗначений.НайтиПоЗначению(Стр.Значение)=Неопределено ТОгда
			НовыйСписокЗначений.Добавить(Стр.Значение);
		КонецЕСли;
	КонецЦикла;	
	
	СписокЗначений.Очистить();
	СписокЗначений.ЗагрузитьЗначения(НовыйСписокЗначений.ВыгрузитьЗначения());
	
КонецПроцедуры

Процедура КоманднаяПанель1кнЗарузитьСписок(Кнопка)
	
	
	Если Найти(СтрокаТипЗначения,"СправочникСсылка") > 0 Тогда
		Табл = СтрЗаменить(СтрокаТипЗначения,"СправочникСсылка","Справочник");
	Иначе
		Предупреждение("Загрузка возможна только для справочников.");
		Возврат;
	КонецЕсли;
	
	XLS=Новый ДиалогВыбораФайла(РежимДиалогаВыбораФайла.Открытие);
	XLS.ПолноеИмяФайла = "";
	XLS.МножественныйВыбор = Ложь;
	XLS.Заголовок = "Выберите файл формата Excel";
	XLS.Фильтр="*.xls|*.xls";
	Если XLS.Выбрать() Тогда
		ФайлЭксель=XLS.ПолноеИмяФайла;
	Иначе
		Возврат;
	КонецЕсли;	
	
	Если ПустаяСтрока(СокрЛП(ФайлЭксель)) = Истина Тогда
		Предупреждение("Не выбран файл для загрузки");
		Возврат;
	КонецЕсли;
	
	Excel = Новый COMОбъект("Excel.Application");
	Попытка
		Книга = Excel.WorkBooks.Open(СокрЛП(ФайлЭксель), 0);
	Исключение
		Сообщить("Файл: " + ФайлЭксель + " либо уже открыт, либо поврежден! Пропускаем его... ");	
		Возврат;
	КонецПопытки;
	
	
	СписокЗнч = Новый СписокЗначений();
	

	Лист = Книга.WorkSheets(1);	
	ВсегоСтрок = Лист.Cells(1,1).SpecialCells(11).Row;
	
	Для Строка = 2 По ВсегоСтрок Цикл 
		
		ОбработкаПрерыванияПользователя();
		
		Код = Лист.Cells(Строка,1).Value;
		
		Если Не ЗначениеЗаполнено(Код) Тогда
			Прервать;
		КонецЕсли;
		
		СписокЗнч.Добавить(Код);
		
	КонецЦикла;
	
	Excel.Application.Quit(); 
	

	
	ТХТ = "ВЫБРАТЬ Различные
	      |	Спр.Код,
	      |	Спр.Ссылка
	      |ИЗ
	      |	" + Табл + " КАК Спр
		  |ГДЕ Спр.Код в (&СписокКодов)
		  |УПОРЯДОЧИТЬ ПО Наименование";
		Запрос = Новый Запрос;
		Запрос.Текст = ТХТ;
		Запрос.УстановитьПараметр("СписокКодов",СписокЗнч);
		Рез = Запрос.Выполнить();
		Если Рез.Пустой() Тогда
			Предупреждение("В справочнике не нашлось ссылок по загруженному списку кодов");
			Возврат;
		КонецЕсли;
		н=0;
		Выборка = Рез.Выбрать();
		Пока Выборка.Следующий() Цикл
			н=н+1;
			СписокЗначений.Добавить(Выборка.Ссылка);
		КонецЦикла;
	
	    Сообщить("Загружено : " + н + " записей.");
	
	
КонецПроцедуры

Процедура КоманднаяПанель1кнВывестиСписок(Кнопка)
	
	Если ТипЗнч(СписокЗначений.Получить(0).Значение) = Тип("СправочникСсылка.АССОРТИМЕНТНЫЙ_ПЛАН")  Тогда
		Построитель = Новый ПостроительОтчета;
		Построитель.Текст = "ВЫБРАТЬ
		                    |	АП.Код,
		                    |	АП.Наименование
		                    |ИЗ
		                    |	Справочник.АССОРТИМЕНТНЫЙ_ПЛАН КАК АП
		                    |ГДЕ
		                    |	АП.Ссылка В(&СписокТоваров)";
		Построитель.Параметры.Вставить("СписокТоваров",СписокЗначений);
		Построитель.Выполнить();
		Построитель.Вывести();
	КонецЕсли;
	
	
КонецПроцедуры
