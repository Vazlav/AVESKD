

Процедура ПриОткрытии()
		
	//+++ENT-670 заполним колонку на форме данными из регистра
	Если не ЭтоНовый() Тогда
		Запрос = Новый Запрос;
		Запрос.Текст = "ВЫБРАТЬ
		               |	Продажи.GuidЧека КАК Чек,
		               |	Продажи.КодТовара КАК Товар,
					   |	Продажи.КодПартии КАК Партия,
		               |	&GuidСмены КАК GuidСмены
		               |ПОМЕСТИТЬ втЧекиТовары
		               |ИЗ
		               |	&Продажи КАК Продажи
		               |;
		               |
		               |////////////////////////////////////////////////////////////////////////////////
		               |ВЫБРАТЬ
		               |	КодыСкидокТоваровККМ.КодСкидки КАК КодСкидки,		              
		               |	КодыСкидокТоваровККМ.GuidЧека КАК GuidЧека,
		               |	КодыСкидокТоваровККМ.КодТовара КАК КодТовара,
					   |	КодыСкидокТоваровККМ.КодПартии КАК КодПартии
		               |ИЗ
		               |	РегистрСведений.КодыСкидокТоваровККМ КАК КодыСкидокТоваровККМ
		               |		ВНУТРЕННЕЕ СОЕДИНЕНИЕ втЧекиТовары КАК втЧекиТовары
		               |		ПО КодыСкидокТоваровККМ.GuidЧека = втЧекиТовары.Чек
		               |			И КодыСкидокТоваровККМ.КодТовара = втЧекиТовары.Товар
		               |			И КодыСкидокТоваровККМ.GuidСмены = втЧекиТовары.GuidСмены 
					   |			И КодыСкидокТоваровККМ.КодПартии = втЧекиТовары.Партия
		               |ГДЕ
		               |	КодыСкидокТоваровККМ.GuidСмены = &GuidСмены";
		Запрос.УстановитьПараметр("GuidСмены",GuidСмены);
		Запрос.УстановитьПараметр("Продажи", ПродажиТовара.Выгрузить(,"GuidЧека,КодТовара,КодПартии"));
		ТзКодовСкидок = ЗАпрос.Выполнить().Выгрузить();
	КонецЕсли;
	//---
КонецПроцедуры

Процедура ПродажиТовараПриВыводеСтроки(Элемент, ОформлениеСтроки, ДанныеСтроки)
	Отбор = Новый Структура;
	Отбор.Вставить("GuidЧека",ДанныеСтроки.GuidЧека);
	Отбор.Вставить("КодТовара",ДанныеСтроки.КодТовара);
	Отбор.Вставить("КодПартии",ДанныеСтроки.КодПартии);
	МассивСтрок = ТзКодовСкидок.НайтиСтроки(Отбор);
	Если МассивСтрок.Количество()> 0 тогда
		ОформлениеСтроки.Ячейки.КодСкидки.УстановитьТекст(МассивСтрок[0].КодСкидки);		
	КонецЕсли;
	
КонецПроцедуры


