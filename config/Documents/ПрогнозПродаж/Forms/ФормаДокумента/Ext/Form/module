// ОБРАБОТЧИКИ ОБЩИЕ
Процедура УправлениеВидимостью()

	ФлагДоступность = Не Согласован;
	Для каждого Стр Из ЭлементыФормы Цикл
	
		// Исключения - всегда доступны
		Если  Стр.Имя = "ОсновныеДействияФормы" Тогда
			Продолжить
		КонецЕсли; 
		
		// Исключения - всегда недоступны
		Если Стр.Имя = "Согласующий" Тогда
			Стр.Доступность = Ложь;
			Продолжить
		КонецЕсли; 
		
		// Для всех реквизитов
		Стр.Доступность = ФлагДоступность;
	
	КонецЦикла; 
	
	УправлениеНадписямиКнопок();	

КонецПроцедуры
 
Процедура УправлениеНадписямиКнопок()

	ЭлементыФормы.ОсновныеДействияФормы.Кнопки.кнСогласование.Текст = ?(Согласован, "Отменить согласование","Согласовать");

КонецПроцедуры
 
// ОБРАБОТЧИКИ ФОРМЫ
Процедура ПриОткрытии()
	
	Если ЭтотОбъект.ЭтоНовый() Тогда
		Ответственный = ПараметрыСеанса.ТекущийСотр;
	КонецЕсли;
	МесяцСтрока = ДатаКакМесяцПредставление(ПериодРегистрации);
	
	УправлениеВидимостью();
	
КонецПроцедуры

// ОБРАБОТЧИКИ ЭЛЕМЕНТОВ ФОРМЫ 
Процедура КоманднаяПанель1ЗагрузитьИзЕксель(Кнопка)
	ПолучитьФорму("ФормаЗагрузкиИзФайла").Открыть();
КонецПроцедуры

Процедура ОсновныеДействияФормыкнСогласование(Кнопка)

	Если РольДоступна("супер_АДМИНИСТРАТОР") или РольДоступна("ПрогнозПродажСогласование") Тогда
	
	Иначе
		
		Предупреждение("Недостаточно прав на выполнение данной операции!");
		Возврат;
	
	КонецЕсли;
	
	Согласован = ?(Согласован,Ложь,Истина);
	Согласующий = ?(Согласован,ПараметрыСеанса.ТекущийСотр,Справочники.Сотрудники.ПустаяСсылка());
	
	УправлениеВидимостью();
	
КонецПроцедуры

Процедура ПериодРегистрацииПриИзменении(Элемент)
	
	ДатаКакМесяцПодобратьДатуПоТексту(Элемент.Значение, ПериодРегистрации);
	Элемент.Значение = ДатаКакМесяцПредставление(ПериодРегистрации);

КонецПроцедуры

Процедура ПериодРегистрацииНачалоВыбораИзСписка(Элемент, СтандартнаяОбработка)
	
	НачалоВыбораИзСпискаПредставленияПериодаРегистрации(Элемент, СтандартнаяОбработка, ПериодРегистрации, ЭтаФорма);
	
КонецПроцедуры

Процедура ПериодРегистрацииОчистка(Элемент, СтандартнаяОбработка)
	
	СтандартнаяОбработка = Ложь;
	
КонецПроцедуры

Процедура ПериодРегистрацииРегулирование(Элемент, Направление, СтандартнаяОбработка)
	
	ПериодРегистрации = ДобавитьМесяц(ПериодРегистрации, Направление);
	Элемент.Значение = ДатаКакМесяцПредставление(ПериодРегистрации);
	
КонецПроцедуры

Процедура ПериодРегистрацииАвтоПодборТекста(Элемент, Текст, ТекстАвтоПодбора, СтандартнаяОбработка)
	
	ДатаКакМесяцАвтоПодборТекста(Текст, ТекстАвтоПодбора, СтандартнаяОбработка);
	
КонецПроцедуры

Процедура ПериодРегистрацииОкончаниеВводаТекста(Элемент, Текст, Значение, СтандартнаяОбработка)
	
	ДатаКакМесяцОкончаниеВводаТекста(Текст, Значение, СтандартнаяОбработка);
	
КонецПроцедуры

// ОБРАБОТЧИКИ ТЧ РАЗБИВКА ПО ПЕРИОДАМ
Процедура ТоварТоварПриИзменении(Элемент)
	
	ТекущаяСтрока = ЭлементыФормы.Товар.ТекущаяСтрока;
	ТекущаяСтрока.КодТовара		= Элемент.Значение.Код;
	ТекущаяСтрока.Коэффициент	= Элемент.Значение.Коэффициент;
	
КонецПроцедуры

