Перем СоответствиеВидовДокументов ;

Процедура ПоказатьИсторию()
	
	ИсторияИзменений.Очистить();
	
	ТЗИстории = ОбщегоНазначения.ПолучитьИсториюИзмененийДокумента(Ссылка);
	Если НЕ ТЗИстории = Неопределено Тогда
		ЭлементыФормы.ИсторияИзменений.Значение = ТЗИстории;
	КонецЕсли;
	
КонецПроцедуры

Процедура СоставПриВыводеСтроки(Элемент, ОформлениеСтроки, ДанныеСтроки)
	
	Если ДанныеСтроки.СуммаЗакупБезНДСАптеки <> ДанныеСтроки.СуммаЗакупБезНДСОфиса Тогда
		ОформлениеСтроки.ЦветФона = WebЦвета.Томатный;	
	КонецЕсли;
	
	ОформлениеСтроки.Ячейки.ВидДокумента.УстановитьТекст(СоответствиеВидовДокументов[ДанныеСтроки.ТипДокумента]);
	
	
КонецПроцедуры

Процедура ПанельШапкиПриСменеСтраницы(Элемент, ТекущаяСтраница)
	
	Если Элемент.ТекущаяСтраница = Элемент.Страницы.История Тогда
		ПоказатьИсторию();
	КонецЕсли;
	
	
КонецПроцедуры

Процедура КомПанельСоставакнОткрытьДокумент(Кнопка)
	
	ТекСтрока = ЭлементыФормы.Состав.ТекущаяСтрока;
	Запрос = Новый Запрос;
	
	Если ТекСтрока.ТипДокумента = 200 Тогда
		ГуидДок = Новый УникальныйИдентификатор(ТекСтрока.ИДДокумента);
		Док = Документы.УЗ_ВводОстатков.ПолучитьСсылку(ГуидДок);
		Док.ПолучитьФорму("ФормаДокумента").Открыть();	
		Возврат;
	ИначеЕсли ТекСтрока.ТипДокумента = 201 Тогда
		ГуидДок = Новый УникальныйИдентификатор(ТекСтрока.ИДДокумента);
		Док = Документы.УЗ_ПоступлениеТовара.ПолучитьСсылку(ГуидДок);
		Док.ПолучитьФорму("ФормаДокумента").Открыть();
		Возврат;
	ИначеЕсли ТекСтрока.ТипДокумента = 202 Тогда
		Запрос.Текст = "ВЫБРАТЬ
		               |	Док.Ссылка
		               |ИЗ
		               |	Документ.УЗ_Торг2 КАК Док
		               |ГДЕ
		               |	Док.Дата МЕЖДУ &Дата1 И &Дата2
		               |	И Док.ИДДокументаАптеки = &ИДДокумента
		               |	И Док.Проведен = ИСТИНА";
	ИначеЕсли ТекСтрока.ТипДокумента = 204 Тогда
		Запрос.Текст = "ВЫБРАТЬ
		               |	Док.Ссылка
		               |ИЗ
		               |	Документ.УЗ_ВозвратОтПокупателя КАК Док
		               |ГДЕ
		               |	Док.Дата МЕЖДУ &Дата1 И &Дата2
		               |	И Док.ИДДокументаАптеки = &ИДДокумента
		               |	И Док.Проведен = ИСТИНА";
	ИначеЕсли ТекСтрока.ТипДокумента = 205 Тогда
		Запрос.Текст = "ВЫБРАТЬ
		               |	Док.Ссылка
		               |ИЗ
		               |	Документ.УЗ_Перемещение КАК Док
		               |ГДЕ
		               |	Док.ИДДокументаАптекиПолучатель = &ИДДокумента
		               |	";

	ИначеЕсли ТекСтрока.ТипДокумента = 206 Тогда
		Запрос.Текст = "ВЫБРАТЬ
		               |	Док.Ссылка
		               |ИЗ
		               |	Документ.УЗ_Перемещение КАК Док
		               |ГДЕ
		               |	Док.ИДДокументаАптекиОтправитель = &ИДДокумента
		               |	";
	ИначеЕсли ТекСтрока.ТипДокумента = 209 Тогда
		Запрос.Текст = "ВЫБРАТЬ
		               |	Док.Ссылка
		               |ИЗ
		               |	Документ.УЗ_ВозвратТовара КАК Док
		               |ГДЕ
		               |	Док.Дата МЕЖДУ &Дата1 И &Дата2
		               |	И Док.ИДДокументаАптеки = &ИДДокумента
		               |	";
	ИначеЕсли ТекСтрока.ТипДокумента = 211 Тогда
		Запрос.Текст = "ВЫБРАТЬ
		               |	Док.Ссылка
		               |ИЗ
		               |	Документ.УЗ_МелкооптоваяРеализация КАК Док
		               |ГДЕ
		               |	Док.Дата МЕЖДУ &Дата1 И &Дата2
		               |	И Док.ИДДокументаАптеки = &ИДДокумента
		               |	";

	ИначеЕсли ТекСтрока.ТипДокумента = 212 Тогда
		Запрос.Текст = "ВЫБРАТЬ
		               |	Док.Ссылка
		               |ИЗ
		               |	Документ.УЗ_Списание КАК Док
		               |ГДЕ
		               |	Док.Дата МЕЖДУ &Дата1 И &Дата2
		               |	И Док.ИДДокументаАптеки = &ИДДокумента
		               |	";
	ИначеЕсли ТекСтрока.ТипДокумента = 213 Тогда
		Запрос.Текст = "ВЫБРАТЬ
		               |	Док.Ссылка
		               |ИЗ
		               |	Документ.УЗ_АрбитражПомещение КАК Док
		               |ГДЕ
		               |	Док.Дата МЕЖДУ &Дата1 И &Дата2
		               |	И Док.ИДДокументаАптеки = &ИДДокумента
		               |	";
	ИначеЕсли ТекСтрока.ТипДокумента = 214 Тогда
		Запрос.Текст = "ВЫБРАТЬ
		               |	Док.Ссылка
		               |ИЗ
		               |	Документ.УЗ_АрбитражИзъятие КАК Док
		               |ГДЕ
		               |	Док.Дата МЕЖДУ &Дата1 И &Дата2
		               |	И Док.ИДДокументаАптеки = &ИДДокумента
		               |	";

	ИначеЕсли ТекСтрока.ТипДокумента = 215 Тогда
		Запрос.Текст = "ВЫБРАТЬ
		               |	Док.Ссылка
		               |ИЗ
		               |	Документ.УЗ_Инвентаризация КАК Док
		               |ГДЕ
		               |	Док.Дата МЕЖДУ &Дата1 И &Дата2
		               |	И Док.Проведен = ИСТИНА
		               |	И Док.ИДДокументаАптеки = &ИДДокумента";
	ИначеЕсли ТекСтрока.ТипДокумента = 216 Тогда
		Запрос.Текст = "ВЫБРАТЬ
		               |	Док.Ссылка
		               |ИЗ
		               |	Документ.УЗ_Разбраковка КАК Док
		               |ГДЕ
		               |	Док.Дата МЕЖДУ &Дата1 И &Дата2
		               |	И Док.Проведен = ИСТИНА
		               |	И Док.ИДДокументаАптеки = &ИДДокумента";
	ИначеЕсли ТекСтрока.ТипДокумента = 217 Тогда
		Запрос.Текст = "ВЫБРАТЬ
		               |	Док.Ссылка
		               |ИЗ
		               |	Документ.УЗ_КорректировкаНедовоза КАК Док
		               |ГДЕ
		               |	Док.Дата МЕЖДУ &Дата1 И &Дата2
		               |	И Док.Проведен = ИСТИНА
		               |	И Док.ИДДокументаАптеки = &ИДДокумента";
	ИначеЕсли ТекСтрока.ТипДокумента = 218 Тогда
		Запрос.Текст = "ВЫБРАТЬ
		               |	Док.Ссылка
		               |ИЗ
		               |	Документ.УЗ_Трансформация КАК Док
		               |ГДЕ
		               |	Док.Дата МЕЖДУ &Дата1 И &Дата2
		               |	И Док.Проведен = ИСТИНА
		               |	И Док.ИДДокументаАптеки = &ИДДокумента";


	ИначеЕсли ТекСтрока.ТипДокумента = 300 Тогда
		Запрос.Текст = "ВЫБРАТЬ
		               |	УЗ_РеализацияККМ.Ссылка
		               |ИЗ
		               |	Документ.УЗ_РеализацияККМ КАК УЗ_РеализацияККМ
		               |ГДЕ
		               |	УЗ_РеализацияККМ.Дата МЕЖДУ &Дата1 И &Дата2
		               |	И УЗ_РеализацияККМ.GuidСмены = &ИДДокумента
		               |	И УЗ_РеализацияККМ.Проведен = ИСТИНА";
		
	КонецЕсли;
	
	Запрос.УстановитьПараметр("Дата1",НачалоПериода);
	Запрос.УстановитьПараметр("Дата2",КонецДня(КонецПериода));
	Запрос.УстановитьПараметр("ИДДокумента",СокрЛП(ТекСтрока.ИДДокумента));
	Рез = Запрос.Выполнить();
	Если Рез.Пустой() Тогда
		Предупреждение("По текущей строке не найден документ");	
		Возврат;
	КонецЕсли;
	
	Выборка = Рез.Выбрать();
	Выборка.Следующий();
	Выборка.Ссылка.ПолучитьФорму("ФормаДокумента").Открыть();
	
	
КонецПроцедуры

Процедура СоставПриАктивизацииСтроки(Элемент)
	
	//ТекСтрока = ЭлементыФормы.Состав.ТекущаяСтрока;
	//Если ТекСтрока.ТипДокумента = 201 
	//	или ТекСтрока.ТипДокумента = 300  Тогда
	//	ЭлементыФормы.КомПанельСостава.Кнопки.кнОткрытьДокумент.Доступность = Истина;	
	//Иначе
	//	ЭлементыФормы.КомПанельСостава.Кнопки.кнОткрытьДокумент.Доступность = Ложь;
	//КонецЕсли;
	
КонецПроцедуры

СоответствиеВидовДокументов = Новый Соответствие;
СоответствиеВидовДокументов.Вставить(200,	"Ввод остатков" );
СоответствиеВидовДокументов.Вставить(201,	"Поступление");
СоответствиеВидовДокументов.Вставить(202,	"Торг-2");
СоответствиеВидовДокументов.Вставить(204,	"Возврат от покупателя");
СоответствиеВидовДокументов.Вставить(205,	"Перемещение входящее");
СоответствиеВидовДокументов.Вставить(206,	"Перемещение исходящее");
СоответствиеВидовДокументов.Вставить(207,	"Переоценка");
СоответствиеВидовДокументов.Вставить(209,	"Возврат поставщику");
СоответствиеВидовДокументов.Вставить(211,	"Реализация мелкооптовая");
СоответствиеВидовДокументов.Вставить(212,	"Списание");
СоответствиеВидовДокументов.Вставить(213,	"Помещение в арбитраж");
СоответствиеВидовДокументов.Вставить(214,	"Извлечение из арбитража");
СоответствиеВидовДокументов.Вставить(215,	"Инвентаризация");
СоответствиеВидовДокументов.Вставить(216,	"Извлечение из брака");
СоответствиеВидовДокументов.Вставить(217,	"Извлечение из недовоза");
СоответствиеВидовДокументов.Вставить(218,	"Трансформация товара");
СоответствиеВидовДокументов.Вставить(300,	"Выручка");
