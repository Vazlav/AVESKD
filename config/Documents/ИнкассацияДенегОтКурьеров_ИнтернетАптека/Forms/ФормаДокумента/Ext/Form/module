
Процедура КоманднаяПанель1Заполнить(Кнопка)
	 Запрос=Новый Запрос("ВЫБРАТЬ
	                     |	УчетДенегВИнтернетАптекеОстатки.ЗаказОтПокупателя,
	                     |	УчетДенегВИнтернетАптекеОстатки.СуммаОстаток КАК сумма,
	                     |	УчетДенегВИнтернетАптекеОстатки.СуммаОстаток КАК СуммаФакт
	                     |ПОМЕСТИТЬ ИзРегистра
	                     |ИЗ
	                     |	РегистрНакопления.УчетДенегВИнтернетАптеке.Остатки(
	                     |			,
	                     |			Фирма = &Фирма
	                     |				И Склад = &Склад
	                     |				И Курьер = &Курьер) КАК УчетДенегВИнтернетАптекеОстатки
	                     |;
	                     |
	                     |////////////////////////////////////////////////////////////////////////////////
	                     |ВЫБРАТЬ
	                     |	СУММА(ЧекПродажиАвансыПоУслугам.Сумма) КАК СуммаУслуг,
	                     |	ЧекПродажиАвансыПоУслугам.Ссылка.ДокументОснование КАК Заказ
	                     |ПОМЕСТИТЬ услуги
	                     |ИЗ
	                     |	ИзРегистра КАК ИзРегистра
	                     |		ВНУТРЕННЕЕ СОЕДИНЕНИЕ Документ.ЧекПродажи.АвансыПоУслугам КАК ЧекПродажиАвансыПоУслугам
	                     |		ПО ИзРегистра.ЗаказОтПокупателя = ЧекПродажиАвансыПоУслугам.Ссылка.ДокументОснование
	                     |
	                     |СГРУППИРОВАТЬ ПО
	                     |	ЧекПродажиАвансыПоУслугам.Ссылка.ДокументОснование
	                     |;
	                     |
	                     |////////////////////////////////////////////////////////////////////////////////
	                     |ВЫБРАТЬ
	                     |	ИзРегистра.ЗаказОтПокупателя как ЗаказОтПокупателя,
	                     |	ИзРегистра.сумма,
	                     |	ИзРегистра.СуммаФакт,
	                     |	ЕСТЬNULL(услуги.СуммаУслуг, 0) КАК Доставка,
	                     |	ИзРегистра.ЗаказОтПокупателя.ТипИсточника как ТипИсточника,
	                     |	ИзРегистра.ЗаказОтПокупателя.НомерЗаказа как НомерЗаказа,
	                     |	ИзРегистра.ЗаказОтПокупателя.ДатаЗаказа как ДатаЗаказа
	                     |ИЗ
	                     |	ИзРегистра КАК ИзРегистра
	                     |		ЛЕВОЕ СОЕДИНЕНИЕ услуги КАК услуги
	                     |		ПО ИзРегистра.ЗаказОтПокупателя = услуги.Заказ
	                     |;
	                     |
	                     |////////////////////////////////////////////////////////////////////////////////
	                     |УНИЧТОЖИТЬ ИзРегистра
	                     |;
	                     |
	                     |////////////////////////////////////////////////////////////////////////////////
	                     |УНИЧТОЖИТЬ услуги");
	
	Запрос.УстановитьПараметр("Фирма",Фирма);
	Запрос.УстановитьПараметр("Склад",Склад);
	Запрос.УстановитьПараметр("Курьер",Курьер);
	
	Заказы.Загрузить(Запрос.Выполнить().Выгрузить());
	
	
	
КонецПроцедуры

Процедура СкладПриИзменении(Элемент)
	
	Если Фирма<>Склад.Фирма Тогда
		Фирма=Склад.Фирма;
	КонецЕсли;	
	
	
КонецПроцедуры

Процедура КурьерПриИзменении(Элемент)
	Заказы.Очистить();
КонецПроцедуры

Процедура ЗаказыВозвратНеВДеньПокупкиОткрытие(Элемент, СтандартнаяОбработка)
	Сообщить(Элемент);// Вставить содержимое обработчика.
КонецПроцедуры

Процедура ЗаказыСуммаФактПриИзменении(Элемент)
	// Вставить содержимое обработчика.
КонецПроцедуры

Процедура КоманднаяПанель1СоздатьВозвратыПоОтказам(Кнопка)
	
	стр=ЭлементыФормы.Заказы.ТекущаяСтрока;
	
	
		
			Если стр.Отказ<>Истина Тогда
				Если стр.ВозвратНеВДеньПокупки.Пустая()=Истина тогда
					ДокВозврата=Документы.ВозвратОтПокупателя.СоздатьДокумент();
					ДокВозврата.Заполнить(Стр.ЗаказОтПокупателя);
					ФормаВозврата=ДокВозврата.ПолучитьФорму("ФормаДокумента");
					
					ФормаВозврата.ОткрытьМодально(); // создаем возврат
					
					//---- заполним по созданному возврату ---------------------------------------------------------------
					Стр.ВозвратНеВДеньПокупки=ДокВозврата.Ссылка;
					Стр.Отказ=Истина;
					Стр.СуммаФакт=Стр.Сумма-ДокВозврата.Товар.Итог("СуммаРозн")-ДокВозврата.Товар.Итог("СуммаСкидки");
					
				КонецЕсли;
			КонецЕсли;
		
		
		
		
		
		
		
	
	
	
	
	
	
	
	
КонецПроцедуры

Процедура ПриОткрытии()
	Если ЭтоНовый() тогда
		Дата=ТекущаяДата();
	КонецЕсли;	
КонецПроцедуры

Процедура ОбновлениеОтображения()
	
	ЭлементыФормы.СуммаИтого.Заголовок=Заказы.Итог("СуммаФакт")+Заказы.Итог("Доставка");
	
	
КонецПроцедуры
