
Процедура КоманднаяПанель1Полная_Очистка_арбитража(Кнопка)
	
	Если Склад.Пустая()=Истина Тогда
		Предупреждение("Не указан склад!");
	    Возврат;
	КонецЕсли; 
	
	Если Товар.Количество()<>0 Тогда
		Если Вопрос("Таблица документа будет очищена! Продолжить операцию?",РежимДиалогаВопрос.ДаНет,0,КодВозвратаДиалога.Нет,"Очистить таблицу товара?")=КодВозвратаДиалога.Нет Тогда
			Возврат;
		КонецЕсли; 	
	КонецЕсли;
	
	
	
	
	
	Товар.Очистить();
	
	Комментарий="#AUTO# Подготовка к инвентаризации. "+ТекущаяДата();
	ВидДвиженияАрбитража=Перечисления.ВидыДвиженийАрбитража.ВозвратИзАрбитража;
	
	   //-------------------- Запрос by GtG -----------------------
	   // Назначение: Все остатки по арбитражу в документ
	   //----------------------------------------------------------
	   ТХТ="ВЫБРАТЬ
	       |	АрбитражОстатки.Товар,
	       |	АрбитражОстатки.Склад,
	       |	АрбитражОстатки.Партия,
	       |	АрбитражОстатки.СтавкаНДС,
	       |	АрбитражОстатки.Фирма,
		   |	1 как Коэфф,
	       |	СУММА(АрбитражОстатки.КолвоОстаток) КАК Колво,
	       |	СУММА(АрбитражОстатки.СуммаЗакупСНДСОстаток) КАК СуммаЗакупСНДС,
	       |	СУММА(АрбитражОстатки.СуммаНДСЗакупОстаток) КАК СуммаНДСЗакуп,
	       |	СУММА(АрбитражОстатки.СуммаРознСНДСОстаток) КАК СуммаРознСНДС,
	       |	СУММА(АрбитражОстатки.СуммаРознНДСОстаток) КАК СуммаРознНДС
	       |ИЗ
	       |	РегистрНакопления.Арбитраж.Остатки(
	       |			&Дата,
	       |			Склад = &Склад
	       |				И Фирма = &Фирма) КАК АрбитражОстатки
	       |
	       |СГРУППИРОВАТЬ ПО
	       |	АрбитражОстатки.Товар,
	       |	АрбитражОстатки.Склад,
	       |	АрбитражОстатки.Партия,
	       |	АрбитражОстатки.СтавкаНДС,
	       |	АрбитражОстатки.Фирма
	       |
	       |УПОРЯДОЧИТЬ ПО
	       |	АрбитражОстатки.Товар.Наименование";
	   
	   Запрос=Новый Запрос;
	   Запрос.Текст=ТХТ;
	   Запрос.УстановитьПараметр("Дата",Дата);
	   Запрос.УстановитьПараметр("Склад",Склад);
	   Запрос.УстановитьПараметр("Фирма",Склад.Фирма);
	   
	   
	   //----------------------------------------------------------
	   
	   ТОвар.Загрузить(Запрос.Выполнить().Выгрузить());
	   
	   Для каждого  Стр  Из  Товар Цикл
		   Стр.ПричинаПомещенияВАрбитраж=Комментарий;
	   КонецЦикла; 
	
КонецПроцедуры

Процедура ПередОткрытием(Отказ, СтандартнаяОбработка)
	

	
	
КонецПроцедуры
