
Процедура КнопкаСформироватьНажатие(Кнопка)
	
	
	// Вставить содержимое обработчика.
ГраницаВыборки=Новый Граница(КонецДня(ВыбДата),ВидГраницы.Включая);
СписокСПометками = Новый СписокЗначений;
Для каждого ЭлементСписка из СписокПоставщиков Цикл
	Если ЭлементСписка.Пометка Тогда
		СписокСПометками.Добавить(ЭлементСписка.Значение);	
	КонецЕсли;
КонецЦикла;

ТекстЗапроса = "ВЫБРАТЬ РАЗЛИЧНЫЕ
               |	ЗаказПоставщикуОстатки.Поставщик КАК Поставщик,
               |	ЗаказПоставщикуОстатки.Товар КАК Товар,
               |	СУММА(ЗаказПоставщикуОстатки.КоличествоОстаток) КАК КоличествоОстаток
               |ИЗ
               |	РегистрНакопления.ЗаказПоставщику.Остатки(&ГраницаВыборки, ) КАК ЗаказПоставщикуОстатки
               |ГДЕ
               |	ЗаказПоставщикуОстатки.Поставщик В(&_СписокПоставщиков)
               |
               |СГРУППИРОВАТЬ ПО
               |	ЗаказПоставщикуОстатки.Товар,
               |	ЗаказПоставщикуОстатки.Поставщик
               |
               |УПОРЯДОЧИТЬ ПО
               |	Поставщик,
               |	Товар
               |ИТОГИ
               |	СУММА(КоличествоОстаток)
               |ПО
               |	Поставщик,
               |	Товар";

Запрос=Новый Запрос();
Запрос.Текст=ТекстЗапроса;
Запрос.УстановитьПараметр("ГраницаВыборки",ГраницаВыборки);
Запрос.УстановитьПараметр("_СписокПоставщиков",СписокСПометками);


РезЗапроса=Запрос.Выполнить();

Если РезЗапроса.Пустой() Тогда
	Предупреждение("С указанными параметрами запрос выдал пустой результат!");
	Возврат;
КонецЕсли;	

Выб1=РезЗапроса.Выбрать(ОбходРезультатаЗапроса.ПоГруппировкам,"Поставщик");

Макет = ЭтотОбъект.ПолучитьМакет( "Отчет");

ТД=Новый ТабличныйДокумент;
Шапка=Макет.ПолучитьОбласть("Шапка");

Шапка.Параметры.Титул = "Отчет на дату = " + ВыбДата;
ТД.Вывести(Шапка);


Х=0;
Пока Выб1.Следующий() Цикл //Фирма
	ГруппаПост = Макет.ПолучитьОбласть("Группа");
	ГруппаПост.Параметры.Поставщик = Выб1.Поставщик;
	ТД.Вывести(ГруппаПост);
	
	Выб2 = Выб1.Выбрать(ОбходРезультатаЗапроса.ПоГруппировкам,"Товар");
	Пока Выб2.Следующий() Цикл	
		Х = Х + 1;
		Строка = Макет.ПолучитьОбласть("Строка");
		Строка.Параметры.Номер = Х;
		Строка.Параметры.Номенклатура = Выб2.Товар;
		Строка.Параметры.Количество = Выб2.КоличествоОстаток;
		ТД.Вывести(Строка);
	КонецЦикла;
	
КонецЦикла;
ТД.Показать("Остаток заказанного товара")
	
КонецПроцедуры

Процедура ДобавитьНажатие(Элемент)
	ФормаВыбора = Справочники.Поставщики.ПолучитьФормуВыбора(,ЭтаФорма);
	ФормаВыбора.РежимВыбора = Истина;
	ФормаВыбора.ЗакрыватьПриВыборе = Ложь;
	ФормаВыбора.Открыть();
КонецПроцедуры

Процедура ОбработкаВыбора(ЗначениеВыбора, Источник)
	//Сообщить(ЗначениеВыбора);
	СписокПоставщиков.Добавить(ЗначениеВыбора,,Истина);
КонецПроцедуры

Процедура СписокПоставщиковВыбор(Элемент, ЭлементСписка)
	Если ЭлементСписка.Пометка Тогда
		ЭлементСписка.Пометка = Ложь;
	Иначе
		ЭлементСписка.Пометка = Истина;
	КонецЕсли;
КонецПроцедуры

Процедура УдалитьНажатие(Элемент)
	Попытка
		СписокПоставщиков.Удалить(ЭлементыФормы.СписокПоставщиков.ТекущаяСтрока);
	Исключение
	КонецПопытки
	
КонецПроцедуры

