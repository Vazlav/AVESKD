Процедура СформироватьОтчет(ДатаОтчета)
	
	
	 Построитель.Параметры.Очистить();
	 Построитель.Параметры.Вставить("ПУстаяДата",ОМ3_ПустаяДата());
	 Построитель.Параметры.Вставить("Сейчас",ДатаОтчета);
	
	 Построитель.Выполнить();
	 
	
	
	 
	 //Запрос=Новый Запрос;
	 //Запрос.Текст=ТХТ;
	 Рез=Построитель.Результат.Выгрузить();//Запрос.Выполнить().Выгрузить();
	 
	 
	 
	 Таб=ЭлементыФормы.Таб;
	 Таб.Очистить();
	 
	 Мак= ЭтотОбъект.ПолучитьМакет("Макет");
	 Секция=Мак.ПолучитьОбласть("Шапка|Основная");
	 Секция.Параметры.ТекДата=Формат(ТекущаяДата(),"ДФ='dd.MM.yy HH:mm'");
	 Таб.Вывести(Секция);
	 Таб.НачатьГруппуКолонок("Доп",ложь);
	 Секция=Мак.ПолучитьОбласть("Шапка|Доп");
	 Таб.Присоединить(Секция);
	 Таб.ЗакончитьГруппуКолонок();
	 
	 
	 
	 ТекРег="";
	 
	 НН=0;
	 Для Каждого Стр из Рез Цикл
		 НН=НН+1;
		 
		 Если Стр.КодРегиона<>ТекРег Тогда
			 ТекРег=Стр.КодРегиона;
			 СекцияРег=Мак.ПолучитьОбласть("Регион");
			 СекцияРег.Параметры.Регион=Стр.Регион;
			 Таб.Вывести(СекцияРег);
		 КонецЕсли;
		 
		 Секция=Мак.ПолучитьОбласть("Строка");
		 
		 Секция.Параметры.нн	=	НН;
		 Секция.Параметры.НомерАптеки	=	Стр.НомерАптеки;
		 Секция.Параметры.Фирма	=	Стр.Фирма;
		 Секция.Параметры.МестоРасположения	=	Стр.МестоРасположения;
		 Секция.Параметры.ДатаПерехода	=	Стр.ДатаПерехода;
		 Секция.Параметры.НаименованиеПоКлассификатору	=	Стр.НаименованиеПоКлассификатору;
		 Секция.Параметры.Адрес	=	СокрЛП(Стр.Город)+", "+СокрЛП(Стр.Улица)+", "+СокрЛП(Стр.Дом);
		 Секция.Параметры.Метро	= Стр.Метро;
		 Секция.Параметры.ТелефонДляСправки	 = стр.ТелефонДляСправки;
		 Секция.Параметры.Мэйл	 = стр.Мэйл;
		 Секция.Параметры.ГрафикИнкассации = стр.ГрафикИнкассации;
		 
		 Стр.ТелефоныСотрудников.Сортировать("НачПериодаЗаведования Desc");
		 
		 Если  Стр.ТелефоныСотрудников.Количество()>0 Тогда
			 Секция.Параметры.Зав	=Стр.ТелефоныСотрудников.Получить(0).ФИО;
			 Секция.Параметры.ТелЗав	= Стр.ТелефоныСотрудников.Получить(0).Телефон;
		 Иначе
			 Секция.Параметры.Зав	="";
			 Секция.Параметры.ТелЗав	= "";
			 
		 КонецЕсли;
		 Секция.Параметры.РежимРаботы	= Стр.РежимРаботы;
		 Секция.Параметры.ОбщаяПлощадь	 = Стр.ОбщаяПлощадь;
		 Секция.Параметры.ПлощадьТорговогоЗала	= Стр.ПлощадьТорговогоЗала;
		 Секция.Параметры.ГруппаТТ = 	Стр . ГруппаТТ;
		 
		 Секция.Параметры.Код = стр.Код;
		 Секция.Параметры.Склад=Стр.Ссылка;
		 Секция.Параметры.СкладДляКадров = Новый Структура("Ссылка",Стр.Ссылка);
		 
		 Таб.Вывести(Секция);
	 КонецЦикла;	 
	 
	 Таб.ОтображатьСетку=Ложь;
	 Таб.ТолькоПросмотр=Истина;
	 Таб.ОтображатьЗаголовки=Ложь;
	 Таб.ФиксацияСверху = 3;
	 Таб.ОриентацияСтраницы=ОриентацияСтраницы.Ландшафт;
	 Таб.АвтоМасштаб=Истина;
	 
	 ТАб.Показать();
	 
	 
	
КонецПроцедуры	







Процедура КнопкаВыполнитьНажатие(Кнопка)
	   СформироватьОтчет(ТекущаяДата());
 КонецПроцедуры

 Процедура ПриОткрытии()
	 КнопкаВыполнитьНажатие("");
 КонецПроцедуры

 Процедура ТабОбработкаРасшифровки(Элемент, Расшифровка, СтандартнаяОбработка)
	 
	 Если ТипЗнч(Расшифровка) = Тип("Структура") Тогда
		 СтандартнаяОбработка=ложь;
		ТекЭлемент = Расшифровка.Ссылка; 
		ФормаЭл = ТекЭлемент.ПолучитьФорму("ФормаДляКадров"); 
		ФормаЭл.Открыть();		 
	ИначеЕсли Найти(Расшифровка,"@")<>0 Тогда
		 СтандартнаяОбработка=ложь;
		 ЗапуститьПриложение("mailto:"+Расшифровка);
	 КонецЕсли;
	 
 КонецПроцедуры

 Процедура ОсновныеДействияФормыВсеАптеки(Кнопка)
	  СформироватьОтчет('21001231235959');
 КонецПроцедуры
 
 
ТХТ= "ВЫБРАТЬ
     |	МестаХранения.НомерАптеки,
     |	МестаХранения.Фирма,
     |	МестаХранения.МестоРасположения,
     |	МестаХранения.ДатаПерехода КАК ДатаПерехода,
     |	МестаХранения.НаименованиеПоКлассификатору КАК НаименованиеПоКлассификатору,
     |	МестаХранения.Город,
     |	МестаХранения.Улица,
     |	МестаХранения.Дом,
     |	МестаХранения.Метро,
     |	МестаХранения.ТелефонДляСправки,
     |	МестаХранения.Мэйл,
     |	МестаХранения.РежимРаботы,
     |	МестаХранения.Код,
     |	МестаХранения.ОбщаяПлощадь,
     |	МестаХранения.ПлощадьТорговогоЗала,
     |	МестаХранения.ГруппаТТ,
     |	МестаХранения.Заведующие.(
     |		ФИО,
     |		Телефон,
     |		НачПериодаЗаведования,
     |		КонПериодаЗаведования
     |	) КАК ТелефоныСотрудников,
     |	МестаХранения.Регион КАК Регион,
     |	МестаХранения.Регион.Код КАК КодРегиона,
     |	МестаХранения.Ссылка,
     |	МестаХранения.ГрафикИнкассации
     |ИЗ
     |	Справочник.МестаХранения КАК МестаХранения
     |ГДЕ
     |	МестаХранения.ПометкаУдаления = ЛОЖЬ
     |	И МестаХранения.ДатаЗакрытия = &пустаяДата
     |	И МестаХранения.ТипСклада = ЗНАЧЕНИЕ(Перечисление.ТипыМХ.Розн)
     |	И (НЕ МестаХранения.Наименование ПОДОБНО ""%Фитобар%"")
     |	И МестаХранения.ДатаПерехода <= &Сейчас
     |{ГДЕ
     |	МестаХранения.НомерАптеки,
     |	МестаХранения.МестоРасположения.*,
     |	МестаХранения.ДатаПерехода КАК Дата_открытия,
     |	МестаХранения.НаименованиеПоКлассификатору,
     |	МестаХранения.Город.*,
     |	МестаХранения.Улица,
     |	МестаХранения.Дом,
     |	МестаХранения.Метро.*,
     |	МестаХранения.ТелефонДляСправки,
     |	МестаХранения.Мэйл,
     |	МестаХранения.РежимРаботы.*,
     |	МестаХранения.Код,
     |	МестаХранения.ОбщаяПлощадь,
     |	МестаХранения.ПлощадьТорговогоЗала,
     |	МестаХранения.ГруппаТТ.*,
     |	МестаХранения.Регион.*}
     |
     |УПОРЯДОЧИТЬ ПО
     |	КодРегиона,
     |	НаименованиеПоКлассификатору" ;
		 
		 
Построитель.Текст=ТХТ;

