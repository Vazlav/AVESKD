
Процедура Сформировать(НачПериода="00010101",КонПериода="00010101",Авто=Истина)
	ЭлементыФормы.ПТД.Очистить();
	Запрос=новый Запрос;
	
	Тхт="ВЫБРАТЬ
		|	Новость.АктуальнаДо КАК ДатаДок,
		|	Новость.Текст КАК ТекстДок,
		|	Новость.Номер КАК НомерДок,
		|	Новость.Дата КАК АктуальнаДо
		|ИЗ
		|	Документ.Новость КАК Новость
		|ГДЕ
		|";
	Если Авто=Истина тогда
		
		
		Тхт=Тхт+"Новость.АктуальнаДо >= &АктуальнаДо
		|";
		Запрос.УстановитьПараметр("АктуальнаДо",ТекущаяДата());
	Иначе
		Тхт=Тхт+"Новость.Дата Между &НачПериода и  &КонПериода
		|";
		Запрос.УстановитьПараметр("НачПериода",НачПериода );
		Запрос.УстановитьПараметр("КонПериода",КонПериода);
	КонецЕсли; 
	
	Тхт=Тхт+"УПОРЯДОЧИТЬ ПО
		|	ДатаДок УБЫВ";
	
	Запрос.Текст=ТХТ;
	ТЗ=Запрос.Выполнить().Выгрузить();	
	
	МАк= ЭтотОбъект.ПолучитьМакет("Макет");
	Заг=Мак.ПолучитьОбласть("Шапка");
	С=Мак.ПолучитьОбласть("Строка");
	
	Если ТЗ.Количество()=0 Тогда
		ЭтаФорма.Закрыть();
	КонецЕсли; 	
	
	Для каждого Стр из ТЗ Цикл
		Заг.Параметры.ДатаДок=Стр.ДатаДок;
		Заг.Параметры.НомерДок=Стр.НомерДок;
		ЭлементыФормы.ПТД.Вывести(Заг);
		
		С.Параметры.Текст=Стр.ТекстДок;
		
		ЭлементыФормы.ПТД.Вывести(С);
	КонецЦикла;	 
	
	
	ЭлементыФормы.ПТД.ТолькоПросмотр=Истина;
	ЭлементыФормы.ПТД.ОтображатьСетку=Ложь;
	ЭлементыФормы.ПТД.ОтображатьЗаголовки=Ложь;
	ЭлементыФормы.ПТД.АвтоМасштаб=Истина;
	ЭлементыФормы.ПТД.Показать();
	
	
КонецПроцедуры

Процедура КоманднаяПанель1Действие2(Кнопка)
	ЭлементыФормы.ПТД.Очистить();
	ПриОткрытии();
КонецПроцедуры

Процедура КоманднаяПанель1ЗаПериод(Кнопка)
	НачПериода = ОМ3_ПустаяДата ();
	КонПериода = ОМ3_ПустаяДата ();
	
	НастройкаПериода = Новый НастройкаПериода;
	НастройкаПериода.УстановитьПериод(НачПериода, ?(КонПериода='0001-01-01', КонПериода, КонецДня(КонПериода)));
	НастройкаПериода.РедактироватьКакИнтервал = Истина;
	НастройкаПериода.РедактироватьКакПериод = Истина;
	НастройкаПериода.ВариантНастройки = ВариантНастройкиПериода.Период;
	Если НастройкаПериода.Редактировать() Тогда
		НачПериода = НастройкаПериода.ПолучитьДатуНачала();
		КонПериода = НастройкаПериода.ПолучитьДатуОкончания();
	КонецЕсли;
	
	Сформировать(НачПериода,КонПериода,FALSE);

	
КонецПроцедуры

Процедура ПриОткрытии()
	Сформировать();// запуск с параметрами по умолчанию
КонецПроцедуры

Процедура ПередОткрытием(Отказ, СтандартнаяОбработка)
	
	Если РольДоступна("ЧужаяСправочнаяСлужба") Тогда
		Отказ=Истина; // чужой справке нефиг глазеть на наши внутренние новости
	КонецЕсли; 	
	
	
КонецПроцедуры


