
Процедура КнопкаСформироватьНажатие(Кнопка)
	
	
	НП=Построитель.Отбор.Найти("НачПериода");
	Если НП= Неопределено Тогда
		НП=Построитель.Отбор.Добавить("НачПериода");
	КонецЕсли;
	
	НП.Значение=НачалоДня(НачПериода);
	
	
	
	
	КП=Построитель.Отбор.Найти("КонПериода");
	Если КП= Неопределено Тогда
		КП=Построитель.Отбор.Добавить("КонПериода");
	КонецЕсли;
	
	КП.Значение=КонецДня(КонПериода);
	
	
	
	
	
	
	
	
	
	
	
	//------------------<Вывод результатов построителя>-------------------GtG----03.10.08
	Оформление = ПолучитьМакетОформления(СтандартноеОформление.Классика);
	Построитель.МакетОформления = Оформление;
	Построитель.ОформитьМакет();
	
	Построитель.Выполнить();
	Построитель.Вывести();
	//--------------------------------------------------------GtG----КОНЕЦ--03.10.08
			
		
	
КонецПроцедуры

Процедура ВыбПериодНажатие(Элемент)
	НастройкаПериода = Новый НастройкаПериода;
	НастройкаПериода.УстановитьПериод(НачПериода, ?(КонПериода='0001-01-01', КонПериода, КонецДня(КонПериода)));
	НастройкаПериода.РедактироватьКакИнтервал = Истина;
	НастройкаПериода.РедактироватьКакПериод = Истина;
	НастройкаПериода.ВариантНастройки = ВариантНастройкиПериода.Период;
	Если НастройкаПериода.Редактировать() Тогда
		НачПериода = НастройкаПериода.ПолучитьДатуНачала();
		КонПериода = НастройкаПериода.ПолучитьДатуОкончания();
	КонецЕсли;
КонецПроцедуры




ТХТ="ВЫБРАТЬ
    |	ПодарочныеСертификатыОбороты.НомерСертификата КАК НомерСертификата,
    |	ПодарочныеСертификатыОбороты.Номинал,
    |	ПодарочныеСертификатыОбороты.Регистратор.Дата КАК РегистраторДата,
    |	ПодарочныеСертификатыОбороты.Склад,
    |	СУММА(ВЫБОР
    |			КОГДА ПодарочныеСертификатыОбороты.СуммаОборот > 0
    |				ТОГДА ПодарочныеСертификатыОбороты.СуммаОборот
    |			ИНАЧЕ 0
    |		КОНЕЦ) КАК Реализация,
    |	СУММА(ВЫБОР
    |			КОГДА ПодарочныеСертификатыОбороты.СуммаОборот < 0
    |				ТОГДА ПодарочныеСертификатыОбороты.СуммаОборот
    |			ИНАЧЕ 0
    |		КОНЕЦ) КАК Зачет
    |{ВЫБРАТЬ
    |	НомерСертификата,
    |	Номинал,
    |	РегистраторДата,
    |	Склад.*,
    |	Реализация КАК Реализация,
    |	Зачет}
    |ИЗ
    |	РегистрНакопления.ПодарочныеСертификаты.Обороты({&НачПериода}, {&КонПериода}, Регистратор, ) КАК ПодарочныеСертификатыОбороты
    |{ГДЕ
    |	ПодарочныеСертификатыОбороты.НомерСертификата КАК Номер,
    |	ПодарочныеСертификатыОбороты.Номинал,
    |	ПодарочныеСертификатыОбороты.Регистратор.Дата КАК Дата,
    |	ПодарочныеСертификатыОбороты.Склад.*,
    |	ВЫБОР
    |			КОГДА ПодарочныеСертификатыОбороты.СуммаОборот > 0
    |				ТОГДА ПодарочныеСертификатыОбороты.СуммаОборот
    |			ИНАЧЕ 0
    |		КОНЕЦ КАК Реализация,
    |	ВЫБОР
    |			КОГДА ПодарочныеСертификатыОбороты.СуммаОборот < 0
    |				ТОГДА ПодарочныеСертификатыОбороты.СуммаОборот
    |			ИНАЧЕ 0
    |		КОНЕЦ КАК Зачет}
    |
    |СГРУППИРОВАТЬ ПО
    |	ПодарочныеСертификатыОбороты.НомерСертификата,
    |	ПодарочныеСертификатыОбороты.Номинал,
    |	ПодарочныеСертификатыОбороты.Регистратор.Дата,
    |	ПодарочныеСертификатыОбороты.Склад
    |
    |УПОРЯДОЧИТЬ ПО
    |	РегистраторДата,
    |	НомерСертификата
    |{УПОРЯДОЧИТЬ ПО
    |	НомерСертификата}
    |{ИТОГИ ПО
    |	НомерСертификата КАК Номер}";       
	
	Построитель.Текст=ТХТ;       
	Построитель.ВыводитьЗаголовокОтчета=Истина;
	Построитель.ВыводитьШапкуТаблицы=Истина;
	Построитель.ОбрабатыватьПрерываниеПользователя=Истина;
	Построитель.ОтображатьСостояние=Истина;
	//--------------------------------------------------------GtG----КОНЕЦ--03.10.08
