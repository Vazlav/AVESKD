
Процедура КнопкаВыполнитьНажатие(Кнопка)
	
	Если Склад.Пустая() Тогда
		Предупреждение("Не выбрана аптека. Выполнение не может быть продолжено");
		Возврат;
	КонецЕсли;
	
	Если НачПериода = Дата(1,1,1) или КонПериода = Дата(1,1,1) или НачПериода > КонПериода Тогда
		Предупреждение("Некорректно задан период. Выполнение не может быть продолжено");
		Возврат;
	КонецЕсли;
	
	
	Таб=Новый ТабличныйДокумент;
	Макет= ЭтотОбъект.ПолучитьМакет("ТоварныйОтчет");
	Обл=Макет.ПолучитьОбласть("Шапка");
	Обл.Параметры.Фирма=Фирма.ДлинноеНаименование;
	Обл.Параметры.Склад=Склад.Наименование;
	Обл.Параметры.СостДата= КонПериода+60*60*24;
	Обл.Параметры.НачПериода=НачПериода;		
	Обл.Параметры.КонПериода=КонПериода;
	Обл.Параметры.НомерДокТО=НомерТО;
	
	Таб.Вывести(Обл);
	
	
	
	НачОст=Новый Запрос();
 
		НачОст.Текст = "ВЫБРАТЬ
		               |	СУММА(ТО.СуммаЗакупБезНДСНачальныйОстаток) КАК ОстатокНачПериодаОфиса,
		               |	СУММА(ТО.СуммаЗакупБезНДСПриход) КАК ПриходОфиса,
		               |	СУММА(ТО.СуммаЗакупБезНДСРасход) КАК РасходОфиса,
		               |	СУММА(ТО.СуммаЗакупБезНДСКонечныйОстаток) КАК ОстатокКонПериодаОфиса,
		               |	СУММА(ВЫБОР
		               |			КОГДА ТО.КачествоТовараПорядок = 1
		               |				ТОГДА ТО.СуммаЗакупБезНДСНачальныйОстаток
		               |			ИНАЧЕ 0
		               |		КОНЕЦ) КАК ОстатокНачБрака,
		               |	СУММА(ВЫБОР
		               |			КОГДА ТО.КачествоТовараПорядок = 1
		               |				ТОГДА ТО.СуммаЗакупБезНДСПриход
		               |			ИНАЧЕ 0
		               |		КОНЕЦ) КАК ПриходБрака,
		               |	СУММА(ВЫБОР
		               |			КОГДА ТО.КачествоТовараПорядок = 1
		               |				ТОГДА ТО.СуммаЗакупБезНДСРасход
		               |			ИНАЧЕ 0
		               |		КОНЕЦ) КАК РасходБрака,
		               |	СУММА(ВЫБОР
		               |			КОГДА ТО.КачествоТовараПорядок = 1
		               |				ТОГДА ТО.СуммаЗакупБезНДСКонечныйОстаток
		               |			ИНАЧЕ 0
		               |		КОНЕЦ) КАК ОстатокКонБрака,
		               |	СУММА(ВЫБОР
		               |			КОГДА ТО.ВидПоступленияПорядок = 1
		               |				ТОГДА ТО.СуммаЗакупБезНДСНачальныйОстаток
		               |			ИНАЧЕ 0
		               |		КОНЕЦ) КАК ОстатокНачКомиссия,
		               |	СУММА(ВЫБОР
		               |			КОГДА ТО.ВидПоступленияПорядок = 1
		               |				ТОГДА ТО.СуммаЗакупБезНДСПриход
		               |			ИНАЧЕ 0
		               |		КОНЕЦ) КАК ПриходКомиссия,
		               |	СУММА(ВЫБОР
		               |			КОГДА ТО.ВидПоступленияПорядок = 1
		               |				ТОГДА ТО.СуммаЗакупБезНДСРасход
		               |			ИНАЧЕ 0
		               |		КОНЕЦ) КАК РасходКомиссия,
		               |	СУММА(ВЫБОР
		               |			КОГДА ТО.ВидПоступленияПорядок = 1
		               |				ТОГДА ТО.СуммаЗакупБезНДСКонечныйОстаток
		               |			ИНАЧЕ 0
		               |		КОНЕЦ) КАК ОстатокКонКомиссия
		               |ИЗ
		               |	РегистрНакопления.УЗ_ТоварныйОтчет.ОстаткиИОбороты(&НачПериода, &КонПериода, , ДвиженияИГраницыПериода, СкладКод = &СкладКод) КАК ТО";
					   

	НачОст.УстановитьПараметр("НачПериода",НачалоДня(Начпериода));
	НачОст.УстановитьПараметр("КонПериода",КонецДня(КонПериода));
	НачОст.УстановитьПараметр("Фирма",Фирма);
	НачОст.УстановитьПараметр("СкладКод",Склад.Код);
	ВыборкаИтогов = НачОст.Выполнить().Выбрать();		
	ВыборкаИтогов.Следующий();
	
	

	//------------------<Начальные значения для разбивки по ставкам>-------------------GtG----
	
	Обл=Макет.ПолучитьОбласть("НачОст");
	Обл.Параметры.НачПериода=НачПериода;
	Обл.Параметры.НачОстСуммаБН=ВыборкаИтогов.ОстатокНачПериодаОфиса;
	Обл.Параметры.НачОстБрак=ВыборкаИтогов.ОстатокНачБрака;


	ТАб.Вывести(Обл); // строка нач остатков
	
	Обл=Макет.ПолучитьОбласть("ЗагПриход");
	Обл.Параметры.ИмяСекции="Приход";

    ТАб.Вывести(Обл); // строка Заг прихода
	
			   
	ТХТ = "ВЫБРАТЬ
	      |	УЗ_РеализацияККМ.Ссылка КАК Документ,
	      |	УЗ_РеализацияККМ.СуммаВыручки КАК СуммаВыручки
	      |ПОМЕСТИТЬ ВТВыручка
	      |ИЗ
	      |	Документ.УЗ_РеализацияККМ КАК УЗ_РеализацияККМ
	      |ГДЕ
	      |	УЗ_РеализацияККМ.Дата МЕЖДУ &НачПериода И &КонПериода
	      |	И УЗ_РеализацияККМ.Проведен = ИСТИНА
	      |	И УЗ_РеализацияККМ.СкладКод = &СкладКод
	      |;
	      |
	      |////////////////////////////////////////////////////////////////////////////////
	      |ВЫБРАТЬ
	      |	ВЫБОР
	      |		КОГДА Выборка.Регистратор ССЫЛКА Документ.УЗ_ВводОстатков
	      |			ТОГДА ""Ввод остатков""
	      |		КОГДА Выборка.Регистратор ССЫЛКА Документ.УЗ_ПоступлениеТовара
	      |			ТОГДА ""Поступление""
	      |		КОГДА Выборка.Регистратор ССЫЛКА Документ.УЗ_Торг2
	      |			ТОГДА ""Торг-2""
	      |		КОГДА Выборка.Регистратор ССЫЛКА Документ.УЗ_ВозвратОтПокупателя
	      |			ТОГДА ""Возврат от покупателя""
	      |		КОГДА Выборка.Регистратор ССЫЛКА Документ.УЗ_Перемещение
	      |				И Выборка.ВидДвижения = 1
	      |			ТОГДА ""Перемещение""
	      |		КОГДА Выборка.Регистратор ССЫЛКА Документ.УЗ_Перемещение
	      |				И Выборка.ВидДвижения = -1
	      |			ТОГДА ""Перемещение""
	      |		КОГДА Выборка.Регистратор ССЫЛКА Документ.ПереоценкаПоКачеству
	      |			ТОГДА ""Переоценка по качеству""
	      |		КОГДА Выборка.Регистратор ССЫЛКА Документ.УЗ_ВозвратТовара
	      |			ТОГДА ""Возврат товара""
	      |		КОГДА Выборка.Регистратор ССЫЛКА Документ.УЗ_МелкооптоваяРеализация
	      |			ТОГДА ""Мелкооптовая реализация""
	      |		КОГДА Выборка.Регистратор ССЫЛКА Документ.УЗ_Списание
	      |			ТОГДА ""Списание""
	      |		КОГДА Выборка.Регистратор ССЫЛКА Документ.УЗ_Инвентаризация
	      |			ТОГДА ""Инвентаризация""
	      |		КОГДА Выборка.Регистратор ССЫЛКА Документ.УЗ_Разбраковка
	      |			ТОГДА ""Разбраковка""
	      |		КОГДА Выборка.Регистратор ССЫЛКА Документ.УЗ_КорректировкаНедовоза
	      |			ТОГДА ""Корректировка недовоза""
	      |		КОГДА Выборка.Регистратор ССЫЛКА Документ.УЗ_РеализацияККМ
	      |			ТОГДА ""Продажа ККМ""
	      |		ИНАЧЕ 0
	      |	КОНЕЦ КАК ТипДокумента,
	      |	ВЫБОР
	      |		КОГДА Выборка.Регистратор ССЫЛКА Документ.УЗ_ПоступлениеТовара
	      |				ИЛИ Выборка.Регистратор ССЫЛКА Документ.УЗ_ВозвратТовара
	      |				ИЛИ Выборка.Регистратор ССЫЛКА Документ.УЗ_МелкооптоваяРеализация
	      |			ТОГДА Выборка.Регистратор.Поставщик
	      |		КОГДА Выборка.Регистратор ССЫЛКА Документ.УЗ_Перемещение
	      |				И Выборка.ВидДвижения = 1
	      |			ТОГДА Выборка.Регистратор.СкладОтправитель
	      |		КОГДА Выборка.Регистратор ССЫЛКА Документ.УЗ_Перемещение
	      |				И Выборка.ВидДвижения = -1
	      |			ТОГДА Выборка.Регистратор.СкладПолучатель
	      |		КОГДА Выборка.Регистратор ССЫЛКА Документ.УЗ_КорректировкаНедовоза
	      |			ТОГДА Выборка.Регистратор.Поставщик.Наименование + "" - "" + ПОДСТРОКА(Выборка.Регистратор.Комментарий, 1, 100)
	      |		ИНАЧЕ """"
	      |	КОНЕЦ КАК Контрагент,
	      |	Выборка.ВидДвижения КАК ВидДвижения,
	      |	Выборка.Период КАК ДатаПроведенияОфиса,
	      |	Выборка.Регистратор.Дата КАК ДатаДокументаОфиса,
	      |	Выборка.Регистратор.Номер КАК НомерДокумента,
	      |	ВЫБОР
	      |		КОГДА Выборка.Регистратор ССЫЛКА Документ.УЗ_РеализацияККМ
	      |			ТОГДА Выборка.Регистратор.НомерККМ + ""/"" + Выборка.Регистратор.НомерСмены
	      |		КОГДА Выборка.Регистратор ССЫЛКА Документ.УЗ_ПоступлениеТовара
	      |			ТОГДА Выборка.Регистратор.ВхНомерНакл
	      |		КОГДА Выборка.Регистратор ССЫЛКА Документ.УЗ_ВводОстатков
	      |			ТОГДА Выборка.Регистратор.Номер
	      |		КОГДА Выборка.Регистратор ССЫЛКА Документ.УЗ_Перемещение
	      |				И Выборка.ВидДвижения = 1
	      |			ТОГДА Выборка.Регистратор.Номер
	      |		КОГДА Выборка.Регистратор ССЫЛКА Документ.УЗ_Перемещение
	      |				И Выборка.ВидДвижения = -1
	      |			ТОГДА Выборка.Регистратор.НомДокАптекиОтправителя
	      |		ИНАЧЕ Выборка.Регистратор.НомДокАптеки
	      |	КОНЕЦ КАК НомерДокументаВХ,
	      |	ВЫБОР
	      |		КОГДА Выборка.Регистратор ССЫЛКА Документ.УЗ_Перемещение
	      |				И Выборка.ВидДвижения = 1
	      |			ТОГДА Выборка.Регистратор.ИДДокументаАптекиПолучатель
	      |		КОГДА Выборка.Регистратор ССЫЛКА Документ.УЗ_Перемещение
	      |				И Выборка.ВидДвижения = -1
	      |			ТОГДА Выборка.Регистратор.ИДДокументаАптекиОтправитель
	      |		КОГДА Выборка.Регистратор ССЫЛКА Документ.УЗ_РеализацияККМ
	      |			ТОГДА Выборка.Регистратор.GuidСмены
	      |		ИНАЧЕ Выборка.Регистратор.ИДДокументаАптеки
	      |	КОНЕЦ КАК ИДДокумента,
	      |	Выборка.СуммаЗакупБезНДС КАК СуммаЗакупБезНДС,
	      |	Выборка.Сумма0 КАК Сумма0,
	      |	Выборка.Сумма10 КАК Сумма10,
	      |	Выборка.Сумма18 КАК Сумма18,
	      |	Выборка.Регистратор КАК Регистратор,
	      |	Выборка.СуммаОкругления КАК СуммаОкругления,
	      |	Выборка.СуммаБрака КАК СуммаБрака,
	      |	ЕСТЬNULL(ВТВыручка.СуммаВыручки, 0) КАК СуммаВыручки
	      |ИЗ
	      |	(ВЫБРАТЬ
	      |		ТО.Период КАК Период,
	      |		ТО.Регистратор КАК Регистратор,
	      |		ВЫБОР
	      |			КОГДА ТО.ВидДвижения = ЗНАЧЕНИЕ(ВидДвиженияНакопления.Приход)
	      |				ТОГДА 1
	      |			ИНАЧЕ -1
	      |		КОНЕЦ КАК ВидДвижения,
	      |		СУММА(ТО.СуммаЗакупБезНДС) КАК СуммаЗакупБезНДС,
	      |		СУММА(ВЫБОР
	      |				КОГДА ТО.СтавкаНДС = 0
	      |					ТОГДА ТО.СуммаЗакупБезНДС
	      |				ИНАЧЕ 0
	      |			КОНЕЦ) КАК Сумма0,
	      |		СУММА(ВЫБОР
	      |				КОГДА ТО.СтавкаНДС = 10
	      |					ТОГДА ТО.СуммаЗакупБезНДС
	      |				ИНАЧЕ 0
	      |			КОНЕЦ) КАК Сумма10,
	      |		СУММА(ВЫБОР
		  // НДС20/18
	      |				КОГДА ТО.СтавкаНДС = 18
	      |						ИЛИ ТО.СтавкаНДС = 20
	      |					ТОГДА ТО.СуммаЗакупБезНДС
	      |				ИНАЧЕ 0
	      |			КОНЕЦ) КАК Сумма18,
	      |		СУММА(ТО.СуммаОкругления) КАК СуммаОкругления,
	      |		СУММА(ВЫБОР
	      |				КОГДА ТО.КачествоТовараПорядок = 1
	      |					ТОГДА ТО.СуммаЗакупБезНДС
	      |				ИНАЧЕ 0
	      |			КОНЕЦ) КАК СуммаБрака
	      |	ИЗ
	      |		РегистрНакопления.УЗ_ТоварныйОтчет КАК ТО
	      |	ГДЕ
	      |		ТО.Период МЕЖДУ &НачПериода И &КонПериода
	      |		И ТО.СкладКод = &СкладКод
	      |	
	      |	СГРУППИРОВАТЬ ПО
	      |		ТО.Период,
	      |		ТО.Регистратор,
	      |		ВЫБОР
	      |			КОГДА ТО.ВидДвижения = ЗНАЧЕНИЕ(ВидДвиженияНакопления.Приход)
	      |				ТОГДА 1
	      |			ИНАЧЕ -1
	      |		КОНЕЦ) КАК Выборка
	      |		ЛЕВОЕ СОЕДИНЕНИЕ ВТВыручка КАК ВТВыручка
	      |		ПО Выборка.Регистратор = ВТВыручка.Документ
	      |
	      |УПОРЯДОЧИТЬ ПО
	      |	ТипДокумента,
	      |	ДатаПроведенияОфиса
	      |;
	      |
	      |////////////////////////////////////////////////////////////////////////////////
	      |УНИЧТОЖИТЬ ВТВыручка";
		  
	Дв=Новый Запрос(ТХТ);
	
	Дв.УстановитьПараметр("НачПериода",НачалоДня(Начпериода));
	Дв.УстановитьПараметр("КонПериода",КонецДня(КонПериода));
	Дв.УстановитьПараметр("Фирма",Фирма);
	Дв.УстановитьПараметр("СкладКод",Склад.Код);
	
	ТЗДв=Дв.Выполнить().Выгрузить();
	Отбор = Новый Структура;
	Отбор.Вставить("ВидДвижения",1);
	ТЗПриход = ТЗДв.Скопировать(Отбор);
	
	Отбор.Вставить("ВидДвижения",-1);
	ТЗРасход = ТЗДв.Скопировать(Отбор);	
	
	
	
	ИтогСумма	=0;
	ИтогСумма0	=0;
	ИтогСумма10	=0;
	ИтогСумма18	=0;
	ИтогСуммаБрака = 0;

	
	
	Обл=Макет.ПолучитьОбласть("Прих");
	Ном = 0;	
	Для каждого Стр из ТЗПриход Цикл
		
		
			
			//------------------<Вывод строки>-------------------GtG----
			Обл.Параметры.ТипДок    = стр.ТипДокумента;
			Обл.Параметры.ДатаДок	= стр.ДатаПроведенияОфиса;
			Обл.Параметры.НомерДок	= стр.НомерДокументаВх;
			
			Обл.Параметры.НДС18		= стр.Сумма18;	
			Обл.Параметры.НДС10	    = стр.Сумма10;
			Обл.Параметры.НДС0	    = стр.Сумма0;
			Обл.Параметры.СуммаБН	= стр.СуммаЗакупБезНДС;
			Обл.Параметры.СуммаОкругления	= стр.СуммаОкругления;
			Обл.Параметры.СуммаБрака	= стр.СуммаБрака;

			
			Обл.Параметры.Контрагент= стр.Контрагент;
			Обл.Параметры.ДокСсылка	=	стр.Регистратор;
			Обл.Параметры.НомерПА= стр.НомерДокумента;

			
			//------------------<Для итогов>-------------------GtG----
			ИтогСумма	= ИтогСумма + стр.СуммаЗакупБезНДС;
			ИтогСумма0	= ИтогСумма0 + стр.Сумма0;
			ИтогСумма10	= ИтогСумма10 + стр.Сумма10;
			ИтогСумма18	= ИтогСумма18 + стр.Сумма18;
			ИтогСуммаБрака	= ИтогСуммаБрака + стр.СуммаБрака;


			Ном = Ном + 1;
			Обл.Параметры.Ном = Ном;
			Таб.Вывести(Обл);
		
	КонецЦикла;	 
	
	
	Обл=Макет.ПолучитьОбласть("ИтогоПрих");
	
	Обл.Параметры.Сумма		= ИтогСумма;
	Обл.Параметры.Сумма18	= ИтогСумма18;	
	Обл.Параметры.Сумма10	= ИтогСумма10;
	Обл.Параметры.Сумма0	= ИтогСумма0;
	Обл.Параметры.СуммаБрака	= ИтогСуммаБрака;

	
	
	Обл.Параметры.СуммаПрихИОст  =ВыборкаИтогов.ОстатокНачПериодаОфиса	+ИтогСумма;
	Обл.Параметры.СуммаПрихИОстБрак  =ВыборкаИтогов.ОстатокНачБрака		+ИтогСуммаБрака;
	
	
	Обл.Параметры.Чему="приходу"; 
	
	Таб.Вывести(Обл);
	
	//------------------<Расход>-------------------GtG----	
    
	Обл=Макет.ПолучитьОбласть("ЗагПриход");
	Обл.Параметры.ИмяСекции="Расход";
	Таб.Вывести(Обл);

	
	ИтогСумма	=0;
	ИтогСумма0	=0;
	ИтогСумма10	=0;
	ИтогСумма18	=0;
	ИтогСуммаБрака = 0;


	
	
	Обл=Макет.ПолучитьОбласть("Расх");
	Ном = 0;	
	Для каждого Стр из ТЗРасход Цикл
		
		
			
			//------------------<Вывод строки>-------------------GtG----
			Обл.Параметры.ТипДок    = стр.ТипДокумента;
			Обл.Параметры.ДатаДок	= стр.ДатаПроведенияОфиса;
			Обл.Параметры.НомерДок	= стр.НомерДокументаВх;
			
			Обл.Параметры.НДС18		= стр.Сумма18;	
			Обл.Параметры.НДС10	    = стр.Сумма10;
			Обл.Параметры.НДС0	    = стр.Сумма0;
			Обл.Параметры.СуммаБН	= стр.СуммаЗакупБезНДС;
			Обл.Параметры.СуммаБрака	= стр.СуммаБрака;
			
			Обл.Параметры.Контрагент= стр.Контрагент;
			Обл.Параметры.ДокСсылка	=	стр.Регистратор;
			Обл.Параметры.НомерПА= стр.НомерДокумента;
			Обл.Параметры.СуммаОкругления	= стр.СуммаОкругления;
			Обл.Параметры.СуммаВыручки	= стр.СуммаВыручки;


			
			//------------------<Для итогов>-------------------GtG----
			ИтогСумма	= ИтогСумма + стр.СуммаЗакупБезНДС;
			ИтогСумма0	= ИтогСумма0 + стр.Сумма0;
			ИтогСумма10	= ИтогСумма10 + стр.Сумма10;
			ИтогСумма18	= ИтогСумма18 + стр.Сумма18;
			ИтогСуммаБрака	= ИтогСуммаБрака + стр.СуммаБрака;


			Ном = Ном + 1;
			Обл.Параметры.Ном = Ном;
			Таб.Вывести(Обл);
		
	КонецЦикла;	 
	
	
	Обл=Макет.ПолучитьОбласть("ИтогоПрих");
	
	Обл.Параметры.Сумма		= ИтогСумма;
	Обл.Параметры.Сумма18	= ИтогСумма18;	
	Обл.Параметры.Сумма10	= ИтогСумма10;
	Обл.Параметры.Сумма0	= ИтогСумма0;
	Обл.Параметры.СуммаБрака	= ИтогСуммаБрака;


	
	
	Обл.Параметры.СуммаПрихИОст  =ВыборкаИтогов.ОстатокКонПериодаОфиса;	
	Обл.Параметры.СуммаПрихИОстБрак  =ВыборкаИтогов.ОстатокКонБрака;
	
	Обл.Параметры.Чему="расходу"; 
	
	Таб.Вывести(Обл);
	
	ВывестиБрак(Таб,Макет);
	ВывестиКомиссию(Таб,Макет);
	
	
	
	Обл=Макет.ПолучитьОбласть("Подписи");
	Таб.Вывести(Обл);
	
	
	
	
	//------------------<Вывод таблицы на экран>-------------------GtG---- 
	Таб.АвтоМасштаб=Истина;
	Таб.ТолькоПросмотр=Истина;
	Таб.ОтображатьСетку=Ложь;
	Таб.ОтображатьЗаголовки=Ложь;
	
	
	Таб.Показать("Товарный отчет");
	
КонецПроцедуры

Процедура ВывестиБрак(Таб,Макет)
	
	Запрос = Новый Запрос;
	Запрос.Текст = "ВЫБРАТЬ
	               |	СУММА(ВЫБОР
	               |			КОГДА Брак.СтавкаНДСЗакуп = 0
	               |				ТОГДА Брак.СуммаЗакупБезНДСОстаток
	               |			ИНАЧЕ 0
	               |		КОНЕЦ) КАК Брак0,
	               |	СУММА(ВЫБОР
	               |			КОГДА Брак.СтавкаНДСЗакуп = 10
	               |				ТОГДА Брак.СуммаЗакупБезНДСОстаток
	               |			ИНАЧЕ 0
	               |		КОНЕЦ) КАК Брак10,
	               |	СУММА(ВЫБОР
				   // НДС20/18
	               |			КОГДА Брак.СтавкаНДСЗакуп = 18
	               |					ИЛИ Брак.СтавкаНДСЗакуп = 20
	               |				ТОГДА Брак.СуммаЗакупБезНДСОстаток
	               |			ИНАЧЕ 0
	               |		КОНЕЦ) КАК Брак18,
	               |	СУММА(Брак.СуммаЗакупБезНДСОстаток) КАК БракСуммаБезНДС
	               |ИЗ
	               |	РегистрНакопления.УЗ_ПартииБрак.Остатки(&Дата, СкладКод = &СкладКод) КАК Брак";
				   
	
	Запрос.УстановитьПараметр("Дата",КонецДня(КонПериода));
	Запрос.УстановитьПараметр("СкладКод",Склад.Код);
	Выборка = Запрос.Выполнить().Выбрать();		
	Выборка.Следующий();
	Если Выборка.БракСуммаБезНДС = null Тогда
		Возврат;
	КонецЕсли;
	
	Обл=Макет.ПолучитьОбласть("ТоварВБраке");
	
	Обл.Параметры.БракСуммаБезНДС	= Выборка.БракСуммаБезНДС;
	Обл.Параметры.БракСумма18	= Выборка.Брак18;	
	Обл.Параметры.БракСумма10	= Выборка.Брак10;
	Обл.Параметры.БракСумма0		= Выборка.Брак0;

	Таб.Вывести(Обл);	
	

КонецПроцедуры

Процедура ВывестиКомиссию(Таб,Макет)
	
	Запрос = Новый Запрос;
	Запрос.Текст = "ВЫБРАТЬ
	               |	СУММА(ВЫБОР
	               |			КОГДА Остатки.СтавкаНДСЗакуп = 0
	               |				ТОГДА Остатки.СуммаЗакупБезНДСОстаток
	               |			ИНАЧЕ 0
	               |		КОНЕЦ) КАК Комиссия0,
	               |	СУММА(ВЫБОР
	               |			КОГДА Остатки.СтавкаНДСЗакуп = 10
	               |				ТОГДА Остатки.СуммаЗакупБезНДСОстаток
	               |			ИНАЧЕ 0
	               |		КОНЕЦ) КАК Комиссия10,
	               |	СУММА(ВЫБОР
				   // НДС20/18
	               |			КОГДА Остатки.СтавкаНДСЗакуп = 18
	               |					ИЛИ Остатки.СтавкаНДСЗакуп = 20
	               |				ТОГДА Остатки.СуммаЗакупБезНДСОстаток
	               |			ИНАЧЕ 0
	               |		КОНЕЦ) КАК Комиссия18,
	               |	СУММА(Остатки.СуммаЗакупБезНДСОстаток) КАК КомиссияСуммаБезНДС
	               |ИЗ
	               |	РегистрНакопления.УЗ_Партии.Остатки(
	               |			&Дата,
	               |			ВидПоступленияПорядок = 1
	               |				И СкладКод = &СкладКод) КАК Остатки";
				   
	
	Запрос.УстановитьПараметр("Дата",КонецДня(КонПериода));
	Запрос.УстановитьПараметр("СкладКод",Склад.Код);
	Выборка = Запрос.Выполнить().Выбрать();		
	Выборка.Следующий();
	Если Выборка.КомиссияСуммаБезНДС = null Тогда
		Возврат;
	КонецЕсли;
	
	Обл=Макет.ПолучитьОбласть("ТоварНаКомиссии");
	
	Обл.Параметры.КомиссияСуммаБезНДС	= Выборка.КомиссияСуммаБезНДС;
	Обл.Параметры.КомиссияСумма18	= Выборка.Комиссия18;	
	Обл.Параметры.КомиссияСумма10	= Выборка.Комиссия10;
	Обл.Параметры.КомиссияСумма0	= Выборка.Комиссия0;

	Таб.Вывести(Обл);	
	

КонецПроцедуры


Процедура ВыбПериодНажатие(Элемент)
	НастройкаПериода = Новый НастройкаПериода;
	НастройкаПериода.УстановитьПериод(НачПериода, ?(КонПериода='0001-01-01', КонПериода, КонецДня(КонПериода)));
	НастройкаПериода.РедактироватьКакИнтервал = Истина;
	НастройкаПериода.РедактироватьКакПериод = Истина;
	НастройкаПериода.ВариантНастройки = ВариантНастройкиПериода.Период;
	Если НастройкаПериода.Редактировать() Тогда
		НачПериода = НастройкаПериода.ПолучитьДатуНачала();
		КонПериода = НастройкаПериода.ПолучитьДатуОкончания();
	КонецЕсли;
КонецПроцедуры

Процедура ПриОткрытии()
	// Вставить содержимое обработчика.
	Склад=Константы.ОсновнойСклад.Получить();
	Фирма=Константы.ОсновнаяФирма.Получить();
КонецПроцедуры

Процедура СкладПриИзменении(Элемент)
	
	Фирма = Склад.Фирма;
	
КонецПроцедуры


