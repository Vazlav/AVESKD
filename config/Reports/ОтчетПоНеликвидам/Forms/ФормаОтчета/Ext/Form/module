
Процедура КнопкаСформироватьНажатие(Кнопка)

	Если ПоОднойАптеке = Истина Тогда
		ТХТ = "ВЫБРАТЬ
		|	ПартииЖНВЛСОстатки.Товар.Код КАК Код,
		|	ПартииЖНВЛСОстатки.Товар.Наименование КАК Наименование,
		|	ПартииЖНВЛСОстатки.КолвоОстаток КАК Остаток
		|ИЗ
		|	РегистрНакопления.ПартииЖНВЛС.Остатки(&ДатаОстатка, Склад = &Склад) КАК ПартииЖНВЛСОстатки
		|		ЛЕВОЕ СОЕДИНЕНИЕ РегистрНакопления.ПартииЖНВЛС.Обороты(&НачПериода, &КонПериода, , Склад = &Склад) КАК ПартииЖНВЛСОбороты
		|		ПО ПартииЖНВЛСОстатки.Склад = ПартииЖНВЛСОбороты.Склад
		|			И ПартииЖНВЛСОстатки.Товар = ПартииЖНВЛСОбороты.Товар
		|ГДЕ
		|	ЕСТЬNULL(ПартииЖНВЛСОбороты.КолвоРасход, 0) = 0
		|
		|УПОРЯДОЧИТЬ ПО
		|	Наименование";
	Иначе
		ТХТ = "ВЫБРАТЬ
		|	ПартииЖНВЛСОстатки.Товар.Код КАК Код,
		|	ПартииЖНВЛСОстатки.Товар.Наименование КАК Наименование,
		|	ПартииЖНВЛСОстатки.КолвоОстаток КАК Остаток
		|ИЗ
		|	РегистрНакопления.ПартииЖНВЛС.Остатки(&ДатаОстатка, ) КАК ПартииЖНВЛСОстатки
		|		ЛЕВОЕ СОЕДИНЕНИЕ РегистрНакопления.ПартииЖНВЛС.Обороты(&НачПериода, &КонПериода, , ) КАК ПартииЖНВЛСОбороты
		|		ПО ПартииЖНВЛСОстатки.Склад = ПартииЖНВЛСОбороты.Склад
		|			И ПартииЖНВЛСОстатки.Товар = ПартииЖНВЛСОбороты.Товар
		|ГДЕ
		|	ЕСТЬNULL(ПартииЖНВЛСОбороты.КолвоРасход, 0) = 0
		|
		|УПОРЯДОЧИТЬ ПО
		|	Наименование";
		
	КонецЕсли;
	НачПериода	= НачалоДня(ТекущаяДата())-КоличествоДнейБезДвижения*60*60*24;
	КонПериода	= КонецДня(ТекущаяДата());
	запрос = Новый Запрос;
	Запрос.Текст = ТХТ;
	Запрос.УстановитьПараметр("Склад",Аптека);
	Запрос.УстановитьПараметр("ДатаОстатка",НачПериода);
	Запрос.УстановитьПараметр("НачПериода",НачПериода);
	Запрос.УстановитьПараметр("КонПериода",КонПериода);
	РезультатЗапроса = Запрос.Выполнить();
	Если РезультатЗапроса.Пустой() Тогда
		Предупреждение("Данных по выбранным параметрам нет.");
		Возврат;
	КонецЕсли;
	ТабДок = Новый ТабличныйДокумент;
	Макет = ПолучитьМакет("Макет");
	Титул = Макет.ПолучитьОбласть("Титул");
	Титул.Параметры.КоличествоДнейБезДвижения = КоличествоДнейБезДвижения;
	Титул.Параметры.Датаформирования = ТекущаяДата();
	Если ПоОднойАптеке = Истина Тогда
		Титул.Параметры.ОтборПоАптеке = ""+Аптека;
	Иначе
		Титул.Параметры.ОтборПоАптеке = "по всем аптекам";
	КонецЕсли;
	ТабДок.Вывести(Титул);
	
	Выборка = РезультатЗапроса.Выбрать();
	СтрокаОбласть = Макет.ПолучитьОбласть("Строка");
	
	Пока Выборка.Следующий() Цикл
		СтрокаОбласть.Параметры.Код = Выборка.Код;
		СтрокаОбласть.Параметры.наименование = Выборка.Наименование;
		СтрокаОбласть.Параметры.Остаток = Выборка.Остаток;
		ТабДок.Вывести(СтрокаОбласть);
	КонецЦикла;
	ТабДок.ФиксацияСверху =5;
	ТабДок.Показать();

	
КонецПроцедуры

Процедура ПоОднойАптекеПриИзменении(Элемент)
	
	ЭлементыФормы.Аптека.Доступность = ПоОднойАптеке;
	ЭлементыФормы.НадписьАптека.Доступность = ПоОднойАптеке;
	
КонецПроцедуры

Процедура КоличествоДнейБезДвиженияПриИзменении(Элемент)
	
	Если Элемент.Значение = 0 Тогда
		КоличествоДнейБезДвижения = 180;		
	КонецЕсли;
	
КонецПроцедуры

ПоОднойАптеке = Истина;
КоличествоДнейБезДвижения = 180;