
Процедура КнопкаВыполнитьНажатие(Кнопка)
	ВыбДата=КонецДня(ВыбДата);
	
	
	
	
	Тхт="ВЫБРАТЬ
	    |	ОстаткиТовараПоСкладамОстатки.Товар.Код КАК КодАП,
	    |	ОстаткиТовараПоСкладамОстатки.Товар.Ссылка КАК Товар,
	    |	ОстаткиТовараПоСкладамОстатки.Товар.Наименование КАК ТоварК,
	    |	ОстаткиТовараПоСкладамОстатки.Склад.Ссылка КАК Склад,
	    |	ОстаткиТовараПоСкладамОстатки.Фирма.Ссылка КАК Фирма,
	    |	ОстаткиТовараПоСкладамОстатки.Место.Ссылка КАК Место,
	    |	ОстаткиТовараПоСкладамОстатки.Серия.Ссылка КАК Серия,
	    |	ОстаткиТовараПоСкладамОстатки.КолвоОстаток КАК Колво,
	    |	ОстаткиТовараПоСкладамОстатки.СуммаЗакупСНДСОстаток КАК Закуп,
	    |	ОстаткиТовараПоСкладамОстатки.СуммаНДСЗакупОстаток КАК НДСЗакуп,
	    |	ОстаткиТовараПоСкладамОстатки.СуммаРознСНДСОстаток КАК Розн,
	    |	ОстаткиТовараПоСкладамОстатки.СуммаРознНДСОстаток КАК НДСРозн
	    |ИЗ
	    |	РегистрНакопления.ОстаткиТовараПоСкладам.Остатки(
	    |		&ВыбДата,
	    |		Склад = &ВыбСклад
	    |		    И Фирма = &ВыбФирма) КАК ОстаткиТовараПоСкладамОстатки
	    |
	    |УПОРЯДОЧИТЬ ПО
	    |	ОстаткиТовараПоСкладамОстатки.Место.Наименование
	    |ИТОГИ
	    |	СУММА(Колво),
	    |	СУММА(Закуп),
	    |	СУММА(НДСЗакуп),
	    |	СУММА(Розн),
	    |	СУММА(НДСРозн)
	    |ПО
	    |	Фирма,
	    |	Склад,
	    |	Товар,
	    |	Место,
	    |	Серия";
	

	Запрос=Новый Запрос;
	
	Запрос.Текст=тхт;
	
	Запрос.УстановитьПараметр("ВыбДата",ВыбДата);
	Запрос.УстановитьПараметр("ВыбФирма",ВыбФирма);
	Запрос.УстановитьПараметр("ВыбСклад",ВыбСклад);
	
	Рез=ЗАпрос.Выполнить();
	
	
	Таб=Новый ТабличныйДокумент;
	Макет = ЭтотОбъект.ПолучитьМакет("Отчет");
	Шапка=Макет.ПолучитьОбласть("Шапка");
	Шапка.Параметры.ВыбДата=ВыбДата;
	
	ШапкаТОвара=Макет.ПолучитьОбласть("ШапкаТОвара");
	
	
	
	Таб.Вывести(Шапка);
	
	
	
	
	ВыбЗап1=Рез.Выбрать(ОбходРезультатаЗапроса.ПоГруппировкам); 
	Пока ВыбЗап1.Следующий() Цикл //|	Фирма,
		МакФирма=Макет.ПолучитьОбласть("Фирма");
		МакФирма.Параметры.Фирма=ВыбФирма;
		Таб.Вывести(МакФирма);
		ВыбЗап2=ВыбЗап1.Выбрать(ОбходРезультатаЗапроса.ПоГруппировкам); 
		Пока  ВыбЗап2.Следующий() Цикл //	Склад,
			Таб.Вывести(ШапкаТОвара);
			МакСклад=Макет.ПолучитьОбласть("Склад");
			МакСклад.Параметры.Склад=ВыбСклад;
			Таб.Вывести(МакСклад);
			ВыбЗап3=ВыбЗап2.Выбрать(ОбходРезультатаЗапроса.ПоГруппировкам); 
			Пока  ВыбЗап3.Следующий() Цикл //|	Товар,
				ВыбЗап4=ВыбЗап3.Выбрать(ОбходРезультатаЗапроса.ПоГруппировкам); 
				Пока  ВыбЗап4.Следующий() Цикл //|	место,
					ВыбЗап5=ВыбЗап4.Выбрать(ОбходРезультатаЗапроса.ПоГруппировкам); 
					Пока  ВыбЗап5.Следующий() Цикл //|	серия,
						
						МакСерия=Макет.ПолучитьОбласть("ТОвар");
						МакСерия.Параметры.Заполнить(ВыбЗап5);
						
						Попытка
							МакСерия.Параметры.ЦенаЗакуп=Окр(ВыбЗап5.Закуп/ВыбЗап5.колво,2);
						Исключение
						КонецПопытки;
						
						Попытка
							МакСерия.Параметры.ЦенаРозн=Окр(ВыбЗап5.Розн/ВыбЗап5.колво,2);
						Исключение
						КонецПопытки;
							
						 МакСерия.Параметры.КМХ=ВыбЗап5.Место;
						
						Таб.Вывести(МакСерия);
					КонецЦикла;	
				КонецЦикла;	
			КонецЦикла;	
		КонецЦикла;
	КонецЦикла;
	
	
	Итоги=Рез.Выгрузить();
	
	Итоги.Свернуть("","Закуп,Розн");
	
	
	
	Таб.ОтображатьСетку=Ложь;
	Таб.ОтображатьЗаголовки=Ложь;
	Таб.ТолькоПросмотр=Истина;
	Таб.АвтоМасштаб=Истина;
	Таб.ОриентацияСтраницы=ОриентацияСтраницы.Портрет;
	Таб.Показать();
	
	
КонецПроцедуры

Процедура КоманднаяПанель2Действие(Кнопка)
	// Вставить содержимое обработчика.
КонецПроцедуры

Процедура КоманднаяПанель2Убрать(Кнопка)
	// Вставить содержимое обработчика.
КонецПроцедуры


ВыбДата=КонецДня(ТекущаяДата());
ВыбФирма=Константы.ОсновнаяФирма.Получить();
ВыбСклад=Константы.ОсновнойСклад.Получить();