
Процедура КнопкаВыполнитьНажатие(Кнопка)
	//------------------<Таблица печатная>-------------------GtG----
	Таб=Новый ТабличныйДокумент;
	Макет= ЭтотОбъект.ПолучитьМакет("ТоварныйОтчет");
	Обл=Макет.ПолучитьОбласть("Шапка");
	Обл.Параметры.Фирма=Фирма.ДлинноеНаименование;
	Обл.Параметры.Склад=Склад.Наименование;
	Обл.Параметры.СостДата= КонПериода+60*60*24;
	Обл.Параметры.НачПериода=НачПериода;		
	Обл.Параметры.КонПериода=КонПериода;
	Обл.Параметры.НомерДокТО=НомерТО;
	
	Таб.Вывести(Обл);
	
	
	
	
	//------------------<Остатки на начало периода>-------------------GtG---- 
	ТХТ_приход="ВЫБРАТЬ
	           |	ОстаткиПоСтНДСПоСкладамОстатки.СтавкаНДС.Ставка КАК СтавкаНДС,
	           |	СУММА(ВЫБОР
	           |			КОГДА ОстаткиПоСтНДСПоСкладамОстатки.Склад.ТипСклада = &Опт
	           |				ТОГДА ОстаткиПоСтНДСПоСкладамОстатки.СуммаЗакупСНДСОстаток
	           |			ИНАЧЕ ОстаткиПоСтНДСПоСкладамОстатки.СуммаРознСНДСОстаток
	           |		КОНЕЦ) КАК СуммаТовара,
	           |	СУММА(ВЫБОР
	           |			КОГДА ОстаткиПоСтНДСПоСкладамОстатки.Склад.ТипСклада = &Опт
	           |				ТОГДА ОстаткиПоСтНДСПоСкладамОстатки.СуммаНДСЗакупОстаток
	           |			ИНАЧЕ ОстаткиПоСтНДСПоСкладамОстатки.СуммаРознНДСОстаток
	           |		КОНЕЦ) КАК НДСТовара,
	           |	СУММА(ОстаткиПоСтНДСПоСкладамОстатки.СуммаЗакупСНДСОстаток) КАК СуммаТовараЗ,
	           |	СУММА(ОстаткиПоСтНДСПоСкладамОстатки.СуммаНДСЗакупОстаток) КАК НДСТовараЗ			   
	           |ИЗ
	           |	РегистрНакопления.ОстаткиПоСтНДСПоСкладам.Остатки(
	           |		&НачПер,
	           |		Фирма = &Фирма
	           |			И Склад = &Склад) КАК ОстаткиПоСтНДСПоСкладамОстатки
	           |
	           |СГРУППИРОВАТЬ ПО
	           |	ОстаткиПоСтНДСПоСкладамОстатки.СтавкаНДС.Ставка";
	
	НачОст=Новый Запрос(ТХТ_приход);	
	НачОст.УстановитьПараметр("Опт",Перечисления.ТипыМХ.Опт);
	НачОст.УстановитьПараметр("НачПер",НачалоДня(Начпериода));
	НачОст.УстановитьПараметр("Фирма",Фирма);
	НачОст.УстановитьПараметр("Склад",Склад);
	
	
	
	ТЗНО=НачОст.Выполнить().Выгрузить();
	
	
	НачОстСумма=ТЗНО.Итог("СуммаТовара");
	НачОстСуммаЗ=ТЗНО.Итог("СуммаТовараЗ");
	
	//------------------<Начальные значения для разбивки по ставкам>-------------------GtG----
	НачОст18=0;
	НачОст10=0;
	НачОстЗ18=0;
	НачОстЗ10=0;	
	
	Для каждого СтрНО из ТЗНО Цикл // сюда можно добавить другие ставки 
		Если СтрНО.СтавкаНДС=18 Тогда
			НачОст18=СтрНО.НДСТовара;
			НачОстЗ18=СтрНО.НДСТовараЗ;
		ИначеЕсли 	СтрНО.СтавкаНДС=10 Тогда
			НачОст10=СтрНО.НДСТовара;
			НачОстЗ10=СтрНО.НДСТовараЗ;
		КонецЕсли;	
	КонецЦикла;	 
	
	Обл=Макет.ПолучитьОбласть("НачОст");
	Обл.Параметры.НачПериода=НачПериода;
	Обл.Параметры.НачОстСумма=НачОстСумма;
	Обл.Параметры.НачОст18	 =НачОст18;
	Обл.Параметры.НачОст10	 =НачОст10;
	Обл.Параметры.НачОстСуммаБН=НачОстСумма-НачОст18-НачОст10 ;
	
	Обл.Параметры.НачОстСуммаЗ=НачОстСуммаЗ;
	Обл.Параметры.НачОстЗ18	 =НачОстЗ18;
	Обл.Параметры.НачОстЗ10	 =НачОстЗ10;
	Обл.Параметры.НачОстСуммаЗБН=НачОстСуммаЗ-НачОстЗ18-НачОстЗ10 ;	

	
	ТАб.Вывести(Обл); // строка нач остатков
	
	Обл=Макет.ПолучитьОбласть("ЗагПриход");
	Обл.Параметры.ИмяСекции="Приход";

    ТАб.Вывести(Обл); // строка Заг прихода
	
	//------------------<строки прихода>-------------------GtG---- 
	ТХТ_ДвПрих="ВЫБРАТЬ РАЗРЕШЕННЫЕ
	           |	ОстаткиПоСтНДСПоСкладамОбороты.СтавкаНДС.Ставка КАК СтавкаНДС,
	           |	СУММА(ВЫБОР
	           |			КОГДА ОстаткиПоСтНДСПоСкладамОбороты.Склад.ТипСклада = &Опт
	           |				ТОГДА ОстаткиПоСтНДСПоСкладамОбороты.СуммаЗакупСНДСПриход
	           |			ИНАЧЕ ОстаткиПоСтНДСПоСкладамОбороты.СуммаРознСНДСПриход
	           |		КОНЕЦ) КАК Сумма,
	           |	СУММА(ВЫБОР
	           |			КОГДА ОстаткиПоСтНДСПоСкладамОбороты.Склад.ТипСклада = &Опт
	           |				ТОГДА ОстаткиПоСтНДСПоСкладамОбороты.СуммаНДСЗакупПриход
	           |			ИНАЧЕ ОстаткиПоСтНДСПоСкладамОбороты.СуммаРознНДСПриход
	           |		КОНЕЦ) КАК НДС,
	           |	Сумма(ОстаткиПоСтНДСПоСкладамОбороты.СуммаЗакупСНДСПриход) КАК СуммаЗ,
	           |	Сумма(ОстаткиПоСтНДСПоСкладамОбороты.СуммаНДСЗакупПриход) КАК НДСЗ,			   
	           |	ОстаткиПоСтНДСПоСкладамОбороты.Регистратор КАК Документ,
	           |	ОстаткиПоСтНДСПоСкладамОбороты.Период,
	           |	ОстаткиПоСтНДСПоСкладамОбороты.Регистратор.СкладПолучатель,
	           |	ОстаткиПоСтНДСПоСкладамОбороты.Регистратор.Поставщик.Наименование КАК Поставщик,
	           |	ОстаткиПоСтНДСПоСкладамОбороты.Регистратор.ВхНомерНакл КАК ВхНомер
	           |ИЗ
	           |	РегистрНакопления.ОстаткиПоСтНДСПоСкладам.Обороты(
	           |		&НачПериода,
	           |		&КонПериода,
	           |		Регистратор,
	           |		Склад = &Склад
	           |			И Фирма = &Фирма) КАК ОстаткиПоСтНДСПоСкладамОбороты
	           |
	           |СГРУППИРОВАТЬ ПО
	           |	ОстаткиПоСтНДСПоСкладамОбороты.Регистратор,
	           |	ОстаткиПоСтНДСПоСкладамОбороты.Период,
	           |	ОстаткиПоСтНДСПоСкладамОбороты.СтавкаНДС.Ставка,
	           |	ОстаткиПоСтНДСПоСкладамОбороты.Регистратор.СкладПолучатель,
	           |	ОстаткиПоСтНДСПоСкладамОбороты.Регистратор.Поставщик.Наименование,
	           |	ОстаткиПоСтНДСПоСкладамОбороты.Регистратор.ВхНомерНакл,
	           |	ОстаткиПоСтНДСПоСкладамОбороты.Регистратор
	           |
	           |УПОРЯДОЧИТЬ ПО
	           |	ОстаткиПоСтНДСПоСкладамОбороты.Регистратор.Дата";
			   
	ДвПрих=Новый Запрос(ТХТ_ДвПрих);
	
	Двприх.УстановитьПараметр("Опт",Перечисления.ТипыМХ.Опт);
	Двприх.УстановитьПараметр("НачПериода",НачалоДня(Начпериода));
	Двприх.УстановитьПараметр("КонПериода",КонецДня(КонПериода));
	Двприх.УстановитьПараметр("Фирма",Фирма);
	Двприх.УстановитьПараметр("Склад",Склад);
	
	ТЗПрих=ДвПрих.Выполнить().Выгрузить();
	
	//------------------<Вывод строк прихода>-------------------GtG---- 
	ДокСС="";
	ДокССПост="";
	ДокСумма=0;
	ДокНДС18Сумма=0;
	ДокНДС10Сумма=0;
	
	ДокСуммаЗ=0;
	ДокНДС18СуммаЗ=0;
	ДокНДС10СуммаЗ=0;	
	
	
	ИтПрихСумма=0;
	ИтПрихНДС18=0;
	ИтПрихНДС10=0;
	
	ИтПрихСуммаЗ=0;
	ИтПрихНДС18З=0;
	ИтПрихНДС10З=0;
	
	Обл=Макет.ПолучитьОбласть("Прих");
	Ном = 0;	
	Для каждого Стр из ТЗПрих Цикл
		
		
		//------------------<Отбросим внутрискладскую перетасовку товара>-------------------GtG----
		Если Стр.Документ.Метаданные().Имя = "ПеремещениеТовара" Тогда
			Если Стр.Документ.Склад=Стр.Документ.СкладПолучатель Тогда
				//Сообщить("Изменеие КМХ "+Стр.Документ);
				продолжить;
			КонецЕсли;	
		КонецЕсли;
		//------------------<пошел документ>-------------------GtG----
		Если ДокСС="" Тогда
			ДокСС=Стр.Документ;
			ДокССПост=Стр.Поставщик;
			ДокССНомер=Стр.ВхНомер;
			ДокСС1СНомер=ДокСС.Номер;
		КонецЕсли;	
		
		//------------------<Выводим предыдущий документ>-------------------GtG----
		Если Стр.Документ<>ДокСС Тогда  // первая строка про документ
			
			//------------------<Вывод строки>-------------------GtG----
			Обл.Параметры.ТипДок    = ДокСС.Метаданные().Синоним;
			Обл.Параметры.ДатаДок	= ДокСС.Дата;
			
			Если ДокССНомер=Null Тогда
				Обл.Параметры.НомерДок	= ДокСС.Номер;
			иначе
				Обл.Параметры.НомерДок	= ДокССНомер;
			КонецЕсли;
				
			Обл.Параметры.Сумма	    = ДокСумма;				
			Обл.Параметры.НДС18		= ДокНДС18Сумма;	
			Обл.Параметры.НДС10	    = ДокНДС10Сумма;
			Обл.Параметры.СуммаБН	    = ДокСумма-ДокНДС18Сумма-ДокНДС10Сумма;
			
			Обл.Параметры.СуммаЗ	    = ДокСуммаЗ;				
			Обл.Параметры.НДСЗ18		= ДокНДС18СуммаЗ;	
			Обл.Параметры.НДСЗ10	    = ДокНДС10СуммаЗ;
			Обл.Параметры.СуммаЗБН	    = ДокСуммаЗ-ДокНДС18СуммаЗ-ДокНДС10СуммаЗ;			
			
			Обл.Параметры.Контрагент= ДокССПост;
			Обл.Параметры.ДокСсылка=ДокСС;
			Обл.Параметры.НомерПА= ДокСС1СНомер;

			
			//------------------<Для итогов>-------------------GtG----
			ИтПрихСумма=ИтПрихСумма+ДокСумма;
			ИтПрихНДС18=ИтПрихНДС18+ДокНДС18Сумма;
			ИтПрихНДС10=ИтПрихНДС10+ДокНДС10Сумма;
			
			ИтПрихСуммаЗ=ИтПрихСуммаЗ+ДокСуммаЗ;
			ИтПрихНДС18З=ИтПрихНДС18З+ДокНДС18СуммаЗ;
			ИтПрихНДС10З=ИтПрихНДС10З+ДокНДС10СуммаЗ;			

			Ном = Ном + 1;
			Обл.Параметры.Ном = Ном;
			Таб.Вывести(Обл);
			
			//------------------<Обнуляем переменные>-------------------GtG----
			ДокСС=Стр.Документ;
			ДокССПост=Стр.Поставщик;
			ДокССНомер=Стр.ВхНомер;
			ДокСС1СНомер=ДокСС.Номер;

			ДокСумма=0;
			ДокНДС18Сумма=0;
			ДокНДС10Сумма=0;
			
			ДокСуммаЗ=0;
			ДокНДС18СуммаЗ=0;
			ДокНДС10СуммаЗ=0;			
		КонецЕсли;	
		//------------------<Заполняем параметры>-------------------GtG----
		ДокСумма=ДокСумма+Стр.Сумма;
		Если Стр.СтавкаНДС=18 Тогда
			ДокНДС18Сумма=Стр.НДС;
		ИначеЕсли Стр.СтавкаНДС=10 Тогда
			ДокНДС10Сумма=Стр.НДС;
		КонецЕсли;
		
		ДокСуммаЗ=ДокСуммаЗ+Стр.СуммаЗ;
		Если Стр.СтавкаНДС=18 Тогда
			ДокНДС18СуммаЗ=Стр.НДСЗ;
		ИначеЕсли Стр.СтавкаНДС=10 Тогда
			ДокНДС10СуммаЗ=Стр.НДСЗ;
		КонецЕсли;		
			
		
	КонецЦикла;	 
	
	//------------------<Последняя строка прихода>-------------------GtG----
	Если ДокСС<>"" Тогда
		Обл.Параметры.ТипДок    = ДокСС.Метаданные().Синоним;
		Обл.Параметры.ДатаДок	= ДокСС.Дата;
		Если ДокССНомер=Null Тогда
			Обл.Параметры.НомерДок	= ДокСС.Номер;
		иначе
			Обл.Параметры.НомерДок	= ДокССНомер;
		КонецЕсли;
		Обл.Параметры.Сумма	    = ДокСумма;				
		Обл.Параметры.НДС18		= ДокНДС18Сумма;	
		Обл.Параметры.НДС10	    = ДокНДС10Сумма;
		Обл.Параметры.СуммаБН	    = ДокСумма-ДокНДС18Сумма-ДокНДС10Сумма;
		
		Обл.Параметры.СуммаЗ	    = ДокСуммаЗ;				
		Обл.Параметры.НДСЗ18		= ДокНДС18СуммаЗ;	
		Обл.Параметры.НДСЗ10	    = ДокНДС10СуммаЗ;
		Обл.Параметры.СуммаЗБН	    = ДокСуммаЗ-ДокНДС18СуммаЗ-ДокНДС10СуммаЗ;		
		
		Обл.Параметры.Контрагент= ДокССПост;
		Обл.Параметры.ДокСсылка=ДокСС;
		Обл.Параметры.НомерПА= ДокСС1СНомер;
		
		Ном = Ном + 1;
		Обл.Параметры.Ном = Ном;
		
		Таб.Вывести(Обл);
    КонецЕсли;
	//------------------<Для итогов>-------------------GtG----
	ИтПрихСумма=ИтПрихСумма+ДокСумма;
	ИтПрихНДС18=ИтПрихНДС18+ДокНДС18Сумма;
	ИтПрихНДС10=ИтПрихНДС10+ДокНДС10Сумма;
	
	ИтПрихСуммаЗ=ИтПрихСуммаЗ+ДокСуммаЗ;
	ИтПрихНДС18З=ИтПрихНДС18З+ДокНДС18СуммаЗ;
	ИтПрихНДС10З=ИтПрихНДС10З+ДокНДС10СуммаЗ;	
	
	Обл=Макет.ПолучитьОбласть("ИтогоПрих");
	
	Обл.Параметры.СуммаПрих		 = ИтПрихСумма;
	Обл.Параметры.НДС18Прих		 = ИтПрихНДС18;	
	Обл.Параметры.НДС10Прих	     = ИтПрихНДС10;
	Обл.Параметры.СуммаПрихБН		 = ИтПрихСумма-ИтПрихНДС18-ИтПрихНДС10;
	
	Обл.Параметры.СуммаПрихЗ		 = ИтПрихСуммаЗ;
	Обл.Параметры.НДС18ПрихЗ		 = ИтПрихНДС18З;	
	Обл.Параметры.НДС10ПрихЗ	     = ИтПрихНДС10З;
	Обл.Параметры.СуммаПрихЗБН		 = ИтПрихСуммаЗ-ИтПрихНДС18З-ИтПрихНДС10З;	

	
	
	Обл.Параметры.СуммаПрихИОст  =НачОстСумма+ИтПрихСумма;			
	Обл.Параметры.НДС18ПрихИОст	 =НачОст18+ИтПрихНДС18;		
	Обл.Параметры.НДС10ПрихИОст	 =НачОст10+ИтПрихНДС10; 
	Обл.Параметры.СуммаПрихИОстБН  =(НачОстСумма+ИтПрихСумма)-(НачОст18+ИтПрихНДС18)-(НачОст10+ИтПрихНДС10);
	
	Обл.Параметры.СуммаПрихИОстЗ  =НачОстСуммаЗ+ИтПрихСуммаЗ;			
	Обл.Параметры.НДС18ПрихИОстЗ	 =НачОстЗ18+ИтПрихНДС18З;		
	Обл.Параметры.НДС10ПрихИОстЗ	 =НачОстЗ10+ИтПрихНДС10З; 
	Обл.Параметры.СуммаПрихИОстЗБН  =(НачОстСуммаЗ+ИтПрихСуммаЗ)-(НачОстЗ18+ИтПрихНДС18З)-(НачОстЗ10+ИтПрихНДС10З);	
	
	
	Обл.Параметры.Чему="приходу"; 
	
	Таб.Вывести(Обл);
	
	//------------------<Расход>-------------------GtG----	
    
	Обл=Макет.ПолучитьОбласть("ЗагПриход");
	Обл.Параметры.ИмяСекции="Расход";
	Таб.Вывести(Обл);

	
	//------------------<строки расхода>-------------------GtG---- 
	ТХТ_ДвПрих="ВЫБРАТЬ РАЗРЕШЕННЫЕ
	           |	Услуги.Ссылка,
	           |	СУММА(Услуги.Сумма) КАК СуммаУслуги,
	           |	Услуги.СтавкаНДС,
	           |	СУММА(Услуги.СуммаНДС) КАК СуммаНДС
	           |ПОМЕСТИТЬ ТЗУслуг
	           |ИЗ
	           |	Документ.РеализацияККМ.АвансыПоУслугам КАК Услуги
	           |ГДЕ
	           |	Услуги.Ссылка.Дата МЕЖДУ &НачПериода И &КонПериода
	           |	И Услуги.Ссылка.Проведен = ИСТИНА
	           |
	           |СГРУППИРОВАТЬ ПО
	           |	Услуги.Ссылка,
	           |	Услуги.СтавкаНДС
	           |;
	           |
	           |////////////////////////////////////////////////////////////////////////////////
	           |ВЫБРАТЬ РАЗРЕШЕННЫЕ
	           |	ОстаткиПоСтНДСПоСкладамОбороты.СтавкаНДС.Ставка КАК СтавкаНДС,
	           |	СУММА(ВЫБОР
	           |			КОГДА ОстаткиПоСтНДСПоСкладамОбороты.Склад.ТипСклада = &Опт
	           |				ТОГДА ОстаткиПоСтНДСПоСкладамОбороты.СуммаЗакупСНДСРасход
	           |			ИНАЧЕ ОстаткиПоСтНДСПоСкладамОбороты.СуммаРознСНДСРасход
	           |		КОНЕЦ) КАК Сумма,
	           |	СУММА(ВЫБОР
	           |			КОГДА ОстаткиПоСтНДСПоСкладамОбороты.Склад.ТипСклада = &Опт
	           |				ТОГДА ОстаткиПоСтНДСПоСкладамОбороты.СуммаНДСЗакупРасход
	           |			ИНАЧЕ ОстаткиПоСтНДСПоСкладамОбороты.СуммаРознНДСРасход
	           |		КОНЕЦ) КАК НДС,
	           |	СУММА(ОстаткиПоСтНДСПоСкладамОбороты.СуммаЗакупСНДСРасход) КАК СуммаЗ,
	           |	СУММА(ОстаткиПоСтНДСПоСкладамОбороты.СуммаНДСЗакупРасход) КАК НДСЗ,
	           |	СУММА(ЕСТЬNULL(ТЗУслуг.СуммаУслуги,0)) КАК СуммаУслуг,
	           |	ОстаткиПоСтНДСПоСкладамОбороты.Регистратор КАК Документ,
	           |	ОстаткиПоСтНДСПоСкладамОбороты.Период,
	           |	ОстаткиПоСтНДСПоСкладамОбороты.Регистратор.СкладПолучатель КАК Получатель,
	           |	ОстаткиПоСтНДСПоСкладамОбороты.Регистратор.Поставщик.Наименование КАК Поставщик,
	           |	ОстаткиПоСтНДСПоСкладамОбороты.Регистратор.ВхНомерНакл КАК ВхНомер
	           |ИЗ
	           |	РегистрНакопления.ОстаткиПоСтНДСПоСкладам.Обороты(
	           |			&НачПериода,
	           |			&КонПериода,
	           |			Регистратор,
	           |			Склад = &Склад
	           |				И Фирма = &Фирма) КАК ОстаткиПоСтНДСПоСкладамОбороты
	           |		ЛЕВОЕ СОЕДИНЕНИЕ ТЗУслуг КАК ТЗУслуг
	           |		ПО (ТЗУслуг.Ссылка = ОстаткиПоСтНДСПоСкладамОбороты.Регистратор)
	           |			И (ТЗУслуг.СтавкаНДС = ОстаткиПоСтНДСПоСкладамОбороты.СтавкаНДС)
	           |
	           |СГРУППИРОВАТЬ ПО
	           |	ОстаткиПоСтНДСПоСкладамОбороты.Регистратор,
	           |	ОстаткиПоСтНДСПоСкладамОбороты.Период,
	           |	ОстаткиПоСтНДСПоСкладамОбороты.СтавкаНДС.Ставка,
	           |	ОстаткиПоСтНДСПоСкладамОбороты.Регистратор.СкладПолучатель,
	           |	ОстаткиПоСтНДСПоСкладамОбороты.Регистратор.Поставщик.Наименование,
	           |	ОстаткиПоСтНДСПоСкладамОбороты.Регистратор.ВхНомерНакл
	           |
	           |УПОРЯДОЧИТЬ ПО
	           |	ОстаткиПоСтНДСПоСкладамОбороты.Регистратор.Дата
	           |;
	           |
	           |////////////////////////////////////////////////////////////////////////////////
	           |УНИЧТОЖИТЬ ТЗУслуг";
			   
	ДвРасх=Новый Запрос(ТХТ_ДвПрих);
	
	ДвРасх.УстановитьПараметр("Опт",Перечисления.ТипыМХ.Опт);
	ДвРасх.УстановитьПараметр("НачПериода",НачалоДня(Начпериода));
	ДвРасх.УстановитьПараметр("КонПериода",КонецДня(КонПериода));
	ДвРасх.УстановитьПараметр("Фирма",Фирма);
	ДвРасх.УстановитьПараметр("Склад",Склад);
	
	ТЗПрих=ДвРасх.Выполнить().Выгрузить();
	
	//------------------<Вывод строк расхода>-------------------GtG---- 
	ДокСС="";
	ДокССПост="";
	ДокСумма=0;
	ДокНДС18Сумма=0;
	ДокНДС10Сумма=0;
	
	ДокСуммаЗ=0;
	ДокНДС18СуммаЗ=0;
	ДокНДС10СуммаЗ=0;	
	
	ДокСуммаУслуг = 0;
	
	ИтРасхСумма=0;
	ИтРасхНДС18=0;
	ИтРасхНДС10=0;
	
	ИтРасхСуммаЗ=0;
	ИтРасхНДС18З=0;
	ИтРасхНДС10З=0;	
	
	ИтСуммаУслуг = 0;
	
	Обл=Макет.ПолучитьОбласть("Расх");
	Ном = 0;	
	Для каждого Стр из ТЗПрих Цикл
			
		
		//------------------<Отбросим внутрискладскую перетасовку товара>-------------------GtG----
		Если Стр.Документ.Метаданные().Имя = "ПеремещениеТовара" Тогда
			Если Стр.Документ.Склад=Стр.Документ.СкладПолучатель Тогда
				//Сообщить("Изменеие КМХ "+Стр.Документ);
				продолжить;
			КонецЕсли;	
		КонецЕсли; 
		//------------------<пошел документ>-------------------GtG---- 
		Если ДокСС="" Тогда
			ДокСС=Стр.Документ;
			Если Стр.Поставщик<>Null тогда
				ДокССПост=Стр.Поставщик;
			Иначеесли Стр.Получатель<> Null тогда
				ДокССПост=Стр.Получатель;
			КонецЕсли; 	
			ДокССНомер=Стр.ВхНомер;
			ДокСС1СНомер=Стр.Документ.Номер;
		КонецЕсли;
		
		//------------------<Выводим предыдущий документ>-------------------GtG----
		Если Стр.Документ<>ДокСС Тогда  // первая строка про документ
			
			//------------------<Вывод строки>-------------------GtG----
			Обл.Параметры.ТипДок    = ДокСС.Метаданные().Синоним;
			Обл.Параметры.ДатаДок	= ДокСС.Дата;
			
			Если ДокССНомер=Null Тогда
				Обл.Параметры.НомерДок	= "";//ДокСС.Номер;
			иначе
				Обл.Параметры.НомерДок	= ДокССНомер;
			КонецЕсли;
				
			Обл.Параметры.Сумма	    = ДокСумма;				
			Обл.Параметры.НДС18		= ДокНДС18Сумма;	
			Обл.Параметры.НДС10	    = ДокНДС10Сумма;
			Обл.Параметры.СуммаБН	    = ДокСумма-ДокНДС18Сумма-ДокНДС10Сумма;	
			
			Обл.Параметры.СуммаЗ	    = ДокСуммаЗ;				
			Обл.Параметры.НДСЗ18		= ДокНДС18СуммаЗ;	
			Обл.Параметры.НДСЗ10	    = ДокНДС10СуммаЗ;
			Обл.Параметры.СуммаЗБН	    = ДокСуммаЗ-ДокНДС18СуммаЗ-ДокНДС10СуммаЗ;				
			Обл.Параметры.СуммаУслуг	= ДокСуммаУслуг;
			
			Обл.Параметры.Контрагент= ДокССПост;
			Обл.Параметры.ДокСсылка=ДокСС;
			Обл.Параметры.НомерПА= ДокСС1СНомер;
			Ном = Ном + 1;
			Обл.Параметры.Ном = Ном;		
			
			//------------------<Отметки бухгалтерии по реализации ККМ>-------------------GtG----19.11.2008
			БУхОтм="";
			Если   ТипЗнч(ДокСС)=Тип("ДокументСсылка.РеализацияККМ") Тогда
				Если ДокСС.Затычка=Истина И ДокСС.Товар.Количество()=0 Тогда
					БУхОтм=" Вручную!";
				КонецЕсли; 	
				
				Если ДокСС.Затычка=Истина И ДокСС.Товар.Количество()<>0 Тогда
					БУхОтм=БУхОтм+" Неоконч. смена!";
				КонецЕсли; 
				
				Если ДокСС.Затычка=Ложь И ДокСС.Проверен=Истина Тогда
					БУхОтм=БУхОтм+" V";
				КонецЕсли; 
				
				Если ДокСС.Затычка=Ложь И ДокСС.Проверен=Ложь Тогда
					БУхОтм=БУхОтм+" Не проверен";
				КонецЕсли; 
				
				Если ДокСС.Бухгалтерия.Найти(0,"ЗакупочнаяСНДС")<> Неопределено ТОгда
					БУхОтм=БУхОтм+" Исправлен вручную!";
				КонецЕсли; 	
				
				
			КонецЕсли;	
			Обл.Параметры.ОтметкаБух = БухОтм;
			
			
			
			//------------------<Для итогов>-------------------GtG----
			ИтРасхСумма=ИтРасхСумма+ДокСумма;
			ИтРасхНДС18=ИтРасхНДС18+ДокНДС18Сумма;
			ИтРасхНДС10=ИтРасхНДС10+ДокНДС10Сумма;
			
			ИтРасхСуммаЗ=ИтРасхСуммаЗ+ДокСуммаЗ;
			ИтРасхНДС18З=ИтРасхНДС18З+ДокНДС18СуммаЗ;
			ИтРасхНДС10З=ИтРасхНДС10З+ДокНДС10СуммаЗ;			

			ИтСуммаУслуг = ИтСуммаУслуг + ДокСуммаУслуг;
			
			Таб.Вывести(Обл);
			
			//------------------<Обнуляем переменные>-------------------GtG----
			ДокСС=Стр.Документ;
			Если Стр.Поставщик<>Null тогда
				ДокССПост=Стр.Поставщик;
			Иначеесли Стр.Получатель<> Null тогда
				ДокССПост=Стр.Получатель;
			КонецЕсли; 	

			ДокССНомер=Стр.ВхНомер;
			ДокСС1СНомер=Стр.Документ.Номер;
			
			ДокСумма=0;
			ДокНДС18Сумма=0;
			ДокНДС10Сумма=0;
			
			ДокСуммаЗ=0;
			ДокНДС18СуммаЗ=0;
			ДокНДС10СуммаЗ=0;	
			ДокСуммаУслуг = 0;
		КонецЕсли;	
		//------------------<Заполняем параметры>-------------------GtG----
		ДокСумма=ДокСумма+Стр.Сумма;
		Если Стр.СтавкаНДС=18 Тогда
			ДокНДС18Сумма=Стр.НДС;
		ИначеЕсли Стр.СтавкаНДС=10 Тогда
			ДокНДС10Сумма=Стр.НДС;
		КонецЕсли;
		
		ДокСуммаЗ=ДокСуммаЗ+Стр.СуммаЗ;
		Если Стр.СтавкаНДС=18 Тогда
			ДокНДС18СуммаЗ=Стр.НДСЗ;
		ИначеЕсли Стр.СтавкаНДС=10 Тогда
			ДокНДС10СуммаЗ=Стр.НДСЗ;
		КонецЕсли;
		
		ДокСуммаУслуг = ДокСуммаУслуг + стр.СуммаУслуг;
		
	КонецЦикла;	 
	
	//------------------<Последняя строка Расхода>-------------------GtG----
	Если ДокСС<>"" Тогда
		Обл.Параметры.ТипДок    = ДокСС.Метаданные().Синоним;
		Обл.Параметры.ДатаДок	= ДокСС.Дата;
		Если ДокССНомер=Null Тогда
			Обл.Параметры.НомерДок	= "";//ДокСС.Номер;
		иначе
			Обл.Параметры.НомерДок	= ДокССНомер;
		КонецЕсли;
		Обл.Параметры.Сумма	    = ДокСумма;				
		Обл.Параметры.НДС18		= ДокНДС18Сумма;	
		Обл.Параметры.НДС10	    = ДокНДС10Сумма;
		Обл.Параметры.СуммаБН	    = ДокСумма-ДокНДС18Сумма-ДокНДС10Сумма;	

		Обл.Параметры.СуммаЗ	    = ДокСуммаЗ;				
		Обл.Параметры.НДСЗ18		= ДокНДС18СуммаЗ;	
		Обл.Параметры.НДСЗ10	    = ДокНДС10СуммаЗ;
		Обл.Параметры.СуммаЗБН	    = ДокСуммаЗ-ДокНДС18СуммаЗ-ДокНДС10СуммаЗ;	
		
		Обл.Параметры.СуммаУслуг	= ДокСуммаУслуг;
		
		
		Обл.Параметры.Контрагент= ДокССПост;
		Обл.Параметры.ДокСсылка=ДокСС;
		Обл.Параметры.НомерПА= ДокСС1СНомер;
		Ном = Ном + 1;
		Обл.Параметры.Ном = Ном;		

		Таб.Вывести(Обл);
	КонецЕсли; 
	//------------------<Для итогов>-------------------GtG----
	ИтРасхСумма=ИтРасхСумма+ДокСумма;
	ИтРасхНДС18=ИтРасхНДС18+ДокНДС18Сумма;
	ИтРасхНДС10=ИтРасхНДС10+ДокНДС10Сумма;
	
	ИтРасхСуммаЗ=ИтРасхСуммаЗ+ДокСуммаЗ;
	ИтРасхНДС18З=ИтРасхНДС18З+ДокНДС18СуммаЗ;
	ИтРасхНДС10З=ИтРасхНДС10З+ДокНДС10СуммаЗ;	
	
	ИтСуммаУслуг = ИтСуммаУслуг + ДокСуммаУслуг;
	
	Обл=Макет.ПолучитьОбласть("ИтогоПрих");
	
	Обл.Параметры.СуммаПрих		 = ИтРасхСумма;
	Обл.Параметры.НДС18Прих		 = ИтРасхНДС18;	
	Обл.Параметры.НДС10Прих	     = ИтРасхНДС10;
	Обл.Параметры.СуммаПрихБН		 = ИтРасхСумма-ИтРасхНДС18-ИтРасхНДС10;
	
	Обл.Параметры.СуммаПрихЗ		 = ИтРасхСуммаЗ;
	Обл.Параметры.НДС18ПрихЗ		 = ИтРасхНДС18З;	
	Обл.Параметры.НДС10ПрихЗ	     = ИтРасхНДС10З;
	Обл.Параметры.СуммаПрихЗБН		 = ИтРасхСуммаЗ-ИтРасхНДС18З-ИтРасхНДС10З;	

	Обл.Параметры.ИтСуммаУслуг	 = ИтСуммаУслуг;
	
	Обл.Параметры.СуммаПрихИОст  =НачОстСумма+ИтПрихСумма-ИтРасхСумма;			
	Обл.Параметры.НДС18ПрихИОст	 =НачОст18+ИтПрихНДС18-ИтРасхНДС18;		
	Обл.Параметры.НДС10ПрихИОст	 =НачОст10+ИтПрихНДС10-ИтРасхНДС10;
	Обл.Параметры.СуммаПрихИОстБН  =(НачОстСумма+ИтПрихСумма-ИтРасхСумма)-(НачОст18+ИтПрихНДС18-ИтРасхНДС18)-(НачОст10+ИтПрихНДС10-ИтРасхНДС10);	
	
	Обл.Параметры.СуммаПрихИОстЗ  =НачОстСуммаЗ+ИтПрихСуммаЗ-ИтРасхСуммаЗ;			
	Обл.Параметры.НДС18ПрихИОстЗ	 =НачОстЗ18+ИтПрихНДС18З-ИтРасхНДС18З;		
	Обл.Параметры.НДС10ПрихИОстЗ	 =НачОстЗ10+ИтПрихНДС10З-ИтРасхНДС10З;
	Обл.Параметры.СуммаПрихИОстЗБН  =(НачОстСуммаЗ+ИтПрихСуммаЗ-ИтРасхСуммаЗ)-(НачОстЗ18+ИтПрихНДС18З-ИтРасхНДС18З)-(НачОстЗ10+ИтПрихНДС10З-ИтРасхНДС10З);		
	
	Обл.Параметры.Чему="расходу"; 
	
	Таб.Вывести(Обл);
	
	Обл=Макет.ПолучитьОбласть("Подписи");
	Таб.Вывести(Обл);
	
	
	
	
	//------------------<Вывод таблицы на экран>-------------------GtG---- 
	Таб.АвтоМасштаб=Истина;
	Таб.ТолькоПросмотр=Истина;
	Таб.ОтображатьСетку=Ложь;
	Таб.ОтображатьЗаголовки=Ложь;
	Таб.ОриентацияСтраницы = ОриентацияСтраницы.Ландшафт;
	Таб.ФиксацияСверху = 17;
	
	Таб.Показать("Товарный отчет");
	
КонецПроцедуры

Процедура ВыбПериодНажатие(Элемент)
	НастройкаПериода = Новый НастройкаПериода;
	НастройкаПериода.УстановитьПериод(НачПериода, ?(КонПериода='0001-01-01', КонПериода, КонецДня(КонПериода)));
	НастройкаПериода.РедактироватьКакИнтервал = Истина;
	НастройкаПериода.РедактироватьКакПериод = Истина;
	НастройкаПериода.ВариантНастройки = ВариантНастройкиПериода.Период;
	Если НастройкаПериода.Редактировать() Тогда
		НачПериода = НастройкаПериода.ПолучитьДатуНачала();
		КонПериода = НастройкаПериода.ПолучитьДатуОкончания();
	КонецЕсли;
КонецПроцедуры

Процедура ПриОткрытии()
	// Вставить содержимое обработчика.
	//Склад=Константы.ОсновнойСклад.Получить();
	//Фирма=Константы.ОсновнаяФирма.Получить();
КонецПроцедуры

Процедура СкладПриИзменении(Элемент)
	
	Фирма = Элемент.Значение.Фирма;
	
КонецПроцедуры

Процедура ФирмаПриИзменении(Элемент)
	Если Элемент.Значение <> Склад.Фирма Тогда
		Склад = Справочники.МестаХранения.ПустаяСсылка();	
	КонецЕсли;
КонецПроцедуры


