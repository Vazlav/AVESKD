//============================< ДОДЕЛАТЬ: >================================GtG===
//ПРИ ВЫБОРЕ ПАРТИИ ИЗ ТЯЦЕКИ тз ЗАПУСКАТЬ ОТЧЕТ - ДВИЖЕНИЯ ОСТАТКИ ТОВАРА ПО ПАРТИЯМ  
//С ПАРАМЕТРАМИ КАК У ТЕКУЩЕГО ОТЧЕТА ПО РЕГИСТРУ ОСТАТКОВ ПАРТИЙ ТОВАРОВ жнвлс

Процедура КнопкаСформироватьНажатие(Кнопка)
	
	
	СписокУсловий = Новый  СписокЗначений;
	
	//Если ВыбФирма <> Справочники.Фирмы.ПустаяСсылка() Тогда
	//	СписокУсловий.Добавить("Фирма = &ВыбФирма");
	//КонецЕсли; 
	
	Если ВыбТовар.Пустая() и ВыбПартия.Пустая() Тогда
		Предупреждение("Выберите либо товар, либо партию.");
		Возврат;
	КонецЕсли;
	
	
	Если СписокТоваров.Количество()>0 Тогда
		СписокУсловий.Добавить("Товар В (&ВыбСпиокТоваров)");
	Иначе	
		Если НЕ ВыбТовар.Пустая() Тогда
			СписокУсловий.Добавить("Товар = &ВыбТовар");
		КонецЕсли; 
	КонецЕсли; 
	
	Если НЕ ВыбСклад.Пустая() Тогда
		СписокУсловий.Добавить("Склад = &ВыбСклад");
		//СписокУсловий.Добавить("СкладПолучатель = &ВыбСклад");

	КонецЕсли; 
	
	//Если ВыбПартия <> Справочники.Партии.ПустаяСсылка() Тогда
	//	СписокУсловий.Добавить("Партия = &ВыбПартия");
	//КонецЕсли; 				
	
	
	//УОР=ОМ8_СуперГдя(СписокУсловий,, ИСТИНА ) ; // условие ограничения выборки по регистру без Where
	Масс = "";
	//Сообщить(" "+УОР+" ");
	Если ВыбПартия.Пустая() Тогда
		
		//
		//ТХТ = "ВЫБРАТЬ РАЗРЕШЕННЫЕ
		//      |	Партии.Ссылка как ПартииСсылка
		//      |ИЗ
		//      |	Справочник.Партии КАК Партии
		//      |ГДЕ
		//      |	Партии.Владелец = &ТоварСсылка";
		//	  
		//	Запрос=Новый Запрос(ТХТ);
		//	Запрос.УстановитьПараметр("ТоварСсылка",ВыбТовар);
		//	Масс = Запрос.Выполнить().Выгрузить().ВыгрузитьКолонку("ПартииСсылка");  
		//УсловиеПартии = " Партия В ( &МассивПартий )";
	Иначе
		УсловиеПартии = " Партия = &ВыбПартия ";
		СписокУсловий.Добавить("Партия = &ВыбПартия");
	КонецЕсли;
	СписокУсловийСтрока = "";
	Если СписокУсловий.Количество() > 0 Тогда
		Для каждого стр из СписокУсловий Цикл
			СписокУсловийСтрока = СписокУсловийСтрока + "и "	 + стр.Значение + " ";
		КонецЦикла;
		СписокУсловийСтрока = Сред(СписокУсловийСтрока,2,СтрДлина(СписокУсловийСтрока));
	КонецЕсли;
	
	Если ВыбТовар.Разбивается = Ложь Тогда
		ТХТ="ВЫБРАТЬ РАЗРЕШЕННЫЕ
		|	ОстаткиИОбороты.Регистратор.Дата КАК ДатаДок,
		|	ОстаткиИОбороты.Регистратор.Номер КАК НомерДок,
		|	ОстаткиИОбороты.Регистратор КАК Документ,
		|	ОстаткиИОбороты.Товар.Наименование КАК Товар,
		|	ОстаткиИОбороты.Склад.Наименование КАК Склад,
		|	ОстаткиИОбороты.СтавкаНДС.Наименование КАК СтавкаНДС,
		//|	ОстаткиИОбороты.Фирма.Наименование КАК Фирма,
		|	ОстаткиИОбороты.Партия.СерияСтрока КАК Серия,
		|	ОстаткиИОбороты.Партия.СрокГодности КАК СрокГодности,
		|	ОстаткиИОбороты.КолвоПриход КАК КолвоПриход,
		|	ОстаткиИОбороты.КолвоРасход КАК КолвоРасход,
		|	ОстаткиИОбороты.СуммаЗакупСНДСПриход КАК СуммаЗакупСНДСПриход,
		|	ОстаткиИОбороты.СуммаЗакупСНДСРасход КАК СуммаЗакупСНДСРасход,
		//|	ОстаткиИОбороты.СуммаНДСЗакупПриход КАК СуммаНДСЗакупПриход,
		//|	ОстаткиИОбороты.СуммаНДСЗакупРасход КАК СуммаНДСЗакупРасход,
		|	ОстаткиИОбороты.СуммаРознСНДСПриход КАК СуммаРознСНДСПриход,
		|	ОстаткиИОбороты.СуммаРознСНДСРасход КАК СуммаРознСНДСРасход,
		//|	ОстаткиИОбороты.СуммаРознНДСПриход КАК СуммаРознНДСПриход,
		//|	ОстаткиИОбороты.СуммаРознНДСРасход КАК СуммаРознНДСРасход,
		|	ОстаткиИОбороты.СуммаЗакупСНДСНачальныйОстаток КАК СуммаЗакупСНДСНачальныйОстаток,
		|	ОстаткиИОбороты.СуммаЗакупСНДСКонечныйОстаток КАК СуммаЗакупСНДСКонечныйОстаток,
		//|	ОстаткиИОбороты.СуммаНДСЗакупНачальныйОстаток КАК СуммаНДСЗакупНачальныйОстаток,
		//|	ОстаткиИОбороты.СуммаНДСЗакупКонечныйОстаток КАК СуммаНДСЗакупКонечныйОстаток,
		|	ОстаткиИОбороты.СуммаРознСНДСНачальныйОстаток КАК СуммаРознСНДСНачальныйОстаток,
		|	ОстаткиИОбороты.СуммаРознСНДСКонечныйОстаток КАК СуммаРознСНДСКонечныйОстаток,
		//|	ОстаткиИОбороты.СуммаРознНДСНачальныйОстаток КАК СуммаРознНДСНачальныйОстаток,
		//|	ОстаткиИОбороты.СуммаРознНДСКонечныйОстаток КАК СуммаРознНДСКонечныйОстаток,
		|	ОстаткиИОбороты.КолвоНачальныйОстаток КАК КолвоНачальныйОстаток,
		|	ОстаткиИОбороты.КолвоКонечныйОстаток КАК КолвоКонечныйОстаток,
		|	ОстаткиИОбороты.Партия КАК Партия
		//|	ОстаткиИОбороты.Регистратор.СкладПолучатель.Наименование КАК СкладПолучательНаименование
		|ИЗ
		|	РегистрНакопления.ПартииЖНВЛС.ОстаткиИОбороты(&НачПер, &КонПер, Регистратор, ДвиженияИГраницыПериода," + СписокУсловийСтрока + "  ) КАК ОстаткиИОбороты
		//|ГДЕ "+УОР+"
		|
		|УПОРЯДОЧИТЬ ПО
		|	Партия,
		|	ДатаДок
		|ИТОГИ
		|	СУММА(СуммаЗакупСНДСНачальныйОстаток),
		|	СУММА(СуммаЗакупСНДСКонечныйОстаток),
		//|	СУММА(СуммаНДСЗакупНачальныйОстаток),
		//|	СУММА(СуммаНДСЗакупКонечныйОстаток),
		|	СУММА(СуммаРознСНДСНачальныйОстаток),
		|	СУММА(СуммаРознСНДСКонечныйОстаток),
		//|	СУММА(СуммаРознНДСНачальныйОстаток),
		//|	СУММА(СуммаРознНДСКонечныйОстаток),
		|	СУММА(КолвоНачальныйОстаток),
		|	СУММА(КолвоКонечныйОстаток)
		|ПО
		|	Партия";
	Иначе
		
		ТХТ="ВЫБРАТЬ РАЗРЕШЕННЫЕ
		|	ОстаткиИОбороты.Регистратор.Дата КАК ДатаДок,
		|	ОстаткиИОбороты.Регистратор.Номер КАК НомерДок,
		|	ОстаткиИОбороты.Регистратор КАК Документ,
		|	ОстаткиИОбороты.Товар.Наименование КАК Товар,
		|	ОстаткиИОбороты.Склад.Наименование КАК Склад,
		|	ОстаткиИОбороты.СтавкаНДС.Наименование КАК СтавкаНДС,
		//|	ОстаткиИОбороты.Фирма.Наименование КАК Фирма,
		|	ОстаткиИОбороты.Партия.СерияСтрока КАК Серия,
		|	ОстаткиИОбороты.Партия.СрокГодности КАК СрокГодности,
		|	ОстаткиИОбороты.КолвоПриход/ОстаткиИОбороты.Партия.К КАК КолвоПриход,
		|	ОстаткиИОбороты.КолвоРасход/ОстаткиИОбороты.Партия.К КАК КолвоРасход,
		|	ОстаткиИОбороты.СуммаЗакупСНДСПриход КАК СуммаЗакупСНДСПриход,
		|	ОстаткиИОбороты.СуммаЗакупСНДСРасход КАК СуммаЗакупСНДСРасход,
		//|	ОстаткиИОбороты.СуммаНДСЗакупПриход КАК СуммаНДСЗакупПриход,
		//|	ОстаткиИОбороты.СуммаНДСЗакупРасход КАК СуммаНДСЗакупРасход,
		|	ОстаткиИОбороты.СуммаРознСНДСПриход КАК СуммаРознСНДСПриход,
		|	ОстаткиИОбороты.СуммаРознСНДСРасход КАК СуммаРознСНДСРасход,
		//|	ОстаткиИОбороты.СуммаРознНДСПриход КАК СуммаРознНДСПриход,
		//|	ОстаткиИОбороты.СуммаРознНДСРасход КАК СуммаРознНДСРасход,
		|	ОстаткиИОбороты.СуммаЗакупСНДСНачальныйОстаток КАК СуммаЗакупСНДСНачальныйОстаток,
		|	ОстаткиИОбороты.СуммаЗакупСНДСКонечныйОстаток КАК СуммаЗакупСНДСКонечныйОстаток,
		//|	ОстаткиИОбороты.СуммаНДСЗакупНачальныйОстаток КАК СуммаНДСЗакупНачальныйОстаток,
		//|	ОстаткиИОбороты.СуммаНДСЗакупКонечныйОстаток КАК СуммаНДСЗакупКонечныйОстаток,
		|	ОстаткиИОбороты.СуммаРознСНДСНачальныйОстаток КАК СуммаРознСНДСНачальныйОстаток,
		|	ОстаткиИОбороты.СуммаРознСНДСКонечныйОстаток КАК СуммаРознСНДСКонечныйОстаток,
		//|	ОстаткиИОбороты.СуммаРознНДСНачальныйОстаток КАК СуммаРознНДСНачальныйОстаток,
		//|	ОстаткиИОбороты.СуммаРознНДСКонечныйОстаток КАК СуммаРознНДСКонечныйОстаток,
		|	ОстаткиИОбороты.КолвоНачальныйОстаток/ОстаткиИОбороты.Партия.К КАК КолвоНачальныйОстаток,
		|	ОстаткиИОбороты.КолвоКонечныйОстаток/ОстаткиИОбороты.Партия.К КАК КолвоКонечныйОстаток,
		|	ОстаткиИОбороты.Партия КАК Партия
		//|	ОстаткиИОбороты.Регистратор.СкладПолучатель.Наименование КАК СкладПолучательНаименование
		|ИЗ
		|	РегистрНакопления.ПартииЖНВЛС.ОстаткиИОбороты(&НачПер, &КонПер, Регистратор, ДвиженияИГраницыПериода," + СписокУсловийСтрока + "  ) КАК ОстаткиИОбороты
		//|ГДЕ "+УОР+"
		|
		|УПОРЯДОЧИТЬ ПО
		|	Партия.Код,
		|	ДатаДок
		|ИТОГИ
		|	СУММА(СуммаЗакупСНДСНачальныйОстаток),
		|	СУММА(СуммаЗакупСНДСКонечныйОстаток),
		//|	СУММА(СуммаНДСЗакупНачальныйОстаток),
		//|	СУММА(СуммаНДСЗакупКонечныйОстаток),
		|	СУММА(СуммаРознСНДСНачальныйОстаток),
		|	СУММА(СуммаРознСНДСКонечныйОстаток),
		//|	СУММА(СуммаРознНДСНачальныйОстаток),
		//|	СУММА(СуммаРознНДСКонечныйОстаток),
		|	СУММА(КолвоНачальныйОстаток),
		|	СУММА(КолвоКонечныйОстаток)
		|ПО
		|	Партия";
		
	КонецЕсли;
	
	Запрос=Новый Запрос(ТХТ);
	//Сообщить(ТХТ);
	//Возврат;
	
	Запрос.УстановитьПараметр("НачПер",НачалоДня(НачПер));//ВАЖНО! начало и конец дня
	Запрос.УстановитьПараметр("КонПер",КонецДня(КонПер)); //ВАЖНО
	Запрос.УстановитьПараметр("ВыбФирма",ВыбФирма);
	Запрос.УстановитьПараметр("ВыбСклад",ВыбСклад);
	Запрос.УстановитьПараметр("ВыбТовар",ВыбТовар);
	Запрос.УстановитьПараметр("ВыбСпиокТоваров",СписокТоваров);
	Запрос.УстановитьПараметр("ВыбПартия",ВыбПартия);
	Запрос.УстановитьПараметр("МассивПартий",Масс);
	
	ДерДвиж=ЗАпрос.Выполнить();//ОМ8_ВыполнитьЗапросНаСервере (Тхт,ЗначениеВСтрокуВнутр(СПЗ),2);
	
	Если ДерДвиж=Неопределено ТОгда
		Предупреждение("Ошибка при выполнении запроса! КОД:000001");
		ВОЗВРАТ ;
	КонецЕсли;
	
	
	//============================< Шаблон печати таблицы начало >================================GtG===
	
	Таб = Новый  ТабличныйДокумент;
	Таб.ОтображатьСетку= ЛОЖЬ;
	Таб.АвтоМасштаб= ИСТИНА;
	Таб.ОтображатьЗаголовки = Ложь;
	
	Мак = ЭтотОбъект.ПолучитьМакет("ОтчетОДвиженияхТоваров");
	
	КолвоСтрокШапки=0;
	
	//============================< Шапка таблицы >================================GtG===
	
	Секц  = Мак.ПолучитьОбласть("Сформирован");
	Струк = Новый Структура;
	Струк.Вставить("Сост",РабочаяДата);
	
	Секц.Параметры.Заполнить(Струк);
	
	Таб.Вывести(Секц);
	
	Секц  = Мак.ПолучитьОбласть("Заголовок");
	Струк = Новый  Структура;
	Струк.Вставить("НачПерДата",Формат(НачПер,"ДФ=dd.MM.yy"));
	Струк.Вставить("КонПерДата",Формат(КонПер,"ДФ=dd.MM.yy"));
	Секц.Параметры.Заполнить(Струк);
	
	Таб.Вывести(Секц);
	
	Если НЕ ВыбФирма.Пустая() Тогда
		Секц=Мак.ПолучитьОбласть("УсловиеФирма");
		Струк= Новый  Структура;
		Струк.Вставить("ВыбФирма",ВыбФирма);
		Секц.Параметры.Заполнить(Струк);
		Таб.Вывести(Секц);
	КонецЕсли; 
	
	Если НЕ ВыбСклад.Пустая() Тогда
		Секц=Мак.ПолучитьОбласть("УсловиеСклад");  
		Струк= Новый  Структура;
		Струк.Вставить("ВыбСклад",ВыбСклад);
		Секц.Параметры.Заполнить(Струк);
		Таб.Вывести(Секц);
	КонецЕсли; 
	
	Если СписокТоваров.Количество()>0 Тогда
		Секц=Мак.ПолучитьОбласть("УсловиеТовар");  
		Струк= Новый  Структура;
		Струк.Вставить("Выбтовар","По указаному списку...");
		Секц.Параметры.Заполнить(Струк);
		Таб.Вывести(Секц);
	КонецЕсли; 	
	
	Если НЕ ВыбТовар.Пустая() Тогда
		Секц=Мак.ПолучитьОбласть("УсловиеТовар");  
		Струк= Новый  Структура;
		Струк.Вставить("Выбтовар",Выбтовар);
		Струк.Вставить("КодАП",Выбтовар.Код);

		Секц.Параметры.Заполнить(Струк);
		Таб.Вывести(Секц);
	КонецЕсли; 
	
	Секц=Мак.ПолучитьОбласть("ШапкаТД");  
	Таб.Вывести(Секц);	
	
	КолвоСтрокШапки = Таб.ВысотаТаблицы;// колво строк уже выведенных в таб	
	//Инициализация переменных
	

	
	
	ВыборкаТ=ДерДвиж.Выбрать(ОбходРезультатаЗапроса.Прямой);
	
	ТекПартия="";
	Заголовок=Истина;  Первая=Истина;
	СекцКонОст = Мак.ПолучитьОбласть("КонОст"); 
	Пока ВыборкаТ.Следующий() Цикл
		
		Если ТекПартия<>ВыборкаТ.Партия  Тогда
			Если Заголовок=Истина ТОгда
				
				Заголовок=Ложь;//выведен
			Иначе
				//------------------<Выводим итоги и заголовок след.>-------------------GtG----
				Если Первая=Ложь тогда
					Таб.ЗакончитьГруппуСтрок();
					Таб.Вывести(СекцКонОст);// конец предыдущей
				КонецЕсли;
				Заголовок=Истина;
			КонецЕсли;
			//------------------<Выводим заголовок серии>-------------------GtG----
			
				СекцОст = Мак.ПолучитьОбласть("НачОст"); 
				СекцОст.Параметры.Колво = ВыборкаТ.КолвоНачальныйОстаток;
				СекцОст.Параметры.СуммаЗакуп=ВыборкаТ.СуммаЗакупСНДСНачальныйОстаток;			
				СекцОст.Параметры.СуммаРозн	=ВыборкаТ.СуммаРознСНДСНачальныйОстаток;
				//Серия = ВыборкаТ.Партия.Серия;
				СтрокаПартии = "" + ВыборкаТ.Партия + " Серия: " +ВыборкаТ.Серия + " Срок: " + Формат(ВыборкаТ.СрокГодности,"ДФ=dd.MM.yyyy");
				СекцОст.Параметры.Партия=СтрокаПартии;
				Таб.Вывести(СекцОст);
				Таб.НачатьГруппуСтрок();
				Первая=Ложь;
				
				//------------------<Держим в уме секцию кон остатка>-------------------GtG---- 
				// на случай если след строка от другой серии
				СекцКонОст = Мак.ПолучитьОбласть("КонОст"); 
				СекцКонОст.Параметры.Колво = ВыборкаТ.КолвоКонечныйОстаток;
				СекцКонОст.Параметры.СуммаЗакуп=ВыборкаТ.СуммаЗакупСНДСКонечныйОстаток;			
				СекцКонОст.Параметры.СуммаРозн	=ВыборкаТ.СуммаРознСНДСКонечныйОстаток;		
				СекцКонОст.Параметры.Партия=СтрокаПартии;

				
			ТекПартия=ВыборкаТ.Партия;
			продолжить;
		КонецЕсли; 
		
		Если ВыборкаТ.Документ = Неопределено Тогда
			продолжить;
		КонецЕсли;
		
		////------------------<Держим в уме секцию кон остатка>-------------------GtG---- 
		//// на случай если след строка от другой серии
		//СекцКонОст = Мак.ПолучитьОбласть("КонОст"); 
		//СекцКонОст.Параметры.Колво = ВыборкаТ.КолвоКонечныйОстаток;
		//СекцКонОст.Параметры.СуммаЗакуп=ВыборкаТ.СуммаЗакупСНДСКонечныйОстаток;			
		//СекцКонОст.Параметры.СуммаРозн	=ВыборкаТ.СуммаРознСНДСКонечныйОстаток;		
		//СекцКонОст.Параметры.Серия=ВыборкаТ.Серия;

		//--------------------------------------------------------GtG----КОНЕЦ
		ВидДокумента = ВыборкаТ.Документ.Метаданные().Имя;
		//------------------<Выводим строку серии>-------------------GtG----
		СекСтр= Мак.ПолучитьОбласть("Движение");
		
		СекСтр.Параметры.ДатаДок	=  ВыборкаТ.ДатаДок;
		СекСтр.Параметры.НомерДок	=  ВыборкаТ.НомерДок;
		СекСтр.Параметры.ВидДок	    =  ВыборкаТ.Документ.Метаданные().Представление();
		//------------------<Выводим статус документа , если он есть>-------------------Virus----17.01.2008
		Если ВыборкаТ.Документ.Метаданные().Реквизиты.Найти("Статус") <> Неопределено Тогда
			Статус = ВыборкаТ.Документ.Статус;
		Иначе
			Статус = "";
		КонецЕсли;
		СекСтр.Параметры.Статус = Статус;
		//--------------------------------------------------------Virus----КОНЕЦ--17.01.2008
		//Если ВыборкаТ.СкладПолучательНаименование<>NULL Тогда
		//	СекСтр.Параметры.Склад	    =  ВыборкаТ.СкладПолучательНаименование;
		//Иначе
			СекСтр.Параметры.Склад	    =  ВыборкаТ.Склад;
		//КонецЕсли; 	
		
		ЕСли  ВидДокумента="ПоступлениеТовара" Тогда
			СекСтр.Параметры.СкладОтпр	    =  ВыборкаТ.Документ.Поставщик;
			СекСтр.Параметры.Склад	    =  ВыборкаТ.Документ.Склад;
		КонецЕсли; 	

		ЕСли  ВидДокумента="ПеремещениеТовара" Тогда
			СекСтр.Параметры.СкладОтпр	    =  ВыборкаТ.Документ.Склад;
			СекСтр.Параметры.Склад	    =  ВыборкаТ.Документ.СкладПолучатель;
		КонецЕсли;
		
		ЕСли  ВидДокумента="ПереоприходованиеЕИТ" Тогда
			СекСтр.Параметры.СкладОтпр	    =  ВыборкаТ.Документ.Склад;
			СекСтр.Параметры.Склад	    =  ВыборкаТ.Документ.Склад;
		КонецЕсли;
		
		
		
		
		СекСтр.Параметры.СтавкаНДС	=  ВыборкаТ.СтавкаНДС;
		//СекСтр.Параметры.Серия	    =  ВыборкаТ.Серия;
		//СекСтр.Параметры.СрокГодн	=  ВыборкаТ.СерияСГ;
		СекСтр.Параметры.КолвоПрих	=  ВыборкаТ.КолвоПриход;
		СекСтр.Параметры.КолвоРасх	=  ВыборкаТ.КолвоРасход;
		Попытка
			СекСтр.Параметры.ЦенаЗакуп	=  ?(ВыборкаТ.КолвоПриход<>0,Окр(ВыборкаТ.СуммаЗакупСНДСПриход/ВыборкаТ.КолвоПриход,2),Окр(ВыборкаТ.СуммаЗакупСНДСРасход/ВыборкаТ.КолвоРасход,2));
			СекСтр.Параметры.ЦенаРозн	=  ?(ВыборкаТ.КолвоПриход<>0,Окр(ВыборкаТ.СуммаРознСНДСПриход/ВыборкаТ.КолвоПриход,2),Окр(ВыборкаТ.СуммаРознСНДСРасход/ВыборкаТ.КолвоРасход,2));
		ИСключение
			Сообщить("Деление на ноль (нет ни прихода ни расхода) "+ ВыборкаТ.Товар+"  Серия: "+ВыборкаТ.Серия);
		КонецПопытки; 
		СекСтр.Параметры.СуммаЗакупПрих	=  ВыборкаТ.СуммаЗакупСНДСПриход;
		СекСтр.Параметры.СуммаЗакупРасх =  ВыборкаТ.СуммаЗакупСНДСРасход;		
		СекСтр.Параметры.СуммаРознПрих  =  ВыборкаТ.СуммаРознСНДСПриход;	
		СекСтр.Параметры.СуммаРознРасх	=  ВыборкаТ.СуммаРознСНДСРасход;
		СекСтр.Параметры.Партия         =  ВыборкаТ.Партия;
		СекСтр.Параметры.Док=ВыборкаТ.Документ;
		
		Таб.Вывести(СекСтр);
	КонецЦикла;
	Попытка
		Таб.ЗакончитьГруппуСтрок();
	Исключение
	КонецПопытки;
	Таб.Вывести(СекцКонОст);// конец предыдущей
	
	Попытка
		Таб.ПовторятьПриПечатиСтроки = Таб.Область("УсловиеТовар");
	Исключение
	Конецпопытки;	
	
	Таб.ТолькоПросмотр=Истина;
	Таб.ФиксацияСверху=КолвоСтрокШапки;
	Таб.АвтоМасштаб=Истина;
	Таб.ОриентацияСтраницы=ОриентацияСтраницы.Ландшафт;
	Таб.Показать(); // вывод на экран
	//============================< Шаблон печати таблицы конец >================================GtG===  
	
	
КонецПроцедуры

Процедура ВыбПериодНажатие(Элемент)
	НастройкаПериода = Новый НастройкаПериода;
	НастройкаПериода.УстановитьПериод(НачПер, ?(КонПер='0001-01-01', КонПер, КонецДня(КонПер)));
	НастройкаПериода.РедактироватьКакИнтервал = Истина;
	НастройкаПериода.РедактироватьКакПериод = Истина;
	НастройкаПериода.ВариантНастройки = ВариантНастройкиПериода.Период;
	Если НастройкаПериода.Редактировать() Тогда
		НачПер = НастройкаПериода.ПолучитьДатуНачала();
		КонПер = НастройкаПериода.ПолучитьДатуОкончания();
	КонецЕсли;
КонецПроцедуры

Процедура КоманднаяПанель2ОчиститьСписок(Кнопка)
	// Вставить содержимое обработчика.
	СписокТоваров.Очистить();
КонецПроцедуры

Процедура КоманднаяПанель2ПодборТовараПоАП(Кнопка)
	КлючУник=  Новый   УникальныйИдентификатор();
	ФормаПодбора= Справочники.АССОРТИМЕНТНЫЙ_ПЛАН.ПолучитьФорму("ФормаДляПодбора","",КлючУник);
	ФормаПодбора.МножественныйВыбор= ИСТИНА;
	ФормаПодбора.ВладелецФормы=ЭтаФорма;
	ФормаПодбора.ЗакрыватьПриЗакрытииВладельца=Истина;
	ФормаПодбора.ОткрытьМодально(0);
КонецПроцедуры

Процедура ОбработкаВыбора(ЗначениеВыбора, Источник)
	Если ТипЗнч(ЗначениеВыбора)=Тип("Таблицазначений") Тогда
		Для каждого Стз Из ЗначениеВыбора Цикл
			СписокТоваров.Добавить(Стз.Товар);
		КонецЦикла; 
	КонецЕсли; 
КонецПроцедуры

Процедура ПриОткрытии()
	
	Если ВыбФирма.Ссылка = Справочники.Фирмы.ПустаяСсылка() Тогда
		ВыбФирма = Константы.ОсновнаяФирма.Получить();
	КонецЕсли;
	
	Если ВыбСклад.Ссылка = Справочники.МестаХранения.ПустаяСсылка() Тогда
		ВыбСклад = Константы.ОсновнойСклад.Получить();
	КонецЕсли;
	
КонецПроцедуры

Процедура ВыбСкладПриИзменении(Элемент)
	
	Если Элемент.Значение <> ВыбФирма Тогда
		ВыбФирма = Элемент.Значение.Фирма;
	КонецЕсли;
	
КонецПроцедуры

Процедура ВыбФирмаПриИзменении(Элемент)
	
	Если Элемент.Значение <> ВыбСклад.Фирма Тогда
		ВыбСклад = Справочники.МестаХранения.ПустаяСсылка();
	КонецЕсли;
	
КонецПроцедуры







