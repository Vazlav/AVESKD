
Процедура КнопкаВыполнитьНажатие(Кнопка)
	// Вставить содержимое обработчика.
КонецПроцедуры

Процедура ПриОткрытии()
	
	ТХТ = "ВЫБРАТЬ
	      |	КаталогПрайсЛистов.Настройка.Владелец КАК Поставщик,
	      |	КаталогПрайсЛистов.Настройка КАК Настройка,
	      |	КаталогПрайсЛистов.КодПрайсЛиста,
	      |	ВЫБОР
	      |		КОГДА КаталогПрайсЛистов.Настройка.КоэффициентЦеныНаБазовыйПрайсПоставщика = 0
	      |			ТОГДА 1
	      |		ИНАЧЕ КаталогПрайсЛистов.Настройка.КоэффициентЦеныНаБазовыйПрайсПоставщика
	      |	КОНЕЦ КАК БазовыйКоэфф,
	      |	ВЫБОР
	      |		КОГДА КаталогПрайсЛистов.Настройка.КоэффициентПриведенияЦены = 0
	      |			ТОГДА 1
	      |		ИНАЧЕ КаталогПрайсЛистов.Настройка.КоэффициентПриведенияЦены
	      |	КОНЕЦ КАК КоэффПриведения
	      |ПОМЕСТИТЬ Параметры
	      |ИЗ
	      |	Справочник.КонтрактыИАптеки КАК КонтрактыИАптеки
	      |		ВНУТРЕННЕЕ СОЕДИНЕНИЕ РегистрСведений.КонтрактыИНастройки КАК КонтрактыИНастройки
	      |			ВНУТРЕННЕЕ СОЕДИНЕНИЕ РегистрСведений.КаталогПрайсЛистов КАК КаталогПрайсЛистов
	      |			ПО КонтрактыИНастройки.НастройкаОбмена = КаталогПрайсЛистов.Настройка
	      |		ПО КонтрактыИАптеки.Владелец = КонтрактыИНастройки.Контракт
	      |ГДЕ
	      |	КонтрактыИАптеки.Активность = ИСТИНА
	      |	И КонтрактыИАптеки.Аптека = &Аптека
	      |	И КонтрактыИАптеки.Владелец.Активность = ИСТИНА
	      |	И КонтрактыИАптеки.Владелец.Владелец.ОсуществляетПрямыеПоставки = ИСТИНА
	      |;
	      |
	      |////////////////////////////////////////////////////////////////////////////////
	      |ВЫБРАТЬ
	      |	Параметры.Поставщик.Наименование КАК Поставщик,
	      |	ВЫРАЗИТЬ(Прайсы.Цена * Параметры.БазовыйКоэфф КАК ЧИСЛО(12, 2)) КАК Цена,
	      |	Связки.КодТовараПоставщика КАК КодТовара,
	      |	Прайсы.Товар КАК Наименованиетовара,
	      |	Прайсы.Производитель,
	      |	Прайсы.Количество,
	      |	Прайсы.СрокГодности,
	      |	ЕСТЬNULL(Связки.Блокировка, ЛОЖЬ) КАК Блокировка,
	      |	Связки.Поставщик.Наименование КАК Связка,
	      //|	Выразить(Прайсы.ВхЦенаСНДС * (1+Связки.ТоварФирмы.ставкаНДС.Ставка/100) КАК Число(15,2)) ВхЦенаСНДС
		  |	Прайсы.ВхЦенаСНДС
	      |ИЗ
	      |	РегистрСведений.ПрайсЛисты КАК Прайсы
	      |		ВНУТРЕННЕЕ СОЕДИНЕНИЕ Справочник.СвязкиТовараСПоставщиком КАК Связки
	      |		ПО (Связки.Поставщик = Прайсы.ПоставщикСвязки)
	      |			И (Связки.КодТовараПоставщика = Прайсы.Код)
	      |		ВНУТРЕННЕЕ СОЕДИНЕНИЕ Параметры КАК Параметры
	      |		ПО Прайсы.КодПрайсЛиста = Параметры.КодПрайсЛиста
	      |ГДЕ
	      |	Параметры.Поставщик.ОсуществляетПрямыеПоставки = ИСТИНА
	      |	И Связки.ТоварФирмы = &Товар
	      |	И ВЫБОР
	      |			КОГДА Прайсы.Цена > 0
	      |					И Прайсы.Цена < 50
	      |					И Прайсы.Количество > 200
	      |				ТОГДА ИСТИНА
	      |			КОГДА Прайсы.Цена >= 50
	      |					И Прайсы.Цена < 5000
	      |					И Прайсы.Количество > 10
	      |				ТОГДА ИСТИНА
	      |			КОГДА Прайсы.Цена >= 5000
	      |				ТОГДА ИСТИНА
	      |			ИНАЧЕ ЛОЖЬ
	      |		КОНЕЦ = ИСТИНА
	      |	И (Прайсы.СрокГодности > &СрокГодности
	      |			ИЛИ Прайсы.СрокГодности = &ПустойСрок)
	      |
	      |УПОРЯДОЧИТЬ ПО
	      |	Цена
	      |;
	      |
	      |////////////////////////////////////////////////////////////////////////////////
	      |УНИЧТОЖИТЬ Параметры";
		  
	Запрос = Новый Запрос;
	Запрос.Текст = ТХТ;
	СрокГодности = НачалоДня(ТекущаяДата()) + 24*60*60*120;
	ПустойСрок = ОМ3_ПустаяДата();
	Запрос.УстановитьПараметр("СрокГодности",СрокГодности);
	Запрос.УстановитьПараметр("ПустойСрок",ПустойСрок);
	Запрос.УстановитьПараметр("Товар",Товар);
	Запрос.УстановитьПараметр("Аптека",Аптека);

	ВремТЗ = Запрос.Выполнить().Выгрузить();
		
	
КонецПроцедуры

Процедура ВремТЗВесПриИзменении(Элемент)
	
	
	Конкурент = Справочники.КонкурентыЕГК.НайтиПоКоду(ЭлементыФормы.ВремТЗ.ТекущаяСтрока.Код);
	Если НЕ Конкурент.Пустая() Тогда
		КонкурентОбъект = Конкурент.ПолучитьОбъект();
		КонкурентОбъект.Вес = Элемент.Значение;
		КонкурентОбъект.Записать();
	КонецЕсли;
	
КонецПроцедуры

Процедура ВремТЗПриВыводеСтроки(Элемент, ОформлениеСтроки, ДанныеСтроки)
	
	Если ДанныеСтроки.Блокировка = Истина Тогда
		ОформлениеСтроки.ЦветФона=Новый Цвет(255,155,240);	
	КонецЕсли;
	
КонецПроцедуры
