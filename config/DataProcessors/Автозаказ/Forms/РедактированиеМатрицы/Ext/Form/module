
Процедура КнопкаВыполнитьНажатие(Кнопка)
	
	Если ВыбАптека.Пустая() Тогда
		Предупреждение("НЕ ВЫБРАНА АПТЕКА!");
		Возврат;	
	КонецЕсли;
	
	Если Кумакс < Кумин Тогда
		Предупреждение("КуМакс меньше КуМин. Такого не должно быть");
		Возврат;
	КонецЕсли;
	
	
	МассивИзмерений = Новый Структура;
	МассивИзмерений.Вставить("Аптека",ВыбАптека);
	МассивИзмерений.Вставить("Товар",Товар);
	
	МассивИзменений = Новый Структура;
	МассивИзменений.Вставить("Кумин",Кумин);
	МассивИзменений.Вставить("Кумакс",Кумакс);
	МассивИзменений.Вставить("НЗ",НЗ);
	МассивИзменений.Вставить("ГруппаАПИтог",ГруппаАП);
	МассивИзменений.Вставить("КтоВнесВМатрицу",ПараметрыСеанса.ТекущийСотр);
	МассивИзменений.Вставить("ДатаВнесенияВМатрицу",ТекущаяДата());
	
	//Блокировка = Новый БлокировкаДанных;
	//БлокировкаМатрицы = Блокировка.Добавить("РегистрСведений.Матрица");
	//БлокировкаМатрицы.УстановитьЗначение("Аптека",ВыбАптека);
	//БлокировкаМатрицы.УстановитьЗначение("Товар",Товар);
	//Блокировка.Заблокировать();	
	
	
	//Записываем изменения
	Попытка
		ОМ16_ИзменитьЗначениеВМатрице("Матрица",МассивИзмерений,МассивИзменений);	
		
		МассивИзмерений.Вставить("ВидНЗ",Перечисления.ВидыНЗ.НЗ_1);
		ОМ16_ИзменитьЗначениеВМатрице("МатрицаНЗ",МассивИзмерений,МассивИзменений);	
		
		//Предупреждение("Данные изменены!",1);
		ЭтаФорма.Закрыть();
		//МассивИзменений.Вставить("ФормаОбработчик","ФормаРедактированияМатрицы");
		//МассивИзменений.Вставить("Код",Товар.Код);
		//ОповеститьОВыборе(МассивИзменений);
	Исключение
		Предупреждение("Не удалось записать изменения" + Символы.ВК + "" + ОписаниеОшибки());
	КонецПопытки;
	
	
		
	
КонецПроцедуры

Процедура ПередОткрытием(Отказ, СтандартнаяОбработка)
	ЭлементыФормы.НЗ.АктивизироватьПоУмолчанию = Истина;
КонецПроцедуры




