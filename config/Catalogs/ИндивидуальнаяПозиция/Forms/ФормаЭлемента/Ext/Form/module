Перем с_ЗначениеПолей_ИС_Ориола;

Процедура ОсновнаяПанельПриСменеСтраницы(Элемент, ТекущаяСтраница)
	
	Если Элемент.ТекущаяСтраница = Элемент.Страницы.ЦеныГосреестра Тогда
		ПоказатьЦеныГосреестра();
	КонецЕсли;

КонецПроцедуры

Процедура ПоказатьЦеныГосреестра()
	
	Если ЭтоНовый() Тогда
		ЭлементыФормы.ЦеныГосреестра.Доступность = Ложь;
		ЭлементыФормы.КоманднаяПанельЦеныГосреестра.Доступность = Ложь;
		Возврат;
	КонецЕсли;
	
	ЦеныГосреестра.Отбор.Номенклатура.Установить(Ссылка);	
	//ЦеныГосреестра.Прочитать();
	 	  
КонецПроцедуры

Процедура ОпределениеСвязкиСПоставщиком()

	ТекстЗапроса = 
	"ВЫБРАТЬ
	|	СвязкиТовараСПоставщиком.Ссылка КАК Ссылка
	|ИЗ
	|	Справочник.СвязкиТовараСПоставщиком КАК СвязкиТовараСПоставщиком
	|ГДЕ
	|	СвязкиТовараСПоставщиком.Поставщик = &Поставщик
	|	И СвязкиТовараСПоставщиком.ТоварФирмы = &ТоварФирмы
	|	И СвязкиТовараСПоставщиком.КодТовараПоставщика = &КодТовараПоставщика";
	
	Запрос = Новый Запрос;
	Запрос.Текст = ТекстЗапроса;
	Запрос.УстановитьПараметр("Поставщик", Справочники.Поставщики.НайтиПоКоду(582));
	Запрос.УстановитьПараметр("ТоварФирмы",АссортиментныйПлан);
	Запрос.УстановитьПараметр("КодТовараПоставщика", СтрЗаменить(Строка(КодНалоговойСтавки),Символы.НПП,""));
	
	Выборка = Запрос.Выполнить().Выбрать();
	Если Выборка.Следующий() Тогда
		
		ЭлементыФормы.НадписьСвязкаПлохо.Видимость			= Ложь;
		ЭлементыФормы.НадписьСвязкаХорошо.Видимость			= Истина;
		ЭлементыФормы.КнопкаУстановитьСвязку.Доступность	= Ложь
		
	Иначе
		
		ЭлементыФормы.НадписьСвязкаПлохо.Видимость			= Истина;
		ЭлементыФормы.НадписьСвязкаХорошо.Видимость			= Ложь;
		ЭлементыФормы.КнопкаУстановитьСвязку.Доступность	= Истина
		
	КонецЕсли; 
	

КонецПроцедуры
 
Процедура ПриЗаписи(Отказ)
	//ЦеныГосреестра.Записать(Истина);
КонецПроцедуры

Процедура ПриОткрытии()
	
	Если ЭтоНовый() Тогда
		
	Иначе
		
		Выборка = РегистрыСведений.РеквизитыСправочниковДляИстории.Выбрать(Новый Структура("Объект","ИндивидуальнаяПозиция"),);
		Пока Выборка.Следующий() Цикл
			с_ЗначениеПолей_ИС_Ориола.Вставить(Выборка.РеквизитСправочника,Вычислить(Выборка.РеквизитСправочника));
		КонецЦикла;	
		
	КонецЕсли;
	
	Если КодНалоговойСтавки <> 0 Тогда
		
		ОпределениеСвязкиСПоставщиком()
		
	Иначе
		
		ЭлементыФормы.НадписьСвязкаПлохо.Видимость			= Ложь;
		ЭлементыФормы.НадписьСвязкаХорошо.Видимость			= Ложь;
		ЭлементыФормы.КнопкаУстановитьСвязку.Доступность	= Ложь
		
	КонецЕсли; 
	
	
КонецПроцедуры

Процедура ПередЗаписью(Отказ)
	
	Если ЭтоНовый() Тогда
		ФлагПередачиВИСОриола = 1;
		СчетчикИзменений = СчетчикИзменений + 1;
	Иначе		
			
		Для каждого Стр Из с_ЗначениеПолей_ИС_Ориола Цикл
				
			НовоеЗначение = Вычислить(стр.Ключ);
			Если стр.Значение <> НовоеЗначение Тогда
				
				ФлагПередачиВИСОриола = 1;
				СчетчикИзменений = СчетчикИзменений + 1;
				Прервать;
				
			КонецЕсли;
			
		КонецЦикла; 
			
	КонецЕсли;
	
КонецПроцедуры


Процедура ЦеныГосреестраПериодПриИзменении(Элемент)
	ФлагПередачиВИСОриола = 1;
КонецПроцедуры

Процедура ЦеныГосреестраЦенаПриИзменении(Элемент)
	ФлагПередачиВИСОриола = 1;
КонецПроцедуры

Процедура ЦеныГосреестраПослеУдаления(Элемент)
	ФлагПередачиВИСОриола = 1;
КонецПроцедуры

Процедура КнопкаУстановитьСвязкуНажатие(Элемент)
	
	НовыйЭлементСпрСвязка = Справочники.СвязкиТовараСПоставщиком.СоздатьЭлемент();
	НовыйЭлементСпрСвязка.КодТовараПоставщика	= СтрЗаменить(Строка(КодНалоговойСтавки),Символы.НПП,"");
	НовыйЭлементСпрСвязка.Поставщик				= Справочники.Поставщики.НайтиПоКоду(582);
	НовыйЭлементСпрСвязка.ТоварФирмы			= АссортиментныйПлан;
	НовыйЭлементСпрСвязка.Записать();
	
	ОпределениеСвязкиСПоставщиком();
	
КонецПроцедуры

Процедура кнПолучитьИзОриолыНажатие(Элемент)
	Если КодНалоговойСтавки <> 0 Тогда
		ВнешнийОтчет = Справочники.ВнешниеОтчетыИОбработки.НайтиПоКоду(1132);
		Если ЗначениеЗаполнено(ВнешнийОтчет) Тогда 
			ОбработкаПолучитьВесогабариты = ВнешниеОбработки.Создать(ВнешнийОтчет.ПутьКФайлу);
			ТЗ_результат = ОбработкаПолучитьВесогабариты.ОптПолучитьВГХ(КодНалоговойСтавки, 4);
			ОбработкаПолучитьВесогабариты = Неопределено;

			Если Не ТЗ_результат.Колонки.Найти("ИнформацияОбОшибкеТекст")= Неопределено Тогда
				Если ТЗ_результат.Количество()>0 Тогда
					Сообщить(ТЗ_результат[0].ИнформацияОбОшибкеТекст);
				КонецЕсли;	
			Иначе //6 301
				Если ТЗ_результат.Количество()>0 Тогда
					//ЕдиничнаяУпаковкаКолвоШтук
					//ЗаводскаяУпаковкаВес	
					//ЕдиничнаяУпаковкаДлина	
					//ЕдиничнаяУпаковкаШирина	
					//ЕдиничнаяУпаковкаВысота	
					//ЗаводскаяУпаковкаКолвоШтук	
					//ЕдиничнаяУпаковкаВес	
					//ЗаводскаяУпаковкаДлина	
					//ЗаводскаяУпаковкаШирина	
					//ЗаводскаяУпаковкаВысота	
					//МалыйСтандартКолвоШтук	
					//МалыйСтандартВес	
					//МалыйСтандартДлина	
					//МалыйСтандартШирина	
					//МалыйСтандартВысота
					ЗаполнитьЗначенияСвойств(ЭтаФорма, ТЗ_результат[0]);
				Иначе
					Сообщить("Нет данных для заполнения!");
				КонецЕсли;	
			КонецЕсли;	
		КонецЕсли;  
	Иначе
		Сообщить("Не задан Код налоговой ставки!");
	КонецЕсли;	
КонецПроцедуры

с_ЗначениеПолей_ИС_Ориола = Новый Структура();
