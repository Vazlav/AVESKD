
Процедура ОсновныеДействияФормыкнЗаписать(Кнопка)
	
	
	Если ДатаРежима = Дата(1,1,1) Тогда
		Предупреждение("Не задана дата изменения режима работы. Запись элемента не может быть выполнена");
		Возврат;
	КонецЕсли;
	
	Если НЕ ЗначениеЗаполнено(РежимРаботы) Тогда
		Предупреждение("Не выбран режим работы. Запись элемента не может быть выполнена");
		Возврат;
	КонецЕсли;
	
	
	
	НЗ = РегистрыСведений.РежимыРаботыАптек.СоздатьМенеджерЗаписи();
	НЗ.Период = ДатаРежима;
	НЗ.Аптека = Аптека;
	НЗ.РежимРаботы = РежимРаботы;
	НЗ.Пользователь = ПараметрыСеанса.ТекущийСотр;
	НЗ.Записать();
	
	ОповеститьОВыборе(РежимРаботы);
	
	
КонецПроцедуры

Процедура ПриОткрытии()
	
	Запрос = Новый Запрос;
	Запрос.Текст = "ВЫБРАТЬ
	               |	РР.Период,
	               |	РР.РежимРаботы
	               |ИЗ
	               |	РегистрСведений.РежимыРаботыАптек.СрезПоследних(&Дата, Аптека = &Аптека) КАК РР";
	Запрос.УстановитьПараметр("Аптека",Аптека);
	Запрос.УстановитьПараметр("Дата",ТекущаяДата());

	Рез = Запрос.Выполнить();
	Если Рез.Пустой() Тогда
		Возврат;
	Иначе
		Выборка = Рез.Выбрать();
		Выборка.Следующий();
		ДатаРежима = Выборка.Период;
		РежимРаботы = Выборка.РежимРаботы;
	КонецЕсли;
	
	
КонецПроцедуры
