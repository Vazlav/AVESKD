
Процедура ПередЗаписью(Отказ)
	
	Если ПрограммаЛояльности и Контрагент.Пустая() Тогда
		Предупреждение("Не выбран контрагент лояльности. Сохранение не может быть продолжено.");	
		Отказ = Истина;
	КонецЕсли;
	
КонецПроцедуры

//ТСО 19.05.2015
Процедура КоманднаяПанель1ЗаполнитьПоОтбору(Кнопка)
	
	ФормаОтбора = ЭтотОбъект.ПолучитьФорму("ФормаОтбораАптек");
	ПостроительСпискаАптек = ФормаОтбора.ОткрытьМодально();
	
	Если ПостроительСпискаАптек = Неопределено Тогда
		Возврат;
	КонецЕсли;
	
	Режим = РежимДиалогаВопрос.ДаНет;
	Ответ = Вопрос("Очистить текущий список аптек?", Режим, 0);
	Если Ответ = КодВозвратаДиалога.Да Тогда
		СписокАптек.Очистить();
	КонецЕсли;
	
	ПостроительСпискаАптек.Выполнить();
	
	Выборка = ПостроительСпискаАптек.Результат.Выбрать();
	КолВо = Выборка.Количество();
	
	Пока Выборка.Следующий() Цикл 		
		НовСтр = СписокАптек.Добавить();
		НовСтр.Аптека = Выборка.Ссылка; 		
	КонецЦикла;
	
	Сообщить("Записи успешно загружены (" + КолВо + ")");
	
КонецПроцедуры

Процедура КоманднаяПанель1УдалитьПоОтбору(Кнопка)
	
	ФормаОтбора = ЭтотОбъект.ПолучитьФорму("ФормаОтбораАптек");
	ПостроительСпискаАптек = ФормаОтбора.ОткрытьМодально();
	
	Если ПостроительСпискаАптек = Неопределено Тогда
		Возврат;
	КонецЕсли;
	
	ПостроительСпискаАптек.Выполнить();
	
	Выборка = ПостроительСпискаАптек.Результат.Выбрать();
	КолВо = 0;
	
	Пока Выборка.Следующий() Цикл 
		
		НайденнаяСтрока = СписокАптек.Найти(Выборка.Ссылка, "Аптека");
		
		Если НайденнаяСтрока <> Неопределено Тогда
			СписокАптек.Удалить(НайденнаяСтрока);
			КолВо = КолВо + 1;
		КонецЕсли;
		
	КонецЦикла;
	
	Сообщить("Записи успешно удалены (" + КолВо + ")");
	
КонецПроцедуры

Процедура КоманднаяПанель1УдалитьВсе(Кнопка)	
	СписокАптек.Очистить();
КонецПроцедуры
//*ТСО
