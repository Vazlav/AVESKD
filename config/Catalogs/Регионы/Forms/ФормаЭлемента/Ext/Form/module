
//==========================================================GtG====
Функция КонтрольПриоритетов ()  
	//----------------------------------
	//Назначение:
	//  Проверяет приоритеты на дубли оэфф приоритета
	//  
	//  
	//  
	//----------------------------------
	Отказать=Ложь;

	Если ЭтотОбъект.ЭтоНовый()=Ложь ТОгда	
		
	ТХТ="ВЫБРАТЬ
	    |	КОЛИЧЕСТВО(АлгоритмыЦенообразованияРегионов.Приоритет) КАК Повторов,
	    |	АлгоритмыЦенообразованияРегионов.Приоритет КАК Приоритет
	    |ИЗ
	    |	Справочник.АлгоритмыЦенообразованияРегионов КАК АлгоритмыЦенообразованияРегионов
	    |ГДЕ
	    |	АлгоритмыЦенообразованияРегионов.Владелец.Ссылка = &Регион
	    |
	    |СГРУППИРОВАТЬ ПО
	    |	АлгоритмыЦенообразованияРегионов.Приоритет";	
		
		
		
		Запрос=Новый Запрос;
		Запрос.Текст=ТХТ;
		Запрос.УстановитьПараметр("Регион", ЭтотОбъект.Ссылка );
		
		ТЗ=Запрос.Выполнить().Выгрузить();
		
		
		
		Если ТЗ.Количество()=0 ТОгда
			Отказать=Истина;
			Сообщить("Не задано НИ ОДНОГО алгоритма ценообразования!");
		КонецЕсли; 
			
		Для каждого Стр из ТЗ Цикл
			ЕСли  Стр.Повторов>1 Тогда
				Сообщить("ОШИБКА: "+Стр.Повторов+"  алгоритмов с приоритетом "+Стр.Приоритет+" не должно быть одинаковых приоритетов!");
				Отказать=Истина;
			КонецЕсли; 
		КонецЦикла;	
		
		
	КонецЕсли; 	
	
	

	
	
	
	Возврат Отказать;	
	
КонецФункции	//КонтрольПриоритетов
//==========================================================GtG====






Процедура ПередЗаписью(Отказ)
	  Отказ=КонтрольПриоритетов ()  ;

		
КонецПроцедуры

Процедура ПередЗакрытием(Отказ, СтандартнаяОбработка)
	  Отказ=КонтрольПриоритетов ()  ;

КонецПроцедуры

Процедура ПриОткрытии()
	
	Если ЭтоНовый() Тогда
		Пользователь = ПараметрыСеанса.ТекущийСотр;
	КонецЕсли;
	
	Если Пользователь <> ПараметрыСеанса.ТекущийСотр  И ПараметрыСеанса.ТекущийСотр <> Справочники.Сотрудники.НайтиПоНаименованию("Администратор") Тогда
		ЭтаФорма.ТолькоПросмотр = Истина;	
	КонецЕсли;
	
	Если ПараметрыСеанса.ТекущийСотр = Справочники.Сотрудники.НайтиПоНаименованию("Администратор") Тогда
		ЭлементыФормы.Пользователь.Доступность = Истина;	
	КонецЕсли;
	
КонецПроцедуры
