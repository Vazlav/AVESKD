
Процедура ПриЗаписи(Отказ)
	
	ХЗ=Новый ХранилищеЗначения(ПостроительУсловияПрименения.ПолучитьНастройки(Истина, Ложь, Ложь, Ложь,Ложь) ,Новый СжатиеДанных(0));
	
	ЭтотОбъект.УсловиеПрименения=ХЗ;
	
	
	
	
КонецПроцедуры

Процедура ПриОткрытии()
	Попытка
		ПостроительУсловияПрименения.УстановитьНастройки( УсловиеПрименения.Получить());
	Исключение
	КонецПопытки;
	
	
КонецПроцедуры

Процедура КоманднаяПанель2ДобавитьВФормулу(Кнопка)
	ФормулаРасчетаНовойЦены=ФормулаРасчетаНовойЦены+" "+ЭлементыФормы.ПоляДляФормулы.ТекущаяСтрока.ПутьКДанным; 
КонецПроцедуры

Процедура ВыбПериодНажатие(Элемент)
	НастройкаПериода = Новый НастройкаПериода;
	НастройкаПериода.РедактироватьКакИнтервал = Истина;
	НастройкаПериода.РедактироватьКакПериод = Истина;
	НастройкаПериода.ВариантНастройки = ВариантНастройкиПериода.Период;
	НастройкаПериода.УстановитьПериод(НачалоДействия, ?(КонецДействия='0001-01-01', КонецДействия, КонецДня(КонецДействия)));
	Если НастройкаПериода.Редактировать() Тогда
		НачалоДействия = НастройкаПериода.ПолучитьДатуНачала();
		КонецДействия = НастройкаПериода.ПолучитьДатуОкончания();
	КонецЕсли;
КонецПроцедуры

Процедура ПередЗаписью(Отказ)
	
	Если ПричинаПереоценки.Пустая() ТОгда
		Предупреждение("Не указана причина переоценки!");
		Отказ=Истина;
	КонецЕсли;
	
	Если ПостроительУсловияПрименения.Отбор.Количество()=0  ТОгда
		Предупреждение("Не указаны условия применения!");
		Отказ=Истина;
	КонецЕсли;
	
	Если ПустаяСтрока(ФормулаРасчетаНовойЦены) ТОгда
		Предупреждение("Не указана формула расчетановой цены!");
		Отказ=Истина;
	КонецЕсли;

	Если приоритет=0  ТОгда
		Предупреждение("Не указан приоритет!");
		Отказ=Истина;
	КонецЕсли;

	Если НачалоДействия=Дата("00010101") Тогда
		Предупреждение("Не указано начало периода действия!");
		Отказ=Истина;
	КонецЕсли;	
	
	Если КонецДействия=Дата("00010101") Тогда
		Предупреждение("Не указан конец периода действия!");
		Отказ=Истина;
	КонецЕсли;	
	
	
	Если КонецДействия<НачалоДействия Тогда
		Предупреждение("Конец периода действия меньше начала периода действия!");
		Отказ=Истина;
	КонецЕсли;	
	

	
КонецПроцедуры





ПостроительУсловияПрименения.Текст="ВЫБРАТЬ
|	РаспоряжениеНаПереоценкуТовар.Товар,
|	РаспоряжениеНаПереоценкуТовар.СтараяЦена,
|	РаспоряжениеНаПереоценкуТовар.Партия,
|	РаспоряжениеНаПереоценкуТовар.Серия,
|	РаспоряжениеНаПереоценкуТовар.ФактическийСрокГодности,
|	РАЗНОСТЬДАТ(&ТекущаяДата, РаспоряжениеНаПереоценкуТовар.ФактическийСрокГодности, МЕСЯЦ) КАК ОстаточныйСрокГодности_месяцев
|{ВЫБРАТЬ
|	Товар.*,
|	СтараяЦена,
|	Партия.*,
|	Серия.*,
|	ФактическийСрокГодности,
|	ОстаточныйСрокГодности_месяцев}
|ИЗ
|	Документ.РаспоряжениеНаПереоценку.Товар КАК РаспоряжениеНаПереоценкуТовар
|{ГДЕ
|	РаспоряжениеНаПереоценкуТовар.Товар.*,
|	РаспоряжениеНаПереоценкуТовар.СтараяЦена,
|	РаспоряжениеНаПереоценкуТовар.Партия.*,
|	РаспоряжениеНаПереоценкуТовар.Серия.*,
|	РаспоряжениеНаПереоценкуТовар.ФактическийСрокГодности,
|	(РАЗНОСТЬДАТ(РаспоряжениеНаПереоценкуТовар.ФактическийСрокГодности, &ТекущаяДата, МЕСЯЦ)) КАК ОстаточныйСрокГодности_Месяцев}";

ПостроительПоляДляРасчетаЦены.Текст="ВЫБРАТЬ
                                    |	РаспоряжениеНаПереоценкуТовар.СтараяЦена,
                                    |	РаспоряжениеНаПереоценкуТовар.Партия.ЦенаЗакуп,
                                    |	РаспоряжениеНаПереоценкуТовар.Партия.ЦенаПроизводителяБезНДС,
                                    |	РаспоряжениеНаПереоценкуТовар.Партия.ЦенаГосРегистрации,
                                    |	РаспоряжениеНаПереоценкуТовар.Партия.ЕИТЗакупки.К,
                                    |	РаспоряжениеНаПереоценкуТовар.К
                                    |{ВЫБРАТЬ
                                    |	СтараяЦена КАК Строка_СтараяЦена,
                                    |	К КАК Строка_К,
                                    |	ПартияЦенаЗакуп КАК Строка_Партия_ЦенаЗакуп,
                                    |	ПартияЦенаПроизводителяБезНДС КАК Строка_Партия_ЦенаПроизводителяБезНДС,
                                    |	ПартияЦенаГосРегистрации КАК Строка_Партия_ЦенаГосРегистрации,
                                    |	ПартияЕИТЗакупкиК КАК Строка_Партия_ЕИТЗакупки_К}
                                    |ИЗ
                                    |	Документ.РаспоряжениеНаПереоценку.Товар КАК РаспоряжениеНаПереоценкуТовар";