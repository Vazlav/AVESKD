Перем с_ЗначениеПолей ;

Процедура кнФайлЗаказаНажатие(Элемент)
	
	СтандартнаяОбработка=Ложь;
	Файл=Новый ДиалогВыбораФайла(РежимДиалогаВыбораФайла.ВыборКаталога);
	Файл.МножественныйВыбор=Ложь;
	Файл.Заголовок="Выберите каталог заказа...";
	Если Файл.Выбрать() Тогда
		КаталогЗаказа=СокрЛП(Файл.Каталог);
	КонецЕсли;

КонецПроцедуры

Процедура кнКаталогНакладныхНажатие(Элемент)
	
	СтандартнаяОбработка=Ложь;
	Файл=Новый ДиалогВыбораФайла(РежимДиалогаВыбораФайла.ВыборКаталога);
	Файл.МножественныйВыбор=Ложь;
	Файл.Заголовок="Выберите каталог заказа...";
	Если Файл.Выбрать() Тогда
		КаталогНакладных=СокрЛП(Файл.Каталог)+ "\";
	КонецЕсли;
	
КонецПроцедуры

Процедура ПередЗакрытием(Отказ, СтандартнаяОбработка)
	Если ПустаяСтрока(ИНН)=Истина  	Тогда
		ПРедупреждение("Не указан ИНН! Без него выгрузка в бухгалтерию невозможна!");
	КонецЕсли;	
	
	Если ПустаяСтрока(КПП)=Истина  	Тогда
		ПРедупреждение("Не указан КПП! Без него выгрузка в бухгалтерию невозможна!");
	КонецЕсли;
	
	
КонецПроцедуры

Процедура ОтправлятьЗаказПоПочтеПриИзменении(Элемент)
	
	ЭлементыФормы.Мэйл.Доступность = Элемент.Значение;
	
КонецПроцедуры

Процедура КнФайлПрайсаНажатие(Элемент)
	
	СтандартнаяОбработка=Ложь;
	ДВФ=Новый ДиалогВыбораФайла(РежимДиалогаВыбораФайла.Открытие);
	ДВФ.МножественныйВыбор=Ложь;
	Фильтр = "(*.*)|*.*";
	
	ДВФ.Фильтр = Фильтр;
	ДВФ.Заголовок="файл прайс-листа?";
	Если ДВФ.Выбрать() Тогда
		ФайлПрайсЛиста=СокрЛП(ДВФ.ПолноеИмяФайла);
	КонецЕсли;

КонецПроцедуры

Процедура FtpПоставщикаПриИзменении(Элемент)
	
	ЭлементыФормы.FTPАдрес.Доступность			= FTPПоставщика;
	ЭлементыФормы.FTPПорт.Доступность			= FTPПоставщика;
	ЭлементыФормы.FTPИмяПользователя.Доступность= FTPПоставщика;
	ЭлементыФормы.FTPПароль.Доступность			= FTPПоставщика;
	
КонецПроцедуры

Процедура КоэффициентПриведенияЦеныНЕЖНВЛСПриИзменении(Элемент)
	КоэффициентПриведенияЦены = 0;
КонецПроцедуры

Процедура КоэффициентПриведенияЦеныПриИзменении(Элемент)
	КоэффициентПриведенияЦеныКромеЖНВЛС = 0;
	КоэффициентПриведенияЦеныДляЖНВЛС = 0;
КонецПроцедуры

Процедура кнКаталогОтказаНажатие(Элемент)
	
	СтандартнаяОбработка=Ложь;
	Файл=Новый ДиалогВыбораФайла(РежимДиалогаВыбораФайла.ВыборКаталога);
	Файл.МножественныйВыбор=Ложь;
	Файл.Заголовок="Выберите каталог отказов...";
	Если Файл.Выбрать() Тогда
		КаталогОтказов=СокрЛП(Файл.Каталог);
	КонецЕсли;

КонецПроцедуры

Процедура КоэффициентПриведенияЦеныДляЖНВЛСПриИзменении(Элемент)
	КоэффициентПриведенияЦены = 0;
КонецПроцедуры

Процедура кнКаталогЭкспортаНакладныхНажатие(Элемент)
	
	СтандартнаяОбработка=Ложь;
	Файл=Новый ДиалогВыбораФайла(РежимДиалогаВыбораФайла.ВыборКаталога);
	Файл.МножественныйВыбор=Ложь;
	Файл.Заголовок="Выберите каталог заказа...";
	Если Файл.Выбрать() Тогда
		КаталогЭкспортаНакладных=СокрЛП(Файл.Каталог)+ "\";
	КонецЕсли;

	
КонецПроцедуры

Процедура ПередЗаписью(Отказ)
	
	Если ПустаяСтрока(КПП) И (ПустаяСтрока(ИНН) = Ложь и СтрДлина(СокрЛП(ИНН)) < 12 ) Тогда
		Предупреждение("Элемент не сохранен. Не заполнен КПП!",10);
		Отказ = истина;	
	КонецЕсли;
	
	Если ЭтоНовый() Тогда
		НоваяСтрока = Изменения.Добавить();
		НоваяСтрока.Дата = ТекущаяДата();
		НоваяСтрока.Пользователь = ПараметрыСеанса.ТекущийСотр;
		НоваяСтрока.Комментарий = "Ввод нового элемента";
	Иначе		
		Для каждого стр из с_ЗначениеПолей Цикл
			НовоеЗначение = Вычислить(стр.Ключ);
			Если стр.Значение <> НовоеЗначение Тогда
				НоваяСтрока = Изменения.Добавить();
				НоваяСтрока.Дата = ТекущаяДата();
				НоваяСтрока.Пользователь = ПараметрыСеанса.ТекущийСотр;
				НоваяСтрока.Реквизит = стр.Ключ;
				НоваяСтрока.ЗначениеДо = стр.Значение;
				НоваяСтрока.ЗначениеПосле = НовоеЗначение;
				
				с_ЗначениеПолей.Вставить(стр.Ключ,НовоеЗначение);
				//стр.Значение = НовоеЗначение;
				
			КонецЕсли;
		КонецЦикла;
	КонецЕсли;	
	
КонецПроцедуры


Процедура ПроверитьДоступностьРеквизитов()
	
	
	
	
	НаборЗаписей = РегистрыСведений.ПраваНаОбъекты.СоздатьНаборЗаписей();
	НаборЗаписей.Отбор.Объект.Установить(Метаданные.Справочники.Поставщики.Имя);
	НаборЗаписей.Отбор.Пользователь.Установить(ПараметрыСеанса.ТекущийСотр);
	    
	НаборЗаписей.Прочитать();
	КоличествоЗаписей = НаборЗаписей.Количество();
	
	Если КоличествоЗаписей > 0 Тогда
		Если НаборЗаписей.Получить(0).ПолныеПрава  Тогда
			Возврат;
		КонецЕсли;
	КонецЕсли;
	
	Для каждого стр из ЭлементыФормы Цикл
		стр.Доступность = Ложь;	
	КонецЦикла;

	Если КоличествоЗаписей> 0 Тогда
		ЭлементыФормы.ОсновныеДействияФормы.Доступность = Истина;
	КонецЕсли;
	
	Для каждого стр из НаборЗаписей Цикл

		Если ЭлементыФормы.найти(стр.Реквизит) = Неопределено Тогда
			Для каждого текЭл из ЭлементыФормы Цикл
				Если ТипЗнч(текЭл) = Тип("ТабличноеПоле") и текЭл.Данные = стр.Реквизит Тогда
					текЭл.Доступность = Истина;	
				КонецЕсли;
			КонецЦикла;
		Иначе
			Если НЕ ЭлементыФормы.Найти(стр.Реквизит) = Неопределено Тогда
			ЭлементыФормы[стр.Реквизит].Доступность = Истина;
			КонецЕсли;
		КонецЕсли;
		
		
		//Если ТипЗнч(ЭлементыФормы[стр.Реквизит]) = Тип("ТабличноеПоле") Тогда
		//	ЭлементыФормы[стр.Реквизит].Доступность = Истина;
		//ИначеЕсли НЕ ЭлементыФормы.Найти(стр.Реквизит) = Неопределено Тогда
		//	ЭлементыФормы[стр.Реквизит].Доступность = Истина;
		//КонецЕсли;
		
	КонецЦикла;
	
КонецПроцедуры

Процедура ПриОткрытии()
	
	Если Не РольДоступна("супер_Администратор") Тогда
		Если Константы.ИспользоватьОграничениеПравНаСправочники.Получить() = Истина Тогда	
			ПроверитьДоступностьРеквизитов();
		КонецЕсли;
	КонецЕсли;
	
	Если НЕ ЭтоНовый() Тогда
		Выборка = РегистрыСведений.РеквизитыСправочниковДляИстории.Выбрать(Новый Структура("Объект","Поставщики"),);
		Пока Выборка.Следующий() Цикл
			с_ЗначениеПолей.Вставить(Выборка.РеквизитСправочника,Вычислить(Выборка.РеквизитСправочника));
		КонецЦикла;	
	КонецЕсли;	
	
КонецПроцедуры

Процедура КаталогПретензийНачалоВыбора(Элемент, СтандартнаяОбработка)
	
	ДиалогОткрытия = Новый ДиалогВыбораФайла(РежимДиалогаВыбораФайла.ВыборКаталога);
	ДиалогОткрытия.МножественныйВыбор = Ложь;
	ДиалогОткрытия.Заголовок = "Выберите каталог претензий";
	
	Если ДиалогОткрытия.Выбрать() Тогда 		
		КаталогПретензий = ДиалогОткрытия.Каталог; 		
	КонецЕсли;
	
КонецПроцедуры

Процедура КаталогВозвратныхНакладныхНачалоВыбора(Элемент, СтандартнаяОбработка)
	
	ДиалогОткрытия = Новый ДиалогВыбораФайла(РежимДиалогаВыбораФайла.ВыборКаталога);
	ДиалогОткрытия.МножественныйВыбор = Ложь;
	ДиалогОткрытия.Заголовок = "Выберите каталог возвратных накладных";
	
	Если ДиалогОткрытия.Выбрать() Тогда 		
		КаталогВозвратныхНакладных = ДиалогОткрытия.Каталог; 		
	КонецЕсли;
	
КонецПроцедуры

с_ЗначениеПолей = Новый Структура();


