
Процедура  ДобавлениеЭлементаФиксированнойСтруктуры(Код,ИмяПоля, Тип,ТЗМетаданных)
	
	        СтрокаТЗМД=ТЗМетаданных.Добавить();
			
			СтрокаТЗМД.Загрузить=ЛОжь;
			СтрокаТЗМД.Код=Код;
			СтрокаТЗМД.ПолеДокумента=ИмяПоля;
			СтрокаТЗМД.ТипОбъекта="Чек";
			СтрокаТЗМД.Вид="Документ аптечного модуля";
			СтрокаТЗМД.ИмяРеквизита = ИмяПоля;
			СтрокаТЗМД.ТипЗначенияРеквизита=Тип;
 КонецПроцедуры	



Процедура ПриОткрытии()
	
	ТЗКонвертерТипов=Новый ТаблицаЗначений;
	ТЗКонвертерТипов.Колонки.Добавить("_Тип");
	ТЗКонвертерТипов.Колонки.Добавить("ТипСтрока");
	
	СтрКТ=ТЗКонвертерТипов.Добавить();	
	СтрКТ.ТипСтрока="Число";
	СтрКТ._Тип=ТИп(СтрКТ.ТипСтрока);
	
	СтрКТ=ТЗКонвертерТипов.Добавить();	
	СтрКТ.ТипСтрока="Строка";
	СтрКТ._Тип=ТИп(СтрКТ.ТипСтрока);
	
	СтрКТ=ТЗКонвертерТипов.Добавить();	
	СтрКТ.ТипСтрока="Дата";
	СтрКТ._Тип=ТИп(СтрКТ.ТипСтрока);
	
	СтрКТ=ТЗКонвертерТипов.Добавить();	
	СтрКТ.ТипСтрока="Булево";
	СтрКТ._Тип=ТИп(СтрКТ.ТипСтрока);
	
	
	
	Для Каждого Перечисление Из Метаданные.Перечисления Цикл
		СтрКТ=ТЗКонвертерТипов.Добавить();	
		СтрКТ.ТипСтрока="ПеречислениеСсылка."+Перечисление.Имя;
		СтрКТ._Тип=ТИп(СтрКТ.ТипСтрока);
	КонецЦикла;	
	
	Для Каждого Справочник Из Метаданные.Справочники Цикл
		СтрКТ=ТЗКонвертерТипов.Добавить();	
		СтрКТ.ТипСтрока="СправочникСсылка."+Справочник.Имя;
		СтрКТ._Тип=ТИп(СтрКТ.ТипСтрока);
	КонецЦикла;	
	
	
	
	
	
	ТЗМетаданных=Новый ТаблицаЗначений;
	
	ТипСтрока=Новый ОписаниеТипов("Строка",Новый КвалификаторыСтроки(100,Допустимаядлина.Переменная));
	ТипЧислоКод=Новый ОписаниеТипов("Число",Новый КвалификаторыЧисла(15,0,ДопустимыйЗнак.Неотрицательный));
	
	
	
	ТЗМетаданных.Колонки.Добавить("Загрузить",Новый ОписаниеТипов("Булево"));
	ТЗМетаданных.Колонки.Добавить("Код",ТипЧислоКод);
	ТЗМетаданных.Колонки.Добавить("ПолеДокумента",ТипСтрока);
	
	ТЗМетаданных.Колонки.Добавить("ТипОбъекта",ТипСтрока);
	ТЗМетаданных.Колонки.Добавить("Вид",ТипСтрока);
	ТЗМетаданных.Колонки.Добавить("ИмяРеквизита",ТипСтрока);
	ТЗМетаданных.Колонки.Добавить("ТипЗначенияРеквизита",ТипСтрока);
	
	
	//---------------<АХТУНГ!!! Кодировка справочника параметров основана на порядке следования элементов в списоке значений >---------------------------// GtG // 09.04.2013 16:40:09
	// Если изменить этот порядок , то собьется кодировка и наступит ХАОС!!!
	МетаданныеСправочники=Новый СписокЗначений;
	МетаданныеСправочники.Добавить(Метаданные.Справочники.АССОРТИМЕНТНЫЙ_ПЛАН,"Товар");//1 *10000
	МетаданныеСправочники.Добавить(Метаданные.Справочники.Партии,"Партия");            //2 *10000 
	
	
	Х=0;
	Для Каждого ЭлемМД Из МетаданныеСправочники Цикл
		х=х+1;
		
		ПустойЭлемент=Справочники[ЭлемМД.Значение.Имя].ПустаяСсылка();
		
		//Сообщить(ЭлемМД.Значение.Имя);
		СтрокаТЗМД=ТЗМетаданных.Добавить();
		
		КодКорня=Х*10000;
		
		СтрокаТЗМД.Загрузить=ЛОжь;
		СтрокаТЗМД.Код=КодКорня;
		
		СтрокаТЗМД.ПолеДокумента=ЭлемМД.Представление;
		СтрокаТЗМД.ТипОбъекта="СправочникСсылка";
		СтрокаТЗМД.Вид=ЭлемМД.Значение.Имя;
		СтрокаТЗМД.ТипЗначенияРеквизита=""+СтрокаТЗМД.ТипОбъекта+"."+СтрокаТЗМД.Вид;
		
		//---------------<>---------------------------// GtG // 07.05.2013 15:49:23
		СтрокаТЗМД=ТЗМетаданных.Добавить();
		
		
		
		СтрокаТЗМД.Загрузить=ЛОжь;
		СтрокаТЗМД.Код=КодКорня+1;
		
		СтрокаТЗМД.ПолеДокумента=ЭлемМД.Представление;
		СтрокаТЗМД.ТипОбъекта="СправочникСсылка";
		СтрокаТЗМД.Вид=ЭлемМД.Значение.Имя;
		СтрокаТЗМД.ИмяРеквизита = "Наименование";
		СтрокаТЗМД.ТипЗначенияРеквизита="Строка";
		
		
		
		
		Хрекв=1;  
		Для Каждого Рекв из ЭлемМД.Значение.Реквизиты Цикл
			ХРекв=Хрекв+1;
			
			
			
			//Сообщить("		"+Рекв.Имя);
			СтрокаТЗМД=ТЗМетаданных.Добавить();
			
			СтрокаТЗМД.Загрузить=ЛОжь;
			СтрокаТЗМД.Код=КодКорня+Хрекв;
			СтрокаТЗМД.ПолеДокумента=ЭлемМД.Представление;
			СтрокаТЗМД.ТипОбъекта="СправочникСсылка";
			СтрокаТЗМД.Вид=ЭлемМД.Значение.Имя;
			СтрокаТЗМД.ИмяРеквизита = Рекв.Имя;
			
			РезТип=ТЗКонвертерТипов.Найти(ТипЗнч(пустойЭлемент[Рекв.Имя]),"_Тип");
			
			Если РезТип<>Неопределено Тогда
				СтрокаТЗМД.ТипЗначенияРеквизита=РезТип.ТипСтрока   ;
			КонецЕсли;
		КонецЦикла;
		
	КонецЦикла;
	
	ЭлементыФормы.ТЗ.Значение=ТЗМетаданных;
	ЭлементыФормы.ТЗ.СоздатьКолонки();
	
	//ЭлементыФормы.ТЗ.Колонки.Найти("Загрузить")  //УстановитьЭлементУправления(Тип("Флажок"));
	
	ЭлементыФормы.ТЗ.Колонки.Найти("Загрузить").УстановитьЭлементУправления(Тип("Флажок"));
	ЭлементыФормы.ТЗ.Колонки.Найти("Загрузить").ДанныеФлажка="Загрузить";
	ЭлементыФормы.ТЗ.Колонки.Найти("Загрузить").Доступность=Истина;
	ЭлементыФормы.ТЗ.Колонки.Найти("Загрузить").ТолькоПросмотр=Ложь;
	ЭлементыФормы.ТЗ.Колонки.Найти("Загрузить").РежимРедактирования=РежимРедактированияКолонки.Непосредственно;
	
	
	//---------------<Фиксированная структура данных чека>---------------------------// GtG // 07.05.2013 16:40:57
	ДобавлениеЭлементаФиксированнойСтруктуры(99001,"Количество", "Число",ТЗМетаданных);
	ДобавлениеЭлементаФиксированнойСтруктуры(99002,"Сумма", "Число",ТЗМетаданных);
	
	
	
	
	
	
	
	
	
КонецПроцедуры

Процедура КоманднаяПанель1ОтметитьВыделенныеСтрокиКакЗагружаемые(Кнопка)
	Для Каждого Стр Из ЭлементыФормы.ТЗ.ВыделенныеСтроки цикл
		Стр.Загрузить=Истина;
	КонецЦикла;	
КонецПроцедуры

Процедура ТЗПриВыводеСтроки(Элемент, ОформлениеСтроки, ДанныеСтроки)
	ОформлениеСтроки.Ячейки.Загрузить.ОтображатьФлажок=истина;
	ОформлениеСтроки.Ячейки.Загрузить.ОтображатьТекст=Ложь;
	
	Если данныеСтроки.Загрузить=Истина Тогда
		ОформлениеСтроки.ЦветФона=Новый Цвет(190,255,190);
	КонецЕсли;	
КонецПроцедуры

Процедура ОсновныеДействияФормыЗагрузить(Кнопка)
	
	Запрос=Новый Запрос("ВЫБРАТЬ
	|	РА_ПараметрыДляРекламныхАкций.Ссылка
	|ИЗ
	|	Справочник.РА_ПараметрыДляРекламныхАкций КАК РА_ПараметрыДляРекламныхАкций
	|ГДЕ
	|	РА_ПараметрыДляРекламныхАкций.ПолеДокумента = &ПолеДокумента
	|	И РА_ПараметрыДляРекламныхАкций.Тип = &Тип
	|	И РА_ПараметрыДляРекламныхАкций.РеквизитПоляДокумента = &РеквизитПоляДокумента");
	
	
	
	
	Для Каждого Стр Из ТЗ Цикл
		
		
		
		
		
		Если Стр.Загрузить=Ложь тогда 
			Продолжить;
		КонецЕсли;	
		
		
		Запрос.УстановитьПараметр("ПолеДокумента", Стр.ПолеДокумента);
		Запрос.УстановитьПараметр("Тип",Стр.ТипЗначенияРеквизита);
		Запрос.УстановитьПараметр("РеквизитПоляДокумента",Стр.ИмяРеквизита);
		
		
		Если Запрос.Выполнить().Пустой()=Ложь ТОгда
			Продолжить;
		КонецЕсли;
		
		
		
		
		Спр=Справочники.РА_ПараметрыДляРекламныхАкций.СоздатьЭлемент();
		Спр.Наименование=""+Стр.ПолеДокумента+?(ПустаяСтрока(Стр.ИмяРеквизита)=Истина,"","."+Стр.ИмяРеквизита);
		Спр.ПолеДокумента=Стр.ПолеДокумента;
		Спр.РеквизитПоляДокумента=Стр.ИмяРеквизита;
		Спр.Тип=Стр.ТипЗначенияРеквизита;
		СПр.Код=Стр.Код;
		
		Спр.Записать();
		
		
		
	КонецЦикла;
	
	
	
	
	
	
КонецПроцедуры
