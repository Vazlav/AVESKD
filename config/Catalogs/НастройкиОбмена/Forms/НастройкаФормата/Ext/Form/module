Перем СписокВыбораПоляФайла;
Перем СписокВыбораПоляТЧ;

Процедура СформироватьСписокВыбораПоляТЧ()
	СписокВыбораПоляТЧ.Очистить();
	Если УзелОбмена = "Заказ" Тогда
		СписокВыбораПоляТЧ.Добавить("Заказ.Ссылка.Номер");
		СписокВыбораПоляТЧ.Добавить("&ТекущаяДата");
		СписокВыбораПоляТЧ.Добавить("Заказ.КодТовараПоставщика");
		СписокВыбораПоляТЧ.Добавить("Заказ.Ссылка.Склад.Наименование");
		СписокВыбораПоляТЧ.Добавить("Заказ.Количество");
		СписокВыбораПоляТЧ.Добавить("Заказ.Цена");
		СписокВыбораПоляТЧ.Добавить("КодыАптек.Код");
		СписокВыбораПоляТЧ.Добавить("Заказ.НаименованиеТовараПоставщика");
	ИначеЕсли УзелОбмена = "Прайс" Тогда
		СписокВыбораПоляТЧ.Добавить("Код");
		СписокВыбораПоляТЧ.Добавить("Товар");
		СписокВыбораПоляТЧ.Добавить("Производитель");
		СписокВыбораПоляТЧ.Добавить("СрокГодности");
		СписокВыбораПоляТЧ.Добавить("Количество");
		СписокВыбораПоляТЧ.Добавить("Цена");
		СписокВыбораПоляТЧ.Добавить("Кратность");
		СписокВыбораПоляТЧ.Добавить("БарКод");
		СписокВыбораПоляТЧ.Добавить("КоличествоВСпайке");
		СписокВыбораПоляТЧ.Добавить("КоличествоВКоробе");
		СписокВыбораПоляТЧ.Добавить("ВхЦенаСНДС");
	ИначеЕсли УзелОбмена = "Накладная" Тогда
		СписокВыбораПоляТЧ.Добавить("НомерДок");
		СписокВыбораПоляТЧ.Добавить("ДатаДок");
		СписокВыбораПоляТЧ.Добавить("НомерСФ");
		СписокВыбораПоляТЧ.Добавить("ДатаСФ");
		СписокВыбораПоляТЧ.Добавить("Код");
		СписокВыбораПоляТЧ.Добавить("БарКод");
		СписокВыбораПоляТЧ.Добавить("ЦенаПроизводителя");
		СписокВыбораПоляТЧ.Добавить("ЦенаЗакуп");
		СписокВыбораПоляТЧ.Добавить("ЦенаЗакупБезНДС");
		СписокВыбораПоляТЧ.Добавить("Количество");
		СписокВыбораПоляТЧ.Добавить("Серия");
		СписокВыбораПоляТЧ.Добавить("СрокГодности");
		СписокВыбораПоляТЧ.Добавить("Наименование");
		СписокВыбораПоляТЧ.Добавить("СтавкаНДС");
		СписокВыбораПоляТЧ.Добавить("НомерГТД");
		СписокВыбораПоляТЧ.Добавить("Сертификат");
		СписокВыбораПоляТЧ.Добавить("СрокДействия");
		СписокВыбораПоляТЧ.Добавить("Склад");		
		СписокВыбораПоляТЧ.Добавить("СуммаЗакуп");
		СписокВыбораПоляТЧ.Добавить("Производитель");
		СписокВыбораПоляТЧ.Добавить("Страна");
		СписокВыбораПоляТЧ.Добавить("ЦенаГосРегистрации");
		СписокВыбораПоляТЧ.Добавить("ВходЦенаПоставщика");
		СписокВыбораПоляТЧ.Добавить("ВходящаяСтавка");
		СписокВыбораПоляТЧ.Добавить("ШКГрузовогоКонтейнера");
		СписокВыбораПоляТЧ.Добавить("ТипГрузовогоКонтейнера");
		//ENT-647 +++ Для загрузки поля "Торговое приложение"  добавит новый элеиент списка
		СписокВыбораПоляТЧ.Добавить("ТорговоеПриложение");
		//---
		
	ИначеЕсли УзелОбмена = "Отказ" Тогда
		СписокВыбораПоляТЧ.Добавить("НомерЗаказа");
		СписокВыбораПоляТЧ.Добавить("ДатаЗаказа");
		СписокВыбораПоляТЧ.Добавить("КодТовараПоставщика");
		СписокВыбораПоляТЧ.Добавить("Количество");
		СписокВыбораПоляТЧ.Добавить("Цена");
		СписокВыбораПоляТЧ.Добавить("КодПолучателя");
	ИначеЕсли УзелОбмена = "Инвойс" Тогда
		СписокВыбораПоляТЧ.Добавить("НомерСчетФактуры");
		СписокВыбораПоляТЧ.Добавить("ДатаСчетФактуры");
		СписокВыбораПоляТЧ.Добавить("КодТовараПоставщика");
		СписокВыбораПоляТЧ.Добавить("НаименованиеТовараПоставщика");
		СписокВыбораПоляТЧ.Добавить("Количество");
		СписокВыбораПоляТЧ.Добавить("ЦенаОтпускнаяБезНДС");
		СписокВыбораПоляТЧ.Добавить("ЦенаОтпускнаяСНДС");
		СписокВыбораПоляТЧ.Добавить("СуммаОтпускнаяСНДС");
		СписокВыбораПоляТЧ.Добавить("СтавкаНДС");
		СписокВыбораПоляТЧ.Добавить("СуммаНДС");
		СписокВыбораПоляТЧ.Добавить("Баркод");
		СписокВыбораПоляТЧ.Добавить("Серия");
		СписокВыбораПоляТЧ.Добавить("СрокГодности");
		СписокВыбораПоляТЧ.Добавить("ДатаИзготовления");
		СписокВыбораПоляТЧ.Добавить("Производитель");
		СписокВыбораПоляТЧ.Добавить("СтранаПроизводителя");
		СписокВыбораПоляТЧ.Добавить("ЦенаПроизводителяБезНДС");
		СписокВыбораПоляТЧ.Добавить("ЦенаГосРегистрации");
		СписокВыбораПоляТЧ.Добавить("НомерГТД");
		СписокВыбораПоляТЧ.Добавить("Сертификат");
		СписокВыбораПоляТЧ.Добавить("ДатаВыдачиСертификата");
		СписокВыбораПоляТЧ.Добавить("СрокДействияСертификата");
		СписокВыбораПоляТЧ.Добавить("ОрганСертификации");
		СписокВыбораПоляТЧ.Добавить("НомерЗаказа");
		СписокВыбораПоляТЧ.Добавить("ДатаЗаказа");
		СписокВыбораПоляТЧ.Добавить("Склад");
	ИначеЕсли УзелОбмена = "ЗаказОпт" Тогда
		СписокВыбораПоляТЧ.Добавить("Заказ.Ссылка.Номер");
		СписокВыбораПоляТЧ.Добавить("&ТекущаяДата");
		СписокВыбораПоляТЧ.Добавить("Заказ.КодТовараПоставщика");
		СписокВыбораПоляТЧ.Добавить("&НаименованиеАптеки");
		СписокВыбораПоляТЧ.Добавить("Заказ.Количество");
		СписокВыбораПоляТЧ.Добавить("Заказ.Цена");
		СписокВыбораПоляТЧ.Добавить("&КодАптеки");
		СписокВыбораПоляТЧ.Добавить("Заказ.НаименованиеТовараПоставщика");
	КонецЕсли;
КонецПроцедуры

Процедура УзелОбменаПриИзменении(Элемент)
	
	ТаблицаПолей.Очистить();
	
	МЗ = РегистрыСведений.НастройкиФорматаОбмена.СоздатьМенеджерЗаписи();
	МЗ.НастройкаОбмена = НастройкаОбмена;
	МЗ.УзелОбмена = УзелОбмена;
	МЗ.Прочитать();
	МЗРесурсы = Метаданные.РегистрыСведений.НастройкиФорматаОбмена.Ресурсы;
	Если МЗ.Выбран() Тогда
		ТаблицаПолей = МЗ.ТаблицаПолей.Получить();
		
		Для каждого стр из МЗРесурсы Цикл
			Элемент = ЭлементыФормы.Найти(стр.Имя);
			Если Элемент = Неопределено Тогда
				Продолжить;
			Иначе
				Элемент.Значение = МЗ[стр.Имя];
			КонецЕсли;
		КонецЦикла;
	КонецЕсли;
	
	СформироватьСписокВыбораПоляТЧ();
	
КонецПроцедуры

Процедура кнСохранитьНажатие(Элемент)
	
	МЗ = РегистрыСведений.НастройкиФорматаОбмена.СоздатьМенеджерЗаписи();
	МЗ.НастройкаОбмена = НастройкаОбмена;
	МЗ.УзелОбмена = УзелОбмена;
	МЗРесурсы = Метаданные.РегистрыСведений.НастройкиФорматаОбмена.Ресурсы;
	
	Для каждого стр из МЗРесурсы Цикл
		Элемент = ЭлементыФормы.Найти(стр.Имя);
		Если Элемент = Неопределено Тогда
			Продолжить;
		Иначе
			МЗ[стр.Имя] = Элемент.Значение;
		КонецЕсли;
	КонецЦикла;
	
	МЗ.ТаблицаПолей = Новый ХранилищеЗначения(ТаблицаПолей, Новый СжатиеДанных(9));
	
	МЗ.Записать();
	
	
КонецПроцедуры

Процедура ПриОткрытии()
	
	УзелОбменаПриИзменении("");
	
КонецПроцедуры

Процедура ФайлНастройкиНачалоВыбора(Элемент, СтандартнаяОбработка)
	
	СтандартнаяОбработка=Ложь;
	ДВФ=Новый ДиалогВыбораФайла(РежимДиалогаВыбораФайла.Открытие);
	ДВФ.МножественныйВыбор=Ложь;
	Фильтр = "(*.*)|*.*";
	
	ДВФ.Фильтр = Фильтр;
	ДВФ.Заголовок="Выберите файл для настройки";
	Если ДВФ.Выбрать() Тогда
		ФайлНастройки=СокрЛП(ДВФ.ПолноеИмяФайла);
	КонецЕсли;
	
	
КонецПроцедуры

Процедура КоманднаяПанель1кнЗаполнитьНаОснованииНастройки(Кнопка)
	
	ФормаСписка = Справочники.НастройкиОбмена.ПолучитьФормуВыбора();
	ФормаСписка.ВладелецФормы = ЭтаФорма;
	ФормаСписка.ОткрытьМодально();
	
КонецПроцедуры

Процедура ОбработкаВыбора(ЗначениеВыбора, Источник)
	
	Режим = РежимДиалогаВопрос.ДаНет;
	Текст = "Вы действительно хотите скопировать форматы обмена по настройке: " + ЗначениеВыбора + " ?";
	Ответ = Вопрос(Текст, Режим, 0);
	Если Ответ = КодВозвратаДиалога.Нет Тогда
		Возврат;
	КонецЕсли; 
	
	ТХТ = "ВЫБРАТЬ
	      |	&НоваяНастройка как НастройкаОбмена,
	      |	НастройкиФорматаОбмена.УзелОбмена,
	      |	НастройкиФорматаОбмена.ТаблицаПолей,
	      |	НастройкиФорматаОбмена.ФайлВАрхиве,
	      |	НастройкиФорматаОбмена.РассчитыватьСуммуНакладной
	      |ИЗ
	      |	РегистрСведений.НастройкиФорматаОбмена КАК НастройкиФорматаОбмена
	      |ГДЕ
	      |	НастройкиФорматаОбмена.НастройкаОбмена = &НастройкаОбмена";
		  
	Запрос = Новый Запрос;
	Запрос.Текст = ТХТ;
	Запрос.УстановитьПараметр("НастройкаОбмена",ЗначениеВыбора);
	Запрос.УстановитьПараметр("НоваяНастройка",НастройкаОбмена);
	
	Рез = Запрос.Выполнить();
	Если Рез.Пустой() Тогда
		Предупреждение("У выбранной настройки не заданы форматы обмена. Операция не может быть продолжена");
		Возврат;
	КонецЕсли;
	Результат = Рез.Выгрузить();
	
	НЗ = РегистрыСведений.НастройкиФорматаОбмена.СоздатьНаборЗаписей();
	НЗ.Отбор.НастройкаОбмена.Установить(НастройкаОбмена);	
	НЗ.Загрузить(Результат);
	НЗ.Записать();

	УзелОбменаПриИзменении("");
	
КонецПроцедуры

Процедура кнСформироватьСтруктуруПолейФайлаНажатие(Элемент)
	
	
	Если ПустаяСтрока(ФайлНастройки) = Истина Тогда
		Предупреждение("Не выбран пример файла настройки.");	
		Возврат;
	КонецЕсли;
	
	ФайлОбъект = Новый Файл(ФайлНастройки);
	Если ФайлОбъект.Расширение = ".dbf" Тогда
		
		СписокВыбораПоляФайла.Очистить();
		
		ДБФ = Новый XBASE;
		Попытка
			ДБФ.ОткрытьФайл(СокрЛП(ФайлНастройки));
		Исключение
			Сообщить(ОписаниеОшибки());
			Возврат;
		КонецПопытки;
		
		Если ДБФ.Открыта() Тогда
			Для Ц=0 По ДБФ.поля.Количество()-1 Цикл
				СписокВыбораПоляФайла.Добавить(ДБФ.поля[Ц].Имя);
			КонецЦикла;
		КонецЕсли;
		ДБФ.ЗакрытьФайл();
	КонецЕсли;
	
	// СформироватьСписокВыбораПоляТЧ();
КонецПроцедуры

Процедура ТаблицаПолейИмяПоляВФайлеНачалоВыбораИзСписка(Элемент, СтандартнаяОбработка)
	Элемент.СписокВыбора = СписокВыбораПоляФайла;
КонецПроцедуры

Процедура ТаблицаПолейИмяПоляБДНачалоВыбораИзСписка(Элемент, СтандартнаяОбработка)
	Если СписокВыбораПоляТЧ.Количество() = 0 Тогда
		СформироватьСписокВыбораПоляТЧ();
	КонецЕсли;
	
	Элемент.СписокВыбора = СписокВыбораПоляТЧ;
КонецПроцедуры

Процедура ЗаполнитьПоШаблонуПрайс()
	
	ТаблицаПолей.Очистить();
	НоваяСтрока = ТаблицаПолей.Добавить();
	НоваяСтрока.ИмяполяВФайле = "CODEPST";
	НоваяСтрока.ИмяПоляБД = "Код";
	
	НоваяСтрока = ТаблицаПолей.Добавить();
	НоваяСтрока.ИмяполяВФайле = "NAME";	
	НоваяСтрока.ИмяПоляБД = "Товар";
	
	НоваяСтрока = ТаблицаПолей.Добавить();	
	НоваяСтрока.ИмяполяВФайле = "CNTR";	
	НоваяСтрока.ИмяПоляБД = "Страна";
	
	НоваяСтрока = ТаблицаПолей.Добавить();
	НоваяСтрока.ИмяполяВФайле = "FIRM";
	НоваяСтрока.ИмяПоляБД = "Производитель";
	
	//НоваяСтрока.ИмяполяВФайле = "QNTPACK";
	//НоваяСтрока.ИмяПоляБД = "Товар";
	
	НоваяСтрока = ТаблицаПолей.Добавить();
	НоваяСтрока.ИмяполяВФайле = "EAN13";
	НоваяСтрока.ИмяПоляБД = "БарКод";
	
	НоваяСтрока = ТаблицаПолей.Добавить();
	НоваяСтрока.ИмяполяВФайле = "GDATE";
	НоваяСтрока.ИмяПоляБД = "СрокГодности";
	
	НоваяСтрока = ТаблицаПолей.Добавить();
	НоваяСтрока.ИмяполяВФайле = "QNT";
	НоваяСтрока.ИмяПоляБД = "Количество";
	
	НоваяСтрока = ТаблицаПолей.Добавить();
	НоваяСтрока.ИмяполяВФайле = "PRICE";
	НоваяСтрока.ИмяПоляБД = "Цена";
	
	НоваяСтрока = ТаблицаПолей.Добавить();
	НоваяСтрока.ИмяполяВФайле = "RATEPACK";
	НоваяСтрока.ИмяПоляБД = "Кратность";

	
	
	МЗ = РегистрыСведений.НастройкиФорматаОбмена.СоздатьМенеджерЗаписи();
	МЗ.Активность = Истина;
	МЗ.НастройкаОбмена = НастройкаОбмена;
	МЗ.УзелОбмена = "Прайс";
	МЗ.ТаблицаПолей = Новый ХранилищеЗначения(ТаблицаПолей, Новый СжатиеДанных(9));
    МЗ.Записать();	
	
КонецПроцедуры

Процедура ЗаполнитьПоШаблонуЗаказ()
	
	ТаблицаПолей.Очистить();
	НоваяСтрока = ТаблицаПолей.Добавить();
	НоваяСтрока.ИмяполяВФайле = "NUMZ";
	НоваяСтрока.ИмяПоляБД = "Заказ.Ссылка.Номер";
	НоваяСтрока.ТипПоля = "Число";
	НоваяСтрока.ДлинаПоля = 15;
	НоваяСтрока.Точность = 0;
	
	НоваяСтрока = ТаблицаПолей.Добавить();
	НоваяСтрока.ИмяполяВФайле = "DATEZ";	
	НоваяСтрока.ИмяПоляБД = "&ТекущаяДата";
	НоваяСтрока.ТипПоля = "Дата";
	НоваяСтрока.ДлинаПоля = 8;
	НоваяСтрока.Точность = 0;	
	
	НоваяСтрока = ТаблицаПолей.Добавить();	
	НоваяСтрока.ИмяполяВФайле = "CODEPST";	
	НоваяСтрока.ИмяПоляБД = "Заказ.КодТовараПоставщика";
	НоваяСтрока.ТипПоля = "Строка";
	НоваяСтрока.ДлинаПоля = 36;
	НоваяСтрока.Точность = 0;	
	
	НоваяСтрока = ТаблицаПолей.Добавить();
	НоваяСтрока.ИмяполяВФайле = "DATEEXP";
	НоваяСтрока.ИмяПоляБД = "&ТекущаяДата";
	НоваяСтрока.ТипПоля = "Дата";
	НоваяСтрока.ДлинаПоля = 8;
	НоваяСтрока.Точность = 0;
	
	НоваяСтрока = ТаблицаПолей.Добавить();
	НоваяСтрока.ИмяполяВФайле = "DATE";
	НоваяСтрока.ИмяПоляБД = "&ТекущаяДата";
	НоваяСтрока.ТипПоля = "Дата";
	НоваяСтрока.ДлинаПоля = 8;
	НоваяСтрока.Точность = 0;	
	
	НоваяСтрока = ТаблицаПолей.Добавить();
	НоваяСтрока.ИмяполяВФайле = "PODR";
	НоваяСтрока.ИмяПоляБД = "Заказ.Ссылка.Склад.Наименование";
	НоваяСтрока.ТипПоля = "Строка";
	НоваяСтрока.ДлинаПоля = 80;
	НоваяСтрока.Точность = 0;	
	
	НоваяСтрока = ТаблицаПолей.Добавить();
	НоваяСтрока.ИмяполяВФайле = "QNT";
	НоваяСтрока.ИмяПоляБД = "Заказ.Количество";
	НоваяСтрока.ТипПоля = "Число";
	НоваяСтрока.ДлинаПоля = 15;
	НоваяСтрока.Точность = 2;	
	
	НоваяСтрока = ТаблицаПолей.Добавить();
	НоваяСтрока.ИмяполяВФайле = "PRICE";
	НоваяСтрока.ИмяПоляБД = "Заказ.Цена";
	НоваяСтрока.ТипПоля = "Число";
	НоваяСтрока.ДлинаПоля = 15;
	НоваяСтрока.Точность = 2;	
	
	НоваяСтрока = ТаблицаПолей.Добавить();
	НоваяСтрока.ИмяполяВФайле = "PODRCD";
	НоваяСтрока.ИмяПоляБД = "КодыАптек.Код";
	НоваяСтрока.ТипПоля = "Строка";
	НоваяСтрока.ДлинаПоля = 25;
	НоваяСтрока.Точность = 0;	

	
	МЗ = РегистрыСведений.НастройкиФорматаОбмена.СоздатьМенеджерЗаписи();
	МЗ.Активность = Истина;
	МЗ.НастройкаОбмена = НастройкаОбмена;
	МЗ.УзелОбмена = "Заказ";
	МЗ.ТаблицаПолей = Новый ХранилищеЗначения(ТаблицаПолей, Новый СжатиеДанных(9));
    МЗ.Записать();	
	
КонецПроцедуры

Процедура ЗаполнитьПоШаблонуЗаказИнтернетАптек()
	
	ТаблицаПолей.Очистить();
	НоваяСтрока = ТаблицаПолей.Добавить();
	НоваяСтрока.ИмяполяВФайле = "NUMZ";
	НоваяСтрока.ИмяПоляБД = "Заказ.Ссылка.Номер";
	НоваяСтрока.ТипПоля = "Число";
	НоваяСтрока.ДлинаПоля = 15;
	НоваяСтрока.Точность = 0;
	
	НоваяСтрока = ТаблицаПолей.Добавить();
	НоваяСтрока.ИмяполяВФайле = "DATEZ";	
	НоваяСтрока.ИмяПоляБД = "&ТекущаяДата";
	НоваяСтрока.ТипПоля = "Дата";
	НоваяСтрока.ДлинаПоля = 8;
	НоваяСтрока.Точность = 0;	
	
	НоваяСтрока = ТаблицаПолей.Добавить();	
	НоваяСтрока.ИмяполяВФайле = "CODEPST";	
	НоваяСтрока.ИмяПоляБД = "Заказ.КодТовараПоставщика";
	НоваяСтрока.ТипПоля = "Строка";
	НоваяСтрока.ДлинаПоля = 36;
	НоваяСтрока.Точность = 0;	
	
	НоваяСтрока = ТаблицаПолей.Добавить();
	НоваяСтрока.ИмяполяВФайле = "DATEEXP";
	НоваяСтрока.ИмяПоляБД = "&ТекущаяДата";
	НоваяСтрока.ТипПоля = "Дата";
	НоваяСтрока.ДлинаПоля = 8;
	НоваяСтрока.Точность = 0;
	
	НоваяСтрока = ТаблицаПолей.Добавить();
	НоваяСтрока.ИмяполяВФайле = "DATE";
	НоваяСтрока.ИмяПоляБД = "&ТекущаяДата";
	НоваяСтрока.ТипПоля = "Дата";
	НоваяСтрока.ДлинаПоля = 8;
	НоваяСтрока.Точность = 0;	
	
	НоваяСтрока = ТаблицаПолей.Добавить();
	НоваяСтрока.ИмяполяВФайле = "PODR";
	НоваяСтрока.ИмяПоляБД = "Заказ.Ссылка.Склад.Наименование";
	НоваяСтрока.ТипПоля = "Строка";
	НоваяСтрока.ДлинаПоля = 80;
	НоваяСтрока.Точность = 0;	
	
	НоваяСтрока = ТаблицаПолей.Добавить();
	НоваяСтрока.ИмяполяВФайле = "QNT";
	НоваяСтрока.ИмяПоляБД = "Заказ.Количество";
	НоваяСтрока.ТипПоля = "Число";
	НоваяСтрока.ДлинаПоля = 15;
	НоваяСтрока.Точность = 2;	
	
	НоваяСтрока = ТаблицаПолей.Добавить();
	НоваяСтрока.ИмяполяВФайле = "PRICE";
	НоваяСтрока.ИмяПоляБД = "Заказ.Цена";
	НоваяСтрока.ТипПоля = "Число";
	НоваяСтрока.ДлинаПоля = 15;
	НоваяСтрока.Точность = 2;	
	
	НоваяСтрока = ТаблицаПолей.Добавить();
	НоваяСтрока.ИмяполяВФайле = "PODRCD";
	НоваяСтрока.ИмяПоляБД = "КодыАптек.Код";
	НоваяСтрока.ТипПоля = "Строка";
	НоваяСтрока.ДлинаПоля = 25;
	НоваяСтрока.Точность = 0;	

	
	МЗ = РегистрыСведений.НастройкиФорматаОбмена.СоздатьМенеджерЗаписи();
	МЗ.Активность = Истина;
	МЗ.НастройкаОбмена = НастройкаОбмена;
	МЗ.УзелОбмена = "Заказ";
	МЗ.ТаблицаПолей = Новый ХранилищеЗначения(ТаблицаПолей, Новый СжатиеДанных(9));
    МЗ.Записать();	
	
КонецПроцедуры

Процедура ЗаполнитьПоШаблонуЗаказОпт()
	
	ТаблицаПолей.Очистить();
	НоваяСтрока = ТаблицаПолей.Добавить();
	НоваяСтрока.ИмяполяВФайле = "NUMZ";
	НоваяСтрока.ИмяПоляБД = "Заказ.Ссылка.Номер";
	НоваяСтрока.ТипПоля = "Число";
	НоваяСтрока.ДлинаПоля = 15;
	НоваяСтрока.Точность = 0;
	
	НоваяСтрока = ТаблицаПолей.Добавить();
	НоваяСтрока.ИмяполяВФайле = "DATEZ";	
	НоваяСтрока.ИмяПоляБД = "&ТекущаяДата";
	НоваяСтрока.ТипПоля = "Дата";
	НоваяСтрока.ДлинаПоля = 8;
	НоваяСтрока.Точность = 0;	
	
	НоваяСтрока = ТаблицаПолей.Добавить();	
	НоваяСтрока.ИмяполяВФайле = "CODEPST";	
	НоваяСтрока.ИмяПоляБД = "Заказ.КодТовараПоставщика";
	НоваяСтрока.ТипПоля = "Строка";
	НоваяСтрока.ДлинаПоля = 36;
	НоваяСтрока.Точность = 0;	
	
	НоваяСтрока = ТаблицаПолей.Добавить();
	НоваяСтрока.ИмяполяВФайле = "DATEEXP";
	НоваяСтрока.ИмяПоляБД = "&ТекущаяДата";
	НоваяСтрока.ТипПоля = "Дата";
	НоваяСтрока.ДлинаПоля = 8;
	НоваяСтрока.Точность = 0;
	
	НоваяСтрока = ТаблицаПолей.Добавить();
	НоваяСтрока.ИмяполяВФайле = "DATE";
	НоваяСтрока.ИмяПоляБД = "&ТекущаяДата";
	НоваяСтрока.ТипПоля = "Дата";
	НоваяСтрока.ДлинаПоля = 8;
	НоваяСтрока.Точность = 0;	
	
	НоваяСтрока = ТаблицаПолей.Добавить();
	НоваяСтрока.ИмяполяВФайле = "PODR";
	НоваяСтрока.ИмяПоляБД = "&НаименованиеАптеки";
	НоваяСтрока.ТипПоля = "Строка";
	НоваяСтрока.ДлинаПоля = 80;
	НоваяСтрока.Точность = 0;	
	
	НоваяСтрока = ТаблицаПолей.Добавить();
	НоваяСтрока.ИмяполяВФайле = "QNT";
	НоваяСтрока.ИмяПоляБД = "Заказ.Количество";
	НоваяСтрока.ТипПоля = "Число";
	НоваяСтрока.ДлинаПоля = 15;
	НоваяСтрока.Точность = 2;	
	
	НоваяСтрока = ТаблицаПолей.Добавить();
	НоваяСтрока.ИмяполяВФайле = "PRICE";
	НоваяСтрока.ИмяПоляБД = "Заказ.Цена";
	НоваяСтрока.ТипПоля = "Число";
	НоваяСтрока.ДлинаПоля = 15;
	НоваяСтрока.Точность = 2;	
	
	НоваяСтрока = ТаблицаПолей.Добавить();
	НоваяСтрока.ИмяполяВФайле = "PODRCD";
	НоваяСтрока.ИмяПоляБД = "&КодАптеки";
	НоваяСтрока.ТипПоля = "Строка";
	НоваяСтрока.ДлинаПоля = 25;
	НоваяСтрока.Точность = 0;	

	
	МЗ = РегистрыСведений.НастройкиФорматаОбмена.СоздатьМенеджерЗаписи();
	МЗ.Активность = Истина;
	МЗ.НастройкаОбмена = НастройкаОбмена;
	МЗ.УзелОбмена = "ЗаказОпт";
	МЗ.ТаблицаПолей = Новый ХранилищеЗначения(ТаблицаПолей, Новый СжатиеДанных(9));
    МЗ.Записать();	
	
КонецПроцедуры



Процедура ЗаполнитьПоШаблонуОтказ()
	
	ТаблицаПолей.Очистить();
	НоваяСтрока = ТаблицаПолей.Добавить();
	НоваяСтрока.ИмяполяВФайле = "NUMZ";
	НоваяСтрока.ИмяПоляБД = "НомерЗаказа";
	
	НоваяСтрока = ТаблицаПолей.Добавить();
	НоваяСтрока.ИмяполяВФайле = "DATEZ";	
	НоваяСтрока.ИмяПоляБД = "ДатаЗаказа";
	
	НоваяСтрока = ТаблицаПолей.Добавить();	
	НоваяСтрока.ИмяполяВФайле = "CODEPST";	
	НоваяСтрока.ИмяПоляБД = "КодТовараПоставщика";
	
	НоваяСтрока = ТаблицаПолей.Добавить();
	НоваяСтрока.ИмяполяВФайле = "QNT";
	НоваяСтрока.ИмяПоляБД = "Количество";
	
	НоваяСтрока = ТаблицаПолей.Добавить();
	НоваяСтрока.ИмяполяВФайле = "PRICE";
	НоваяСтрока.ИмяПоляБД = "Цена";
	
	НоваяСтрока = ТаблицаПолей.Добавить();
	НоваяСтрока.ИмяполяВФайле = "PODRCD";
	НоваяСтрока.ИмяПоляБД = "КодПолучателя";
	
	МЗ = РегистрыСведений.НастройкиФорматаОбмена.СоздатьМенеджерЗаписи();
	МЗ.Активность = Истина;
	МЗ.НастройкаОбмена = НастройкаОбмена;
	МЗ.УзелОбмена = "Отказ";
	МЗ.ТаблицаПолей = Новый ХранилищеЗначения(ТаблицаПолей, Новый СжатиеДанных(9));
    МЗ.Записать();	
	
КонецПроцедуры

Процедура ЗаполнитьПоШаблонуНакладная()
	
	ТаблицаПолей.Очистить();
	НоваяСтрока = ТаблицаПолей.Добавить();
	НоваяСтрока.ИмяполяВФайле	= "NDOC";
	НоваяСтрока.ИмяПоляБД		= "НомерДок";
	
	НоваяСтрока = ТаблицаПолей.Добавить();
	НоваяСтрока.ИмяполяВФайле	= "DATEDOC";	
	НоваяСтрока.ИмяПоляБД		= "ДатаДок";
	
	НоваяСтрока = ТаблицаПолей.Добавить();	
	НоваяСтрока.ИмяполяВФайле	= "BILLNUM";	
	НоваяСтрока.ИмяПоляБД		= "НомерСФ";
	
	НоваяСтрока = ТаблицаПолей.Добавить();
	НоваяСтрока.ИмяполяВФайле	= "BILLDT";
	НоваяСтрока.ИмяПоляБД		= "ДатаСФ";
	
	НоваяСтрока = ТаблицаПолей.Добавить();
	НоваяСтрока.ИмяполяВФайле	= "CODEPST";
	НоваяСтрока.ИмяПоляБД		= "Код";
	
	НоваяСтрока = ТаблицаПолей.Добавить();
	НоваяСтрока.ИмяполяВФайле	= "EAN13";
	НоваяСтрока.ИмяПоляБД		= "БарКод";
	
	НоваяСтрока = ТаблицаПолей.Добавить();	
	НоваяСтрока.ИмяполяВФайле	= "PRICE1";	
	НоваяСтрока.ИмяПоляБД		= "ЦенаПроизводителя";
	
	НоваяСтрока = ТаблицаПолей.Добавить();
	НоваяСтрока.ИмяполяВФайле	= "PRICE2";
	НоваяСтрока.ИмяПоляБД		= "ЦенаЗакуп";
	
	НоваяСтрока = ТаблицаПолей.Добавить();
	НоваяСтрока.ИмяполяВФайле	= "PRICE2N";
	НоваяСтрока.ИмяПоляБД		= "ЦенаЗакупБезНДС";
	
	НоваяСтрока = ТаблицаПолей.Добавить();
	НоваяСтрока.ИмяполяВФайле	= "QNT";
	НоваяСтрока.ИмяПоляБД		= "Количество";
	
	НоваяСтрока = ТаблицаПолей.Добавить();	
	НоваяСтрока.ИмяполяВФайле 	= "SER";	
	НоваяСтрока.ИмяПоляБД 		= "Серия";
	
	НоваяСтрока = ТаблицаПолей.Добавить();
	НоваяСтрока.ИмяполяВФайле 	= "GDATE";
	НоваяСтрока.ИмяПоляБД 		= "СрокГодности";
	
	НоваяСтрока = ТаблицаПолей.Добавить();
	НоваяСтрока.ИмяполяВФайле 	= "NAME";
	НоваяСтрока.ИмяПоляБД 		= "Наименование";
	
	НоваяСтрока = ТаблицаПолей.Добавить();
	НоваяСтрока.ИмяполяВФайле 	= "NDS";
	НоваяСтрока.ИмяПоляБД 		= "СтавкаНДС";
	
	НоваяСтрока = ТаблицаПолей.Добавить();
	НоваяСтрока.ИмяполяВФайле 	= "NUMGTD";
	НоваяСтрока.ИмяПоляБД 		= "НомерГТД";
	
	НоваяСтрока = ТаблицаПолей.Добавить();	
	НоваяСтрока.ИмяполяВФайле 	= "SERTIF";	
	НоваяСтрока.ИмяПоляБД 		= "Сертификат";
	
	НоваяСтрока = ТаблицаПолей.Добавить();
	НоваяСтрока.ИмяполяВФайле 	= "SERTDATE";
	НоваяСтрока.ИмяПоляБД 		= "СрокДействия";
	
	НоваяСтрока = ТаблицаПолей.Добавить();
	НоваяСтрока.ИмяполяВФайле 	= "PODRCD";
	НоваяСтрока.ИмяПоляБД 		= "Склад";
	
	НоваяСтрока = ТаблицаПолей.Добавить();
	НоваяСтрока.ИмяполяВФайле 	= "SUMSTR";
	НоваяСтрока.ИмяПоляБД 		= "СуммаЗакуп";
	
	НоваяСтрока = ТаблицаПолей.Добавить();
	НоваяСтрока.ИмяполяВФайле 	= "FIRM";
	НоваяСтрока.ИмяПоляБД 		= "Производитель";
	
	НоваяСтрока = ТаблицаПолей.Добавить();
	НоваяСтрока.ИмяполяВФайле 	= "CNTR";
	НоваяСтрока.ИмяПоляБД 		= "Страна";	
	
	НоваяСтрока = ТаблицаПолей.Добавить();
	НоваяСтрока.ИмяполяВФайле 	= "REGPRC";
	НоваяСтрока.ИмяПоляБД 		= "ЦенаГосРегистрации";		
	
	МЗ = РегистрыСведений.НастройкиФорматаОбмена.СоздатьМенеджерЗаписи();
	МЗ.Активность = Истина;
	МЗ.НастройкаОбмена = НастройкаОбмена;
	МЗ.УзелОбмена = "Накладная";
	МЗ.ТаблицаПолей = Новый ХранилищеЗначения(ТаблицаПолей, Новый СжатиеДанных(9));
    МЗ.Записать();	
	
КонецПроцедуры

Процедура ЗаполнитьПоШаблонуИнвойс()
	
	ТаблицаПолей.Очистить();
	НоваяСтрока = ТаблицаПолей.Добавить();
	НоваяСтрока.ИмяполяВФайле	= "NDOC";
	НоваяСтрока.ИмяПоляБД		= "НомерСчетФактуры";
	
	НоваяСтрока = ТаблицаПолей.Добавить();
	НоваяСтрока.ИмяполяВФайле	= "DATEDOC";
	НоваяСтрока.ИмяПоляБД		= "ДатаСчетФактуры";
	
	НоваяСтрока = ТаблицаПолей.Добавить();
	НоваяСтрока.ИмяполяВФайле	= "CODEPST";
	НоваяСтрока.ИмяПоляБД		= "КодТовараПоставщика";
	
	НоваяСтрока = ТаблицаПолей.Добавить();
	НоваяСтрока.ИмяполяВФайле	= "NAME";
	НоваяСтрока.ИмяПоляБД		= "НаименованиеТовараПоставщика";
	
	НоваяСтрока = ТаблицаПолей.Добавить();
	НоваяСтрока.ИмяполяВФайле	= "QNT";
	НоваяСтрока.ИмяПоляБД		= "Количество";
	
	НоваяСтрока = ТаблицаПолей.Добавить();
	НоваяСтрока.ИмяполяВФайле	= "PRICE2";
	НоваяСтрока.ИмяПоляБД		= "ЦенаОтпускнаяБезНДС";
	
	НоваяСтрока = ТаблицаПолей.Добавить();
	НоваяСтрока.ИмяполяВФайле	= "PRICE2N";
	НоваяСтрока.ИмяПоляБД		= "ЦенаОтпускнаяСНДС";
	
	НоваяСтрока = ТаблицаПолей.Добавить();
	НоваяСтрока.ИмяполяВФайле	= "SUMSTR";
	НоваяСтрока.ИмяПоляБД		= "СуммаОтпускнаяСНДС";
	
	НоваяСтрока = ТаблицаПолей.Добавить();
	НоваяСтрока.ИмяполяВФайле	= "NDS";
	НоваяСтрока.ИмяПоляБД		= "СтавкаНДС";
	
	НоваяСтрока = ТаблицаПолей.Добавить();
	НоваяСтрока.ИмяполяВФайле	= "SUMNDS";
	НоваяСтрока.ИмяПоляБД		= "СуммаНДС";
	
	НоваяСтрока = ТаблицаПолей.Добавить();
	НоваяСтрока.ИмяполяВФайле	= "EAN13";
	НоваяСтрока.ИмяПоляБД		= "Баркод";
	
	НоваяСтрока = ТаблицаПолей.Добавить();
	НоваяСтрока.ИмяполяВФайле	= "SER";
	НоваяСтрока.ИмяПоляБД		= "Серия";
	
	НоваяСтрока = ТаблицаПолей.Добавить();
	НоваяСтрока.ИмяполяВФайле	= "GDATE";
	НоваяСтрока.ИмяПоляБД		= "СрокГодности";
	
	НоваяСтрока = ТаблицаПолей.Добавить();
	НоваяСтрока.ИмяполяВФайле	= "DATEMADE";
	НоваяСтрока.ИмяПоляБД		= "ДатаИзготовления";
	
	НоваяСтрока = ТаблицаПолей.Добавить();
	НоваяСтрока.ИмяполяВФайле	= "FIRM";
	НоваяСтрока.ИмяПоляБД		= "Производитель";
	
	НоваяСтрока = ТаблицаПолей.Добавить();
	НоваяСтрока.ИмяполяВФайле	= "CNTR";
	НоваяСтрока.ИмяПоляБД		= "СтранаПроизводителя";
	
	НоваяСтрока = ТаблицаПолей.Добавить();
	НоваяСтрока.ИмяполяВФайле	= "PRICE1";
	НоваяСтрока.ИмяПоляБД		= "ЦенаПроизводителяБезНДС";
	
	НоваяСтрока = ТаблицаПолей.Добавить();
	НоваяСтрока.ИмяполяВФайле	= "REGPRC";
	НоваяСтрока.ИмяПоляБД		= "ЦенаГосРегистрации";
	
	НоваяСтрока = ТаблицаПолей.Добавить();
	НоваяСтрока.ИмяполяВФайле	= "NUMGTD";
	НоваяСтрока.ИмяПоляБД		= "НомерГТД";
	
	НоваяСтрока = ТаблицаПолей.Добавить();
	НоваяСтрока.ИмяполяВФайле	= "SERTIF";
	НоваяСтрока.ИмяПоляБД		= "Сертификат";
	
	НоваяСтрока = ТаблицаПолей.Добавить();
	НоваяСтрока.ИмяполяВФайле	= "SERTDATE";
	НоваяСтрока.ИмяПоляБД		= "СрокДействияСертификата";
	
	НоваяСтрока = ТаблицаПолей.Добавить();
	НоваяСтрока.ИмяполяВФайле	= "SERTGIVE";
	НоваяСтрока.ИмяПоляБД		= "ДатаВыдачиСертификата";
	
	НоваяСтрока = ТаблицаПолей.Добавить();
	НоваяСтрока.ИмяполяВФайле	= "SERTORG";
	НоваяСтрока.ИмяПоляБД		= "ОрганСертификации";
	
	НоваяСтрока = ТаблицаПолей.Добавить();
	НоваяСтрока.ИмяполяВФайле	= "NUMZ";
	НоваяСтрока.ИмяПоляБД		= "НомерЗаказа";
	
	НоваяСтрока = ТаблицаПолей.Добавить();
	НоваяСтрока.ИмяполяВФайле	= "DATEZ";
	НоваяСтрока.ИмяПоляБД		= "ДатаЗаказа";
	
	НоваяСтрока = ТаблицаПолей.Добавить();
	НоваяСтрока.ИмяполяВФайле 	= "PODRCD";
	НоваяСтрока.ИмяПоляБД 		= "Склад";
		
	
	МЗ = РегистрыСведений.НастройкиФорматаОбмена.СоздатьМенеджерЗаписи();
	МЗ.Активность = Истина;
	МЗ.НастройкаОбмена = НастройкаОбмена;
	МЗ.УзелОбмена = "Инвойс";
	МЗ.ТаблицаПолей = Новый ХранилищеЗначения(ТаблицаПолей, Новый СжатиеДанных(9));
    МЗ.Записать();	
	
КонецПроцедуры


Процедура КоманднаяПанель1кнЗаполнитьПоШаблону(Кнопка)
	
	Режим = РежимДиалогаВопрос.ДаНет;
	Текст = "Вы действительно хотите заполнить форматы обмена по шаблону?";
	Ответ = Вопрос(Текст, Режим, 0);
	Если Ответ = КодВозвратаДиалога.Нет Тогда
		Возврат;
	КонецЕсли; 	
	
	ЗаполнитьПоШаблонуПрайс();
	ЗаполнитьПоШаблонуЗаказ();
	ЗаполнитьПоШаблонуЗаказИнтернетАптек();
	ЗаполнитьПоШаблонуОтказ();
	ЗаполнитьПоШаблонуНакладная();
	ЗаполнитьПоШаблонуИнвойс();
	ЗаполнитьПоШаблонуЗаказОпт();
	
	УзелОбменаПриИзменении("");	
	
КонецПроцедуры

СписокВыбораПоляФайла = Новый СписокЗначений;
СписокВыбораПоляТЧ = Новый СписокЗначений;
