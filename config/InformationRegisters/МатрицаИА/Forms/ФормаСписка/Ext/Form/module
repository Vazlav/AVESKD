Перем СтруктураДанныхПриОткрытии;
Перем УдалениеДДП;
Перем УдалениеИА;
Перем УдалениеAreaID;

Процедура ДобавитьЗаписьВРС_МатрицаИА_Лог(КодДДП,ИА,AreaID,Событие,Реквизит = Неопределено,СтароеЗначение = Неопределено,НовоеЗначение = Неопределено)
	
	// Для записи нескольких строк в течении одной секунды
	ОбщегоНазначения.Задержка(1);
	
	МЗ = РегистрыСведений.МатрицаИА_Лог.СоздатьМенеджерЗаписи();
	МЗ.Период			= ТекущаяДата();
	МЗ.КодДДП			= КодДДП;
	МЗ.ИА 				= ИА;
	МЗ.AreaID			= AreaID;
	МЗ.Событие			= Событие;
	МЗ.Реквизит			= Реквизит;
	МЗ.СтароеЗначение	= СтароеЗначение;
	МЗ.НовоеЗначение	= НовоеЗначение;
	МЗ.Пользователь		= ПараметрыСеанса.ТекущийСотр;
	Попытка
		МЗ.Записать(Ложь);
	Исключение
		
	КонецПопытки;
	
КонецПроцедуры	

Процедура РегистрСведенийСписокПередУдалением(Элемент, Отказ)
	
	ТекущиеДанные = Элемент.ТекущиеДанные;
	УдалениеДДП		=  ТекущиеДанные.КодДДП;
	УдалениеИА		=  ТекущиеДанные.ИА;
	УдалениеAreaID	=  ТекущиеДанные.AreaID;
	
КонецПроцедуры

Процедура РегистрСведенийСписокПриНачалеРедактирования(Элемент, НоваяСтрока, Копирование)
	
	ЗаполнитьЗначенияСвойств(СтруктураДанныхПриОткрытии,Элемент.ТекущиеДанные);
КонецПроцедуры


Процедура РегистрСведенийСписокПриОкончанииРедактирования(Элемент, НоваяСтрока, ОтменаРедактирования)
	
	ТекущиеДанные = Элемент.ТекущиеДанные;

	Если НоваяСтрока Тогда
	
		ДобавитьЗаписьВРС_МатрицаИА_Лог(ТекущиеДанные.КодДДП,ТекущиеДанные.ИА,ТекущиеДанные.AreaID,"Создание")
	
	Иначе
	
		Если ТекущиеДанные.IsAutoorder <> СтруктураДанныхПриОткрытии.IsAutoorder Тогда
			ДобавитьЗаписьВРС_МатрицаИА_Лог(ТекущиеДанные.КодДДП,ТекущиеДанные.ИА,ТекущиеДанные.AreaID,"Изменение","IsAutoorder",СтруктураДанныхПриОткрытии.IsAutoorder,ТекущиеДанные.IsAutoorder)
		КонецЕсли; 
		
		Если ТекущиеДанные.Coming <> СтруктураДанныхПриОткрытии.Coming Тогда
			ДобавитьЗаписьВРС_МатрицаИА_Лог(ТекущиеДанные.КодДДП,ТекущиеДанные.ИА,ТекущиеДанные.AreaID,"Изменение","Coming",СтруктураДанныхПриОткрытии.Coming,ТекущиеДанные.Coming)
		КонецЕсли; 
		
		Если ТекущиеДанные.Need <> СтруктураДанныхПриОткрытии.Need Тогда
			ДобавитьЗаписьВРС_МатрицаИА_Лог(ТекущиеДанные.КодДДП,ТекущиеДанные.ИА,ТекущиеДанные.AreaID,"Изменение","Need",СтруктураДанныхПриОткрытии.Need,ТекущиеДанные.Need)
		КонецЕсли; 
		
		Если ТекущиеДанные.Expire <> СтруктураДанныхПриОткрытии.Expire Тогда
			ДобавитьЗаписьВРС_МатрицаИА_Лог(ТекущиеДанные.КодДДП,ТекущиеДанные.ИА,ТекущиеДанные.AreaID,"Изменение","Expire",СтруктураДанныхПриОткрытии.Expire,ТекущиеДанные.Expire)
		КонецЕсли; 
		
		Если ТекущиеДанные.ParentKod <> СтруктураДанныхПриОткрытии.ParentKod Тогда
			ДобавитьЗаписьВРС_МатрицаИА_Лог(ТекущиеДанные.КодДДП,ТекущиеДанные.ИА,ТекущиеДанные.AreaID,"Изменение","ParentKod",СтруктураДанныхПриОткрытии.ParentKod,ТекущиеДанные.ParentKod)
		КонецЕсли; 
		
		Если ТекущиеДанные.IsActive <> СтруктураДанныхПриОткрытии.IsActive Тогда
			ДобавитьЗаписьВРС_МатрицаИА_Лог(ТекущиеДанные.КодДДП,ТекущиеДанные.ИА,ТекущиеДанные.AreaID,"Изменение","IsActive",СтруктураДанныхПриОткрытии.IsActive,ТекущиеДанные.IsActive)
		КонецЕсли; 
		
		Если ТекущиеДанные.Descr <> СтруктураДанныхПриОткрытии.Descr Тогда
			ДобавитьЗаписьВРС_МатрицаИА_Лог(ТекущиеДанные.КодДДП,ТекущиеДанные.ИА,ТекущиеДанные.AreaID,"Изменение","Descr",СтруктураДанныхПриОткрытии.Descr,ТекущиеДанные.Descr)
		КонецЕсли; 
		
		Если ТекущиеДанные.Код1С <> СтруктураДанныхПриОткрытии.Код1С Тогда
			ДобавитьЗаписьВРС_МатрицаИА_Лог(ТекущиеДанные.КодДДП,ТекущиеДанные.ИА,ТекущиеДанные.AreaID,"Изменение","Код1С",СтруктураДанныхПриОткрытии.Код1С,ТекущиеДанные.Код1С)
		КонецЕсли; 
		
	
	КонецЕсли; 
	
КонецПроцедуры


Процедура РегистрСведенийСписокПослеУдаления(Элемент)
	
	ДобавитьЗаписьВРС_МатрицаИА_Лог(УдалениеДДП,УдалениеИА,УдалениеAreaID,"Удаление")

КонецПроцедуры



СтруктураДанныхПриОткрытии = Новый Структура("Изменен,IsAutoorder,Coming,Need,Expire,ParentKod,IsActive,Descr,Код1С");