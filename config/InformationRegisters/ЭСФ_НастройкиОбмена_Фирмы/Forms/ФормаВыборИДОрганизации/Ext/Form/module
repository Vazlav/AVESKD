Перем DiadocInvoiceAPI;


Процедура ПриОткрытии()
//в форму передаем ОтпечатокКлюча	
      DiadocConnection = DiadocInvoiceAPI.CreateConnection(ОтпечатокКлюча);
	  
	  МассивКомОбъектов=DiadocConnection.GetOrganizationList();
	 // МассивКомОбъектов Поля: 
	 // Id	Name	Inn	Kpp	FnsParticipantId	FnsRegistrationDate	CanSendInvoice	Certificate	Login	AuthenticateType	Departments
     // "6b9c364828f946148e418bc7c0e15828@diadoc.ru"	"ООО "АПТЕКА-А.в.е""	"7705947629"	"770501001"	"2BM-7705947629-2012112905283725098380000000000"	30.12.1899 00:00:00	Ложь	COMОбъект	""	"Certificate"	Массив
	 
	 Для Каждого ЭлемМассива Из МассивКомОбъектов Цикл
		 Стр=ТабличноеПоле1.Добавить();
		 ЗаполнитьЗначенияСвойств(Стр,ЭлемМассива);
	КонецЦикла;	 
	  
	  
КонецПроцедуры

Процедура ПередОткрытием(Отказ, СтандартнаяОбработка)
	Диадок=Обработки.ЭСФ_Робот_20140903.Создать(); // создается и сам подключается к серверу в модуле объекта
	
	Если Диадок.TestConnection()=Ложь Тогда
		Предупреждение("Не удалось подключиться к серверу Диадока!");
		Отказ=Истина;   // нет связи нет формы
	КонецЕсли;
	
	DiadocInvoiceAPI=Диадок.DiadocInvoiceAPI;
	
КонецПроцедуры

Процедура ТабличноеПоле1Выбор(Элемент, ВыбраннаяСтрока, Колонка, СтандартнаяОбработка)
	СтандартнаяОбработка=Ложь;
КонецПроцедуры

Процедура ОсновныеДействияФормыВыбрать(Кнопка)
	 СтруктураВозврата=Новый Структура;
	 ТекСтрока=ЭлементыФормы.ТабличноеПоле1.ТекущаяСтрока;
	 
	 Для Каждого Кол Из ТабличноеПоле1.Колонки Цикл
		 
		 СтруктураВозврата.Вставить(Кол.Имя,ТекСтрока[Кол.Имя]);
		 
	КонецЦикла;	 
	 
	ОповеститьОВыборе(СтруктураВозврата);
	
КонецПроцедуры
