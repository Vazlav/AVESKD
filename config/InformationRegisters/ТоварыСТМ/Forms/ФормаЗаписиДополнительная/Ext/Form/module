
Процедура ПриОткрытии()
	
	ТоварПриОткрытии = Товар;
	ПериодПриОткрытии = Период;
	ТипСТМПриОткрытии = ТипСТМ;
	
	Прочитать();
	          
	// У записи обязательно должны быть заполнены измерения и период
	Если Не ЗначениеЗаполнено(Товар) Тогда
		Товар = ТоварПриОткрытии;
	    Период = ПериодПриОткрытии;
	КонецЕсли;
	
КонецПроцедуры

Процедура ПриЗаписи(Отказ)
	
	// Если поменяли дату, то тогда новая  запись
	Если ПериодПриОткрытии <> Период Тогда
		
		// Если что-то поменяли тогда запишем 
		Если ТипСТМПриОткрытии <> ТипСТМ Тогда
		
			МенеджерЗаписи = РегистрыСведений.ТоварыСТМ.СоздатьМенеджерЗаписи();
			МенеджерЗаписи.Период	= ПериодПриОткрытии;
			МенеджерЗаписи.Товар	= Товар;
			МенеджерЗаписи.ТипСТМ	= ТипСТМПриОткрытии;
			
			МенеджерЗаписи.Записать();
			
		КонецЕсли; 
	
	КонецЕсли;
	
КонецПроцедуры

Процедура ПослеЗаписи()
	Оповестить("ОбновитьФорму", "ТипСТМ", Товар);
КонецПроцедуры

Процедура КнопкаИсторияНажатие(Элемент)
	
	ФормаРегистра = РегистрыСведений.ТоварыСТМ.ПолучитьФормуСписка();
	ФормаРегистра.РегистрСведенийСписок.Отбор.Товар.Значение = Товар;
	ФормаРегистра.РегистрСведенийСписок.Отбор.Товар.ВидСравнения = ВидСравнения.Равно;
	ФормаРегистра.РегистрСведенийСписок.Отбор.Товар.Использование = Истина;
	ФормаРегистра.ЭлементыФормы.РегистрСведенийСписок.НачальноеОтображениеСписка = НачальноеОтображениеСписка.Конец;
	
	ФормаРегистра.Открыть();
	
КонецПроцедуры
